var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,n){this.set(t,e,i,n),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return 0<t&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return e<t?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return 0<=t?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:e+1},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,n,s,r,o,a){var h,c,l,u,p,d,f,g;if(t<i?(c=t,h=i):(c=i,h=t),s<o?(d=s,p=o):(d=o,p=s),h<d||p<c)return!1;if(e<n?(u=e,l=n):(u=n,l=e),r<a?(g=r,f=a):(g=a,f=r),l<g||f<u)return!1;var m=s-t+o-i,y=r-e+a-n,_=i-t,v=n-e,b=o-s,w=a-r,x=cr.abs(v*b-w*_),S=b*y-w*m;if(cr.abs(S)>x)return!1;var T=_*y-v*m;return cr.abs(T)<=x},e.prototype.set=function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){if(0===e)this.set_from_rect(t);else{var i=Math.sin(e),n=Math.cos(e),s=t.left*i,r=t.top*i,o=t.right*i,a=t.bottom*i,h=t.left*n,c=t.top*n,l=t.right*n,u=t.bottom*n;this.tlx=h-r,this.tly=c+s,this.trx=l-r,this.try_=c+o,this.brx=l-a,this.bry=u+o,this.blx=h-a,this.bly=u+s}},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var s=0,r=0;function n(t,e,i,n){t<e?i<n?(s=t<i?t:i,r=n<e?e:n):(s=t<n?t:n,r=i<e?e:i):i<n?(s=e<i?e:i,r=n<t?t:n):(s=e<n?e:n,r=i<t?t:i)}i.prototype.bounding_box=function(t){n(this.tlx,this.trx,this.brx,this.blx),t.left=s,t.right=r,n(this.tly,this.try_,this.bry,this.bly),t.top=s,t.bottom=r},i.prototype.contains_pt=function(t,e){var i,n,s,r=this.tlx,o=this.tly,a=this.trx-r,h=this.try_-o,c=this.brx-r,l=this.bry-o,u=t-r,p=e-o,d=c*c+l*l,f=c*u+l*p,g=1/((i=a*a+h*h)*d-(n=a*c+h*l)*n),m=(d*(s=a*u+h*p)-n*f)*g,y=(i*f-n*s)*g;return 0<=m&&0<y&&m+y<1||(y=((i=(a=this.blx-r)*a+(h=this.bly-o)*h)*f-(n=a*c+h*l)*(s=a*u+h*p))*(g=1/(i*d-n*n)),0<=(m=(d*s-n*f)*g)&&0<y&&m+y<1)},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,n){if(this.contains_pt(t,e)||this.contains_pt(i,n))return!0;var s,r,o,a,h;for(h=0;h<4;h++)if(s=this.at(h,!0),r=this.at(h,!1),o=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,n,s,r,o,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,n,s,r,o,a,h,c,l,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),n=this.at(c+1,!0),s=this.at(c+1,!1),r=t.at(l,!0),o=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,n,s,r,o,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},cr.arrayRemove=function(t,e){var i,n;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,n=t.length-1;i<n;i++)t[i]=t[i+1];cr.truncateArray(t,n)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,n;for(cr.clearArray(t),i=0,n=e.length;i<n;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){var i,n;for(i=0,n=t.length;i<n;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:i<t?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,n){var s=i-t,r=n-e;return Math.atan2(r,s)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),n=Math.cos(t),s=i*Math.sin(e)+n*Math.cos(e);return 1<=s?0:s<=-1?cr.PI:Math.acos(s)},cr.angleRotate=function(t,e,i){var n=Math.sin(t),s=Math.cos(t),r=Math.sin(e),o=Math.cos(e);return Math.acos(n*r+s*o)>i?0<s*r-n*o?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,n,s,r){if(0===i)return r?t:e;var o=Math.sin(i),a=Math.cos(i),h=(t-=n)*o;return t=t*a-(e-=s)*o,e=e*a+h,t+=n,e+=s,r?t:e},cr.distanceTo=function(t,e,i,n){var s=i-t,r=n-e;return Math.sqrt(s*s+r*r)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var n=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+n*i:t-n*i},cr.qarp=function(t,e,i,n){return cr.lerp(cr.lerp(t,e,n),cr.lerp(e,i,n),n)},cr.cubic=function(t,e,i,n,s){return cr.lerp(cr.qarp(t,e,i,s),cr.qarp(e,i,n,s),s)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var o=+new Date,a=(cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-o},!1),h=!1,c=!1;"undefined"!=typeof window&&(a=!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),h=/(iphone|ipod|ipad)/i.test(navigator.userAgent),c=window.c2ejecta);var l=!a&&!c&&!h&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function u(){this.s=null,this.items=null,this.item_count=0,l&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}u.prototype.contains=function(t){return!this.isEmpty()&&(l?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},u.prototype.add=function(t){if(l)this.s.has(t)||(this.s.add(t),this.cache_valid=!1);else{var e=t.toString(),i=this.items;i?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1)}},u.prototype.remove=function(t){if(!this.isEmpty())if(l)this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1);else if(this.items){var e=t.toString(),i=this.items;i.hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)}},u.prototype.clear=function(){this.isEmpty()||(l?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},u.prototype.isEmpty=function(){return 0===this.count()},u.prototype.count=function(){return l?this.s.size:this.item_count};var p=null,d=0;function f(t){p[d++]=t}u.prototype.update_cache=function(){if(!this.cache_valid){if(l)cr.clearArray(this.values_cache),p=this.values_cache,d=0,this.s.forEach(f),p=null,d=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,n=this.items;if(n)for(e in n)n.hasOwnProperty(e)&&(t[i++]=n[e])}this.cache_valid=!0}},u.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=u;var g=new cr.ObjectSet;function m(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function y(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function _(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function v(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){var e,i;for(e=0,i=t.length;e<i;++e)g.add(t[e]);cr.shallowAssignArray(t,g.valuesRef()),g.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){l?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){var i,n,s,r;for(n=i=0,s=t.length;i<s;++i)r=t[i],e.has(r)||(t[n++]=r);cr.truncateArray(t,n)},cr.arrayRemoveAll_arr=function(t,e){var i,n,s,r;for(n=i=0,s=t.length;i<s;++i)r=t[i],-1===cr.fastIndexOf(e,r)&&(t[n++]=r);cr.truncateArray(t,n)},m.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},m.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=m,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},y.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},y.prototype.is_empty=function(){return!this.pts_array.length},y.prototype.update_bbox=function(){for(var t,e,i,n=this.pts_cache,s=n[0],r=s,o=n[1],a=o,h=1,c=this.pts_count;h<c;++h)(t=n[i=2*h])<s&&(s=t),r<t&&(r=t),(e=n[i+1])<o&&(o=e),a<e&&(a=e);this.bboxLeft=s,this.bboxRight=r,this.bboxTop=o,this.bboxBottom=a},y.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=t.left-e,n[1]=t.top-i,n[2]=t.right-e,n[3]=t.top-i,n[4]=t.right-e,n[5]=t.bottom-i,n[6]=t.left-e,n[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},y.prototype.set_from_quad=function(t,e,i,n,s){this.pts_cache.length=8,this.pts_count=4;var r=this.pts_cache;r[0]=t.tlx-e,r[1]=t.tly-i,r[2]=t.trx-e,r[3]=t.try_-i,r[4]=t.brx-e,r[5]=t.bry-i,r[6]=t.blx-e,r[7]=t.bly-i,this.cache_width=n,this.cache_height=s,this.update_bbox()},y.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},y.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var n,s,r,o,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),n=0,o=this.pts_count;n<o;n++)r=(s=2*n)+1,a=u[s]*t,h=u[r]*e,p[s]=a*l-h*c,p[r]=h*l+a*c;this.update_bbox()}},y.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;var n,s,r,o,a,h,c,l=this.pts_count,u=this.bboxLeft-110,p=this.bboxTop-101,d=this.bboxRight+131,f=this.bboxBottom+120,g=0,m=0;for(n=0;n<l;n++)r=(n+1)%l*2,o=i[s=2*n],a=i[s+1],h=i[r],c=i[r+1],cr.segments_intersect(u,p,t,e,o,a,h,c)&&g++,cr.segments_intersect(d,f,t,e,o,a,h,c)&&m++;return g%2==1||m%2==1},y.prototype.intersects_poly=function(t,e,i){var n,s,r,o,a,h,c,l,u,p,d,f,g,m,y,_,v=t.pts_cache,b=this.pts_cache;if(this.contains_pt(v[0]+e,v[1]+i))return!0;if(t.contains_pt(b[0]-e,b[1]-i))return!0;for(n=0,o=this.pts_count;n<o;n++)for(r=(n+1)%o*2,u=b[s=2*n],p=b[s+1],d=b[r],f=b[r+1],a=0,l=t.pts_count;a<l;a++)if(c=(a+1)%l*2,g=v[h=2*a]+e,m=v[h+1]+i,y=v[c]+e,_=v[c+1]+i,cr.segments_intersect(u,p,d,f,g,m,y,_))return!0;return!1},y.prototype.intersects_segment=function(t,e,i,n,s,r){var o,a,h,c,l,u,p,d,f=this.pts_cache;if(this.contains_pt(i-t,n-e))return!0;for(o=0,a=this.pts_count;o<a;o++)if(c=(o+1)%a*2,l=f[h=2*o]+t,u=f[h+1]+e,p=f[c]+t,d=f[c+1]+e,cr.segments_intersect(i,n,s,r,l,u,p,d))return!0;return!1},y.prototype.mirror=function(t){var e,i,n;for(e=0,i=this.pts_count;e<i;++e)n=2*e,this.pts_cache[n]=2*t-this.pts_cache[n]},y.prototype.flip=function(t){var e,i,n;for(e=0,i=this.pts_count;e<i;++e)n=2*e+1,this.pts_cache[n]=2*t-this.pts_cache[n]},y.prototype.diag=function(){var t,e,i,n,s;for(t=0,e=this.pts_count;t<e;++t)n=(i=2*t)+1,s=this.pts_cache[i],this.pts_cache[i]=this.pts_cache[n],this.pts_cache[n]=s},cr.CollisionPoly=y,_.prototype.totalCellCount=0,_.prototype.getCell=function(t,e,i){var n,s=this.cells[t];return s?(n=s[e])||(i?(n=w(this,t,e),this.cells[t][e]=n):null):i?(n=w(this,t,e),this.cells[t]={},this.cells[t][e]=n):null},_.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},_.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},_.prototype.update=function(t,e,i){var n,s,r,o,a;if(e)for(n=e.left,s=e.right;n<=s;++n)for(r=e.top,o=e.bottom;r<=o;++r)i&&i.contains_pt(n,r)||(a=this.getCell(n,r,!1))&&(a.remove(t),a.isEmpty()&&(x(a),this.cells[n][r]=null));if(i)for(n=i.left,s=i.right;n<=s;++n)for(r=i.top,o=i.bottom;r<=o;++r)e&&e.contains_pt(n,r)||this.getCell(n,r,!0).insert(t)},_.prototype.queryRange=function(t,e){var i,n,s,r,o,a;for(i=this.XToCell(t.left),s=this.YToCell(t.top),n=this.XToCell(t.right),o=this.YToCell(t.bottom);i<=n;++i)for(r=s;r<=o;++r)(a=this.getCell(i,r,!1))&&a.dump(e)},cr.SparseGrid=_,v.prototype.totalCellCount=0,v.prototype.getCell=function(t,e,i){var n,s=this.cells[t];return s?(n=s[e])||(i?(n=O(this,t,e),this.cells[t][e]=n):null):i?(n=O(this,t,e),this.cells[t]={},this.cells[t][e]=n):null},v.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},v.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},v.prototype.update=function(t,e,i){var n,s,r,o,a;if(e)for(n=e.left,s=e.right;n<=s;++n)for(r=e.top,o=e.bottom;r<=o;++r)i&&i.contains_pt(n,r)||(a=this.getCell(n,r,!1))&&(a.remove(t),a.isEmpty()&&(A(a),this.cells[n][r]=null));if(i)for(n=i.left,s=i.right;n<=s;++n)for(r=i.top,o=i.bottom;r<=o;++r)e&&e.contains_pt(n,r)||this.getCell(n,r,!0).insert(t)},v.prototype.queryRange=function(t,e,i,n,s){var r,o,a,h,c,l;for(r=this.XToCell(t),a=this.YToCell(e),o=this.XToCell(i),c=this.YToCell(n);r<=o;++r)for(h=a;h<=c;++h)(l=this.getCell(r,h,!1))&&l.dump(s)},v.prototype.markRangeChanged=function(t){var e,i,n,s,r,o;for(e=t.left,n=t.top,i=t.right,r=t.bottom;e<=i;++e)for(s=n;s<=r;++s)(o=this.getCell(e,s,!1))&&(o.is_sorted=!1)},cr.RenderGrid=v;var b=[];function w(t,e,i){var n;return _.prototype.totalCellCount++,b.length?((n=b.pop()).grid=t,n.x=e,n.y=i,n):new cr.GridCell(t,e,i)}function x(t){_.prototype.totalCellCount--,t.objects.clear(),b.length<1e3&&b.push(t)}function S(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}S.prototype.isEmpty=function(){return this.objects.isEmpty()},S.prototype.insert=function(t){this.objects.add(t)},S.prototype.remove=function(t){this.objects.remove(t)},S.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=S;var T=[];function O(t,e,i){var n;return v.prototype.totalCellCount++,T.length?((n=T.pop()).grid=t,n.x=e,n.y=i,n):new cr.RenderCell(t,e,i)}function A(t){v.prototype.totalCellCount--,t.reset(),T.length<1e3&&T.push(t)}function C(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function E(t,e){return t.zindex-e.zindex}C.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},C.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},C.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},C.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},C.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(E),this.is_sorted=!0)},C.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},C.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=C;var k=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||11<=t?"source-over":k[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=Math.sqrt(i*i+n*n+s*s);return r?1===r?(e[0]=i,e[1]=n,e[2]=s):(r=1/r,e[0]=i*r,e[1]=n*r,e[2]=s*r):(e[0]=0,e[1]=0,e[2]=0),e},vec3.cross=function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=(t=t[2],e[0]),o=e[1];e=e[2];return i[0]=s*e-t*o,i[1]=t*r-n*e,i[2]=n*o-s*r,i},vec3.length=function(t){var e=t[0],i=t[1];t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var n=t[0]-e[0],s=t[1]-e[1];t=t[2]-e[2];return(e=Math.sqrt(n*n+s*s+t*t))?(e=1/e,i[0]=n*e,i[1]=s*e,i[2]=t*e):(i[0]=0,i[1]=0,i[2]=0),i},vec3.lerp=function(t,e,i,n){return n||(n=t),n[0]=t[0]+i*(e[0]-t[0]),n[1]=t[1]+i*(e[1]-t[1]),n[2]=t[2]+i*(e[2]-t[2]),n},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],n=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=n,t[7]=s,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],n=t[2],s=t[3],r=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=r,t[11]=t[14],t[12]=s,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],f=t[13],g=t[14];return d*l*a*s-c*f*a*s-d*o*u*s+r*f*u*s+c*o*g*s-r*l*g*s-d*l*n*h+c*f*n*h+d*i*u*h-e*f*u*h-c*i*g*h+e*l*g*h+d*o*n*p-r*f*n*p-d*i*a*p+e*f*a*p+r*i*g*p-e*o*g*p-c*o*n*(t=t[15])+r*l*n*t+c*i*a*t-e*l*a*t-r*i*u*t+e*o*u*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],p=t[10],d=t[11],f=t[12],g=t[13],m=t[14],y=t[15],_=i*a-n*o,v=i*h-s*o,b=i*c-r*o,w=n*h-s*a,x=n*c-r*a,S=s*c-r*h,T=l*g-u*f,O=l*m-p*f,A=l*y-d*f,C=u*m-p*g,E=u*y-d*g,k=p*y-d*m,P=1/(_*k-v*E+b*C+w*A-x*O+S*T);return e[0]=(a*k-h*E+c*C)*P,e[1]=(-n*k+s*E-r*C)*P,e[2]=(g*S-m*x+y*w)*P,e[3]=(-u*S+p*x-d*w)*P,e[4]=(-o*k+h*A-c*O)*P,e[5]=(i*k-s*A+r*O)*P,e[6]=(-f*S+m*b-y*v)*P,e[7]=(l*S-p*b+d*v)*P,e[8]=(o*E-a*A+c*T)*P,e[9]=(-i*E+n*A-r*T)*P,e[10]=(f*x-g*b+y*_)*P,e[11]=(-l*x+u*b-d*_)*P,e[12]=(-o*C+a*O-h*T)*P,e[13]=(i*C-n*O+s*T)*P,e[14]=(-f*w+g*v-m*_)*P,e[15]=(l*w-u*v+p*_)*P,e},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10],u=l*o-a*c,p=-l*r+a*h,d=c*r-o*h,f=i*u+n*p+s*d;return f?(f=1/f,e||(e=mat3.create()),e[0]=u*f,e[1]=(-l*n+s*c)*f,e[2]=(a*n-s*o)*f,e[3]=p*f,e[4]=(l*i-s*h)*f,e[5]=(-a*i+s*r)*f,e[6]=d*f,e[7]=(-c*i+n*h)*f,e[8]=(o*i-n*r)*f,e):null},mat4.multiply=function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],g=t[12],m=t[13],y=t[14],_=(t=t[15],e[0]),v=e[1],b=e[2],w=e[3],x=e[4],S=e[5],T=e[6],O=e[7],A=e[8],C=e[9],E=e[10],k=e[11],P=e[12],I=e[13],R=e[14];e=e[15];return i[0]=_*n+v*a+b*u+w*g,i[1]=_*s+v*h+b*p+w*m,i[2]=_*r+v*c+b*d+w*y,i[3]=_*o+v*l+b*f+w*t,i[4]=x*n+S*a+T*u+O*g,i[5]=x*s+S*h+T*p+O*m,i[6]=x*r+S*c+T*d+O*y,i[7]=x*o+S*l+T*f+O*t,i[8]=A*n+C*a+E*u+k*g,i[9]=A*s+C*h+E*p+k*m,i[10]=A*r+C*c+E*d+k*y,i[11]=A*o+C*l+E*f+k*t,i[12]=P*n+I*a+R*u+e*g,i[13]=P*s+I*h+R*p+e*m,i[14]=P*r+I*c+R*d+e*y,i[15]=P*o+I*l+R*f+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var n=e[0],s=e[1];e=e[2];return i[0]=t[0]*n+t[4]*s+t[8]*e+t[12],i[1]=t[1]*n+t[5]*s+t[9]*e+t[13],i[2]=t[2]*n+t[6]*s+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2];e=e[3];return i[0]=t[0]*n+t[4]*s+t[8]*r+t[12]*e,i[1]=t[1]*n+t[5]*s+t[9]*r+t[13]*e,i[2]=t[2]*n+t[6]*s+t[10]*r+t[14]*e,i[3]=t[3]*n+t[7]*s+t[11]*r+t[15]*e,i},mat4.translate=function(t,e,i){var n,s,r,o,a,h,c,l,u,p,d,f,g=e[0],m=e[1];e=e[2];return i&&t!==i?(n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],i[0]=n,i[1]=s,i[2]=r,i[3]=o,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=u,i[9]=p,i[10]=d,i[11]=f,i[12]=n*g+a*m+u*e+t[12],i[13]=s*g+h*m+p*e+t[13],i[14]=r*g+c*m+d*e+t[14],i[15]=o*g+l*m+f*e+t[15],i):(t[12]=t[0]*g+t[4]*m+t[8]*e+t[12],t[13]=t[1]*g+t[5]*m+t[9]*e+t[13],t[14]=t[2]*g+t[6]*m+t[10]*e+t[14],t[15]=t[3]*g+t[7]*m+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var n=e[0],s=e[1];e=e[2];return i&&t!==i?(i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=s,t[5]*=s,t[6]*=s,t[7]*=s,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,n){var s,r,o,a,h,c,l,u,p,d,f,g,m,y,_,v,b,w,x,S,T=i[0],O=i[1],A=(i=i[2],Math.sqrt(T*T+O*O+i*i));return A?(1!==A&&(T*=A=1/A,O*=A,i*=A),s=Math.sin(e),o=1-(r=Math.cos(e)),e=t[0],A=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],p=t[7],d=t[8],f=t[9],g=t[10],m=t[11],y=T*T*o+r,_=O*T*o+i*s,v=i*T*o-O*s,b=T*O*o-i*s,w=O*O*o+r,x=i*O*o+T*s,S=T*i*o+O*s,T=O*i*o-T*s,O=i*i*o+r,n?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=e*y+c*_+d*v,n[1]=A*y+l*_+f*v,n[2]=a*y+u*_+g*v,n[3]=h*y+p*_+m*v,n[4]=e*b+c*w+d*x,n[5]=A*b+l*w+f*x,n[6]=a*b+u*w+g*x,n[7]=h*b+p*w+m*x,n[8]=e*S+c*T+d*O,n[9]=A*S+l*T+f*O,n[10]=a*S+u*T+g*O,n[11]=h*S+p*T+m*O,n):null},mat4.rotateX=function(t,e,i){var n=Math.sin(e),s=(e=Math.cos(e),t[4]),r=t[5],o=t[6],a=t[7],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=s*e+h*n,i[5]=r*e+c*n,i[6]=o*e+l*n,i[7]=a*e+u*n,i[8]=s*-n+h*e,i[9]=r*-n+c*e,i[10]=o*-n+l*e,i[11]=a*-n+u*e,i},mat4.rotateY=function(t,e,i){var n=Math.sin(e),s=(e=Math.cos(e),t[0]),r=t[1],o=t[2],a=t[3],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*-n,i[1]=r*e+c*-n,i[2]=o*e+l*-n,i[3]=a*e+u*-n,i[8]=s*n+h*e,i[9]=r*n+c*e,i[10]=o*n+l*e,i[11]=a*n+u*e,i},mat4.rotateZ=function(t,e,i){var n=Math.sin(e),s=(e=Math.cos(e),t[0]),r=t[1],o=t[2],a=t[3],h=t[4],c=t[5],l=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*n,i[1]=r*e+c*n,i[2]=o*e+l*n,i[3]=a*e+u*n,i[4]=s*-n+h*e,i[5]=r*-n+c*e,i[6]=o*-n+l*e,i[7]=a*-n+u*e,i},mat4.frustum=function(t,e,i,n,s,r,o){o||(o=mat4.create());var a=e-t,h=n-i,c=r-s;return o[0]=2*s/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/h,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(n+i)/h,o[10]=-(r+s)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-r*s*2/c,o[15]=0,o},mat4.perspective=function(t,e,i,n,s){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,n,s)},mat4.ortho=function(t,e,i,n,s,r,o){o||(o=mat4.create());var a=e-t,h=n-i,c=r-s;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/a,o[13]=-(n+i)/h,o[14]=-(r+s)/c,o[15]=1,o},mat4.lookAt=function(t,e,i,n){n||(n=mat4.create());var s,r,o,a,h,c,l,u,p=t[0],d=t[1];t=t[2];return r=i[0],o=i[1],s=i[2],i=e[1],c=e[2],p===e[0]&&d===i&&t===c?mat4.identity(n):(i=p-e[0],c=d-e[1],l=t-e[2],e=o*(l*=u=1/Math.sqrt(i*i+c*c+l*l))-s*(c*=u),s=s*(i*=u)-r*l,r=r*c-o*i,(u=Math.sqrt(e*e+s*s+r*r))?(e*=u=1/u,s*=u,r*=u):r=s=e=0,o=c*r-l*s,a=l*e-i*r,h=i*s-c*e,(u=Math.sqrt(o*o+a*a+h*h))?(o*=u=1/u,a*=u,h*=u):h=a=o=0,n[0]=e,n[1]=o,n[2]=i,n[3]=0,n[4]=s,n[5]=a,n[6]=c,n[7]=0,n[8]=r,n[9]=h,n[10]=l,n[11]=0,n[12]=-(e*p+s*d+r*t),n[13]=-(o*p+a*d+h*t),n[14]=-(i*p+c*d+l*t),n[15]=1,n)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var n=t[0],s=t[1],r=t[2],o=t[3],a=n+n,h=s+s,c=r+r,l=(t=n*a,n*h);n*=c;var u=s*h;return s*=c,r*=c,a*=o,h*=o,o*=c,i[0]=1-(u+r),i[1]=l+o,i[2]=n-h,i[3]=0,i[4]=l-o,i[5]=1-(t+r),i[6]=s+a,i[7]=0,i[8]=n+h,i[9]=s-a,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],n=t[1],s=t[2];return e&&t!==e?(e[0]=i,e[1]=n,e[2]=s,e[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],n=t[2];t=t[3];return Math.sqrt(e*e+i*i+n*n+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=t[3],o=Math.sqrt(i*i+n*n+s*s+r*r);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0):(o=1/o,e[0]=i*o,e[1]=n*o,e[2]=s*o,e[3]=r*o),e},quat4.multiply=function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=(t=t[3],e[0]),a=e[1],h=e[2];e=e[3];return i[0]=n*e+t*o+s*h-r*a,i[1]=s*e+t*a+r*o-n*h,i[2]=r*e+t*h+n*a-s*o,i[3]=t*e-n*o-s*a-r*h,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2],o=(e=t[0],t[1]),a=t[2],h=(t=t[3])*n+o*r-a*s,c=t*s+a*n-e*r,l=t*r+e*s-o*n;n=-e*n-o*s-a*r;return i[0]=h*t+n*-e+c*-a-l*-o,i[1]=c*t+n*-o+l*-e-h*-a,i[2]=l*t+n*-a+h*-o-c*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],n=t[1],s=t[2],r=t[3],o=i+i,a=n+n,h=s+s,c=i*o,l=i*a;i*=h;var u=n*a;return n*=h,s*=h,o*=r,a*=r,r*=h,e[0]=1-(u+s),e[1]=l+r,e[2]=i-a,e[3]=l-r,e[4]=1-(c+s),e[5]=n+o,e[6]=i+a,e[7]=n-o,e[8]=1-(c+u),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],n=t[1],s=t[2],r=t[3],o=i+i,a=n+n,h=s+s,c=i*o,l=i*a;i*=h;var u=n*a;return n*=h,s*=h,o*=r,a*=r,r*=h,e[0]=1-(u+s),e[1]=l+r,e[2]=i-a,e[3]=0,e[4]=l-r,e[5]=1-(c+s),e[6]=n+o,e[7]=0,e[8]=i+a,e[9]=n-o,e[10]=1-(c+u),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,n){n||(n=t);var s,r,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(o)?(n!==t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),n):(s=Math.acos(o),r=Math.sqrt(1-o*o),Math.abs(r)<.001?(n[0]=.5*t[0]+.5*e[0],n[1]=.5*t[1]+.5*e[1],n[2]=.5*t[2]+.5*e[2],n[3]=.5*t[3]+.5*e[3]):(o=Math.sin((1-i)*s)/r,i=Math.sin(i*s)/r,n[0]=t[0]*o+e[0]*i,n[1]=t[1]*o+e[1]*i,n[2]=t[2]*o+e[2]*i,n[3]=t[3]*o+e[3]*i),n)},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var i=mat4.create();function t(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function u(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function n(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}t.prototype.initState=function(){var t,e=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this.enableFrontToBack?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.lastSrcBlend=e.ONE,this.lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8e3*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferData(e.ARRAY_BUFFER,this.pointData.byteLength,e.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),t=0;t<4;t++)this.vertexBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.vertexData.byteLength,e.DYNAMIC_DRAW),this.texcoordBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.texcoordData.byteLength,e.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=new Uint16Array(12e3);for(var n,s,r=t=0;t<12e3;)i[t++]=r,i[t++]=r+1,i[t++]=r+2,i[t++]=r,i[t++]=r+2,i[t++]=r+3,r+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],n=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),s=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var o=this.createShaderProgram({src:n},s,"<default>");this.shaderPrograms.push(o),n=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var a=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");o=this.createShaderProgram({src:n},a,"<point>"),this.shaderPrograms.push(o),n=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");o=this.createShaderProgram({src:n},s,"<earlyz>");this.shaderPrograms.push(o),n=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");o=this.createShaderProgram({src:n},s,"<fill>");for(var h in this.shaderPrograms.push(o),cr.shaders)cr.shaders.hasOwnProperty(h)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[h],s,h));e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=e.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=e.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var c=e.getParameter(e.ALIASED_POINT_SIZE_RANGE);this.minPointSize=c[0],this.maxPointSize=c[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},u.prototype.updateMatMV=function(t){e(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},t.prototype.createShaderProgram=function(t,e,i){var n=this.gl,s=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(s,t.src),n.compileShader(s),!n.getShaderParameter(s,n.COMPILE_STATUS)){var r=n.getShaderInfoLog(s);throw n.deleteShader(s),new Error("error compiling fragment shader: "+r)}var o=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(o,e),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS)){r=n.getShaderInfoLog(o);throw n.deleteShader(s),n.deleteShader(o),new Error("error compiling vertex shader: "+r)}var a=n.createProgram();if(n.attachShader(a,s),n.attachShader(a,o),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS)){r=n.getProgramInfoLog(a);throw n.deleteShader(s),n.deleteShader(o),n.deleteProgram(a),new Error("error linking shader program: "+r)}n.useProgram(a),n.deleteShader(s),n.deleteShader(o);var h,c,l=new u(n,a,i);for(l.extendBoxHorizontal=t.extendBoxHorizontal||0,l.extendBoxVertical=t.extendBoxVertical||0,l.crossSampling=!!t.crossSampling,l.preservesOpaqueness=!!t.preservesOpaqueness,l.animated=!!t.animated,l.parameters=t.parameters||[],h=0,c=l.parameters.length;h<c;h++)l.parameters[h][1]=n.getUniformLocation(a,l.parameters[h][0]),l.lastCustomParams.push(0),n.uniform1f(l.parameters[h][1],0);return cr.seal(l),l},t.prototype.getShaderIndex=function(t){var e,i;for(e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},t.prototype.project=function(t,e,i){var n=this.matMV,s=this.matP,r=[0,0,0,0,0,0,0,0];r[0]=n[0]*t+n[4]*e+n[12],r[1]=n[1]*t+n[5]*e+n[13],r[2]=n[2]*t+n[6]*e+n[14],r[3]=n[3]*t+n[7]*e+n[15],r[4]=s[0]*r[0]+s[4]*r[1]+s[8]*r[2]+s[12]*r[3],r[5]=s[1]*r[0]+s[5]*r[1]+s[9]*r[2]+s[13]*r[3],r[6]=s[2]*r[0]+s[6]*r[1]+s[10]*r[2]+s[14]*r[3],r[7]=-r[2],0!==r[7]&&(r[7]=1/r[7],r[4]*=r[7],r[5]*=r[7],r[6]*=r[7],i[0]=(.5*r[4]+.5)*this.width,i[1]=(.5*r[5]+.5)*this.height)},t.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var n,s,r,o=this.gl;if(this.width=t,this.height=e,o.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP);var a=[0,0],h=[0,0];this.project(0,0,a),this.project(1,1,h),this.worldScale[0]=1/(h[0]-a[0]),this.worldScale[1]=-1/(h[1]-a[1])}for(n=0,s=this.shaderPrograms.length;n<s;n++)(r=this.shaderPrograms[n]).hasCurrentMatMV=!1,r.locMatP&&(o.useProgram(r.shaderProgram),o.uniformMatrix4fv(r.locMatP,!1,this.matP));o.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,this.fbo),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),this.renderToTex=null)}},t.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},t.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},t.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},t.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},t.prototype.updateModelView=function(){if(!e(this.lastMV,this.matMV)){var t=this.pushBatch();t.type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(32760<t&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},n.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},n.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},n.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},n.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},n.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},n.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},n.prototype.doUpdateModelView=function(){var t,e,i,n=this.glwrap.shaderPrograms,s=this.glwrap.currentProgram;for(t=0,e=n.length;t<e;t++)i=n[t],t===s&&i.locMatMV?(i.updateMatMV(this.mat4param),i.hasCurrentMatMV=!0):i.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},n.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},n.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},n.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},n.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},n.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},n.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},n.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,n=this.gl,s=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,n.activeTexture(n.TEXTURE0));var r,o=s[0];if(i.locPixelWidth&&o!==i.lpPixelWidth&&(i.lpPixelWidth=o,n.uniform1f(i.locPixelWidth,o)),o=s[1],i.locPixelHeight&&o!==i.lpPixelHeight&&(i.lpPixelHeight=o,n.uniform1f(i.locPixelHeight,o)),o=s[2],r=s[3],!i.locDestStart||o===i.lpDestStartX&&r===i.lpDestStartY||(i.lpDestStartX=o,i.lpDestStartY=r,n.uniform2f(i.locDestStart,o,r)),o=s[4],r=s[5],!i.locDestEnd||o===i.lpDestEndX&&r===i.lpDestEndY||(i.lpDestEndX=o,i.lpDestEndY=r,n.uniform2f(i.locDestEnd,o,r)),o=s[6],i.locLayerScale&&o!==i.lpLayerScale&&(i.lpLayerScale=o,n.uniform1f(i.locLayerScale,o)),o=s[7],i.locLayerAngle&&o!==i.lpLayerAngle&&(i.lpLayerAngle=o,n.uniform1f(i.locLayerAngle,o)),o=s[8],r=s[9],!i.locViewOrigin||o===i.lpViewOriginX&&r===i.lpViewOriginY||(i.lpViewOriginX=o,i.lpViewOriginY=r,n.uniform2f(i.locViewOrigin,o,r)),o=s[10],r=s[11],!i.locScrollPos||o===i.lpScrollPosX&&r===i.lpScrollPosY||(i.lpScrollPosX=o,i.lpScrollPosY=r,n.uniform2f(i.locScrollPos,o,r)),o=s[12],i.locSeconds&&o!==i.lpSeconds&&(i.lpSeconds=o,n.uniform1f(i.locSeconds,o)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)(o=this.shaderParams[t])!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=o,n.uniform1f(i.parameters[t][1],o))},t.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new n(0,this)),this.batch[this.batchPtr++]},t.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,n=this.gl;if(0<this.pointPtr&&(n.bindBuffer(n.ARRAY_BUFFER,this.pointBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),s&&0<=s.locAPos&&"<point>"===s.name&&n.vertexAttribPointer(s.locAPos,4,n.FLOAT,!1,0,0)),0<this.vertexPtr){var s=this.currentShader;n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),s&&0<=s.locAPos&&"<point>"!==s.name&&n.vertexAttribPointer(s.locAPos,this.enableFrontToBack?3:2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),s&&0<=s.locATex&&"<point>"!==s.name&&n.vertexAttribPointer(s.locATex,2,n.FLOAT,!1,0,0)}for(t=0,e=this.batchPtr;t<e;t++)switch((i=this.batch[t]).type){case 1:i.doQuad();break;case 2:i.doSetTexture();break;case 3:i.doSetOpacity();break;case 4:i.doSetBlend();break;case 5:i.doUpdateModelView();break;case 6:i.doRenderToTexture();break;case 7:i.doClear();break;case 8:i.doPoints();break;case 9:i.doSetProgram();break;case 10:i.doSetProgramParameters();break;case 11:i.doSetTexture1();break;case 12:i.doSetColor();break;case 13:i.doSetDepthTestEnabled();break;case 14:i.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,4<=this.curBuffer&&(this.curBuffer=0)}},t.prototype.setOpacity=function(t){if(t!==this.lastOpacity&&!this.isEarlyZPass){var e=this.pushBatch();e.type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setTexture=function(t){if(t!==this.lastTexture0){var e=this.pushBatch();e.type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.setBlend=function(t,e){if((t!==this.lastSrcBlend||e!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},t.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};t.prototype.quad=function(t,e,i,n,s,r,o,a){15992<=this.vertexPtr&&this.endBatch();var h=this.vertexPtr,c=this.texPtr,l=this.vertexData,u=this.texcoordData,p=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var d=this.pushBatch();d.type=1,d.startIndex=this.enableFrontToBack?h:h/2*3,d.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(l[h++]=t,l[h++]=e,l[h++]=p,l[h++]=i,l[h++]=n,l[h++]=p,l[h++]=s,l[h++]=r,l[h++]=p,l[h++]=o,l[h++]=a,l[h++]=p):(l[h++]=t,l[h++]=e,l[h++]=i,l[h++]=n,l[h++]=s,l[h++]=r,l[h++]=o,l[h++]=a),u[c++]=0,u[c++]=0,u[c++]=1,u[c++]=0,u[c++]=1,u[c++]=1,u[c++]=0,u[c++]=1,this.vertexPtr=h,this.texPtr=c},t.prototype.quadTex=function(t,e,i,n,s,r,o,a,h){15992<=this.vertexPtr&&this.endBatch();var c=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var f=this.pushBatch();f.type=1,f.startIndex=this.enableFrontToBack?c:c/2*3,f.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var g=h.left,m=h.top,y=h.right,_=h.bottom;this.enableFrontToBack?(u[c++]=t,u[c++]=e,u[c++]=d,u[c++]=i,u[c++]=n,u[c++]=d,u[c++]=s,u[c++]=r,u[c++]=d,u[c++]=o,u[c++]=a,u[c++]=d):(u[c++]=t,u[c++]=e,u[c++]=i,u[c++]=n,u[c++]=s,u[c++]=r,u[c++]=o,u[c++]=a),p[l++]=g,p[l++]=m,p[l++]=y,p[l++]=m,p[l++]=y,p[l++]=_,p[l++]=g,p[l++]=_,this.vertexPtr=c,this.texPtr=l},t.prototype.quadTexUV=function(t,e,i,n,s,r,o,a,h,c,l,u,p,d,f,g){15992<=this.vertexPtr&&this.endBatch();var m=this.vertexPtr,y=this.texPtr,_=this.vertexData,v=this.texcoordData,b=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var w=this.pushBatch();w.type=1,w.startIndex=this.enableFrontToBack?m:m/2*3,w.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(_[m++]=t,_[m++]=e,_[m++]=b,_[m++]=i,_[m++]=n,_[m++]=b,_[m++]=s,_[m++]=r,_[m++]=b,_[m++]=o,_[m++]=a,_[m++]=b):(_[m++]=t,_[m++]=e,_[m++]=i,_[m++]=n,_[m++]=s,_[m++]=r,_[m++]=o,_[m++]=a),v[y++]=h,v[y++]=c,v[y++]=l,v[y++]=u,v[y++]=p,v[y++]=d,v[y++]=f,v[y++]=g,this.vertexPtr=m,this.texPtr=y},t.prototype.convexPoly=function(t){var e,i,n,s,r,o,a,h,c=t.length/2-2,l=c-1,u=t[0],p=t[1];for(e=0;e<c;e+=2)n=t[(i=2*e)+2],s=t[i+3],r=t[i+4],o=t[i+5],e===l?this.quad(u,p,n,s,r,o,r,o):(a=t[i+6],h=t[i+7],this.quad(u,p,n,s,r,o,a,h))};t.prototype.point=function(t,e,i,n){7996<=this.pointPtr&&this.endBatch();var s=this.pointPtr,r=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var o=this.pushBatch();o.type=8,o.startIndex=s,o.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}r[s++]=t,r[s++]=e,r[s++]=i,r[s++]=n,this.pointPtr=s},t.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=9,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},t.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},t.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},t.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},t.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},t.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},t.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},t.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},t.prototype.setProgramParameters=function(t,e,i,n,s,r,o,a,h,c,l,u,p,d,f){var g,m,y,_,v,b=this.shaderPrograms[this.lastProgram];if(b.hasAnyOptionalUniforms||f.length){if((y=this.pushBatch()).type=10,y.mat4param?mat4.set(this.matMV,y.mat4param):y.mat4param=mat4.create(),(_=y.mat4param)[0]=e,_[1]=i,_[2]=n,_[3]=s,_[4]=r,_[5]=o,_[6]=a,_[7]=h,_[8]=c,_[9]=l,_[10]=u,_[11]=p,_[12]=d,b.locSamplerBack?y.texParam=t:y.texParam=null,f.length)for((v=y.shaderParams).length=f.length,g=0,m=f.length;g<m;g++)v[g]=f[g];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clear=function(t,e,i,n){var s=this.pushBatch();s.type=7,s.startIndex=0,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.clearRect=function(t,e,i,n){if(!(i<0||n<0)){var s=this.pushBatch();s.type=7,s.startIndex=1,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var e=this.pushBatch();e.type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},t.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,i),this.resetModelView(),this.updateModelView();var t=this.width/2,e=this.height/2;this.quad(-t,e,t,e,t,-e,-t,-e),mat4.set(i,this.matMV),this.updateModelView()},t.prototype.setColorFillMode=function(t,e,i,n){this.switchProgram(3);var s=this.pushBatch();s.type=12,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setTextureFillMode=function(){this.switchProgram(0)},t.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},t.prototype.present=function(){this.endBatch(),this.gl.flush()};var g=[],m={};t.prototype.contextLost=function(){cr.clearArray(g),m={}};t.prototype.loadTexture=function(t,e,i,n,s,r){e=!!e,i=!!i;var o=t.src+","+e+","+i+(e?","+s:""),a=null;if(void 0!==t.src&&m.hasOwnProperty(o))return(a=m[o]).c2refcount++,a;this.endBatch();var h=this.gl,c=cr.isPOT(t.width)&&cr.isPOT(t.height);a=h.createTexture(),h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l=h.RGBA,u=h.RGBA,p=h.UNSIGNED_BYTE;if(n&&!this.isIE)switch(n){case 1:l=h.RGB,u=h.RGB;break;case 2:p=h.UNSIGNED_SHORT_4_4_4_4;break;case 3:p=h.UNSIGNED_SHORT_5_5_5_1;break;case 4:l=h.RGB,u=h.RGB,p=h.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!c&&e){var d=document.createElement("canvas");d.width=cr.nextHighestPowerOfTwo(t.width),d.height=cr.nextHighestPowerOfTwo(t.height);var f=d.getContext("2d");void 0!==f.imageSmoothingEnabled?f.imageSmoothingEnabled=i:(f.webkitImageSmoothingEnabled=i,f.mozImageSmoothingEnabled=i,f.msImageSmoothingEnabled=i),f.drawImage(t,0,0,t.width,t.height,0,0,d.width,d.height),h.texImage2D(h.TEXTURE_2D,0,l,u,p,d)}else h.texImage2D(h.TEXTURE_2D,0,l,u,p,t);return e?"repeat-x"===s?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)):("repeat-y"===s?h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)),i?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),(c||2<=this.version)&&this.enable_mipmaps&&!r?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST)),h.bindTexture(h.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t.width,a.c2height=t.height,a.c2refcount=1,a.c2texkey=o,g.push(a),m[o]=a},t.prototype.createEmptyTexture=function(t,e,i,n,s){this.endBatch();var r=this.gl;this.isIE&&(n=!1);var o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,n?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,null),s?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i?r.LINEAR:r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=t,o.c2height=e,g.push(o),o},t.prototype.videoToTexture=function(t,e,i){this.endBatch();var n=this.gl;this.isIE&&(i=!1),n.bindTexture(n.TEXTURE_2D,e),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,i?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}n.bindTexture(n.TEXTURE_2D,null),this.lastTexture0=null},t.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&1<t.c2refcount?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(g,t),void 0!==t.c2texkey&&delete m[t.c2texkey],this.gl.deleteTexture(t)))},t.prototype.estimateVRAM=function(){var t,e,i,n=this.width*this.height*4*2;for(t=0,e=g.length;t<e;t++)n+=(i=g[t]).c2width*i.c2height*4;return n},t.prototype.textureCount=function(){return g.length},t.prototype.setRenderingToTexture=function(t){if(t!==this.renderToTex){var e=this.pushBatch();e.type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=t}(),function(){var v=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;function i(t){if(t&&(t.getContext||t.dc)&&!t.c2runtime){var e=t.c2runtime=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){e.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){e.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){e.setSuspended(!0)}),document.addEventListener("pageshow",function(){e.setSuspended(!1)}),document.addEventListener("resize",function(){e.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&-1<window.location.search.indexOf("debug"),this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()}}i.prototype.requestProjectData=function(){var e=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(t){e.loadProject(JSON.parse(t))},function(t){alert("Error fetching data.js")});else{var i;i=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var n="data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(n="data.json"),i.open("GET",n,!0);var s=!1;if(!this.isDomFree&&"response"in i&&"responseType"in i)try{i.responseType="json",s="json"===i.responseType}catch(t){s=!1}if(!s&&"responseType"in i)try{i.responseType="text"}catch(t){}if("overrideMimeType"in i)try{i.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?i.onreadystatechange=function(){4===i.readyState&&e.loadProject(JSON.parse(i.responseText))}:(i.onload=function(){if(s)e.loadProject(i.response);else if(e.isEjecta){var t=i.responseText;t=t.substr(t.indexOf("{")),e.loadProject(JSON.parse(t))}else e.loadProject(JSON.parse(i.responseText))},i.onerror=function(t){cr.logerror("Error requesting "+n+":"),cr.logerror(t)}),i.send()}};i.prototype.initRendererAndLoader=function(){var t,e,i,n,s,r,o,a,h,c,l,u=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,this.ClearDeathRow(),0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),u.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){u.glwrap.initState(),u.glwrap.setSize(u.glwrap.width,u.glwrap.height,!0),u.layer_tex=null,u.layout_tex=null,u.fx_tex[0]=null,u.fx_tex[1]=null,u.onContextRestored(),u.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(l={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.gl=this.canvas.getContext("webgl2",l)||this.canvas.getContext("webgl",l)||this.canvas.getContext("experimental-webgl",l))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var p=this.gl.getExtension("WEBGL_debug_renderer_info");if(p){var d=this.gl.getParameter(p.UNMASKED_VENDOR_WEBGL),f=this.gl.getParameter(p.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=f+" ["+d+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(i=0,n=(o=this.types_by_index[t]).effect_types.length;i<n;i++)(a=o.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,n=(h=this.layouts_by_index[t]).effect_types.length;i<n;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,n=h.layers.length;i<n;i++){for(s=0,r=(c=h.layers[i]).effect_types.length;s<r;s++)(a=c.effect_types[s]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else{if(0<this.fullscreen_mode&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(l=this.isCocoonJs?{antialias:!!this.linearSampling,alpha:!0}:{alpha:!0},this.ctx=this.canvas.getContext("2d",l),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}if(this.tickFunc=function(t){u.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){u.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||u.setSuspended(!0)}))),window.addEventListener("blur",function(){u.onWindowBlur()}),!this.isDomFree){var g=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",g):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",g):document.addEventListener("touchstart",g),document.addEventListener("mousedown",g)}0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)};i.prototype.setSize=function(t,e,i){var n=0,s=0,r=0,o=0,a=0;if(this.lastWindowWidth!==t||this.lastWindowHeight!==e||i){this.lastWindowWidth=t,this.lastWindowHeight=e;var h,c,l=this.fullscreen_mode,u=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova;if(u||0!==this.fullscreen_mode||i){u&&0<this.fullscreen_scaling&&(l=this.fullscreen_scaling);var p=this.devicePixelRatio;4<=l?(h=this.original_width/this.original_height)<(c=t/e)?(r=e*h,5===l?(1<(a=r*p/this.original_width)?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),n=(t-(r=this.original_width*a/p))/2,s=(e-(o=this.original_height*a/p))/2,t=r,e=o):(n=(t-r)/2,t=r)):(o=t/h,5===l?(1<(a=o*p/this.original_height)?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),n=(t-(r=this.original_width*a/p))/2,s=(e-(o=this.original_height*a/p))/2,t=r):s=(e-o)/2,e=o):this.isNWjs&&this.isNodeFullscreen&&0===this.fullscreen_mode_set&&(n=Math.floor((t-this.original_width)/2),s=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),l<2&&(this.aspect_scale=p),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*p),this.height=Math.round(e*p),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===l?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===l?(h=this.original_width/this.original_height,(c=this.lastWindowWidth/this.lastWindowHeight)<h?this.draw_width=this.draw_height*c:h<c&&(this.draw_height=this.draw_width/c)):3===l&&((h=this.original_width/this.original_height)<(c=this.lastWindowWidth/this.lastWindowHeight)?this.draw_width=this.draw_height*c:c<h&&(this.draw_height=this.draw_width/c))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(n)+"px","margin-top":Math.floor(s)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*p),this.canvas.height=Math.round(e*p),this.isEjecta?(this.canvas.style.left=Math.floor(n)+"px",this.canvas.style.top=Math.floor(s)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*p),this.overlay_canvas.height=Math.round(e*p),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*p),Math.round(e*p)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},i.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},i.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},i.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()},i.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova?jQuery(this.canvas).offset():jQuery(this.canvas).position();t.position="absolute",jQuery(this.overlay_canvas).css(t)}};var n=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;i.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&n&&n(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,e=this.logictime=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},i.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},i.prototype.GetObjectReference=function(t){return this.objectRefTable[t]};var b=!(i.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,n,s,r,o,a,h,c,l,u,p,d,f=t.project;if(this.name=f[0],this.first_layout=f[1],this.fullscreen_mode=f[12],this.fullscreen_mode_set=f[12],this.original_width=f[10],this.original_height=f[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(4<=f[12]||0===f[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=f[18],this.loaderstyle=f[19],0===this.loaderstyle){var g=new Image;g.crossOrigin="anonymous",this.setImageSrc(g,"loading-logo.png"),this.loaderlogos={logo:g}}else if(4===this.loaderstyle){var m=new Image;m.src="";var y=new Image;y.src="";var _=new Image;_.src="";var v=new Image;v.src="";var b=new Image;b.src="";var w=new Image;w.src="";var x=new Image;x.src="";var S=new Image;S.src="";var T=new Image;T.src="";var O=new Image;O.src="";var A=new Image;A.src="";var C=new Image;C.src="",this.loaderlogos={logo:[m,y,_,v],powered:[b,w,x,S],website:[T,O,A,C]}}for(this.next_uid=f[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),e=0,i=f[2].length;e<i;e++)a=f[2][e],u=this.GetObjectReference(a[0]),cr.add_common_aces(a,u.prototype),(p=new u(this)).singleglobal=a[1],p.is_world=a[2],p.is_rotatable=a[5],p.must_predraw=a[9],p.onCreate&&p.onCreate(),cr.seal(p),this.plugins.push(p);for(this.objectRefTable=cr.getObjectRefTable(),e=0,i=f[3].length;e<i;e++){for(a=f[3][e],d=this.GetObjectReference(a[1]),p=null,n=0,s=this.plugins.length;n<s;n++)if(this.plugins[n]instanceof d){p=this.plugins[n];break}var E=new p.Type(p);for(E.name=a[0],E.is_family=a[2],E.instvar_sids=a[3].slice(0),E.vars_count=a[3].length,E.behs_count=a[4],E.fx_count=a[5],E.sid=a[11],E.is_family?(E.members=[],E.family_index=this.family_count++,E.families=null):(E.members=null,E.family_index=-1,E.families=[]),E.family_var_map=null,E.family_beh_map=null,E.family_fx_map=null,E.is_contained=!1,E.container=null,a[6]?(E.texture_file=a[6][0],E.texture_filesize=a[6][1],E.texture_pixelformat=a[6][2]):(E.texture_file=null,E.texture_filesize=0,E.texture_pixelformat=0),a[7]?E.animations=a[7]:E.animations=null,E.index=e,E.instances=[],E.deadCache=[],E.solstack=[new cr.selection(E)],E.cur_sol=0,E.default_instance=null,E.default_layerindex=0,E.stale_iids=!0,E.updateIIDs=cr.type_updateIIDs,E.getFirstPicked=cr.type_getFirstPicked,E.getPairedInstance=cr.type_getPairedInstance,E.getCurrentSol=cr.type_getCurrentSol,E.pushCleanSol=cr.type_pushCleanSol,E.pushCopySol=cr.type_pushCopySol,E.popSol=cr.type_popSol,E.getBehaviorByName=cr.type_getBehaviorByName,E.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,E.getEffectIndexByName=cr.type_getEffectIndexByName,E.applySolToContainer=cr.type_applySolToContainer,E.getInstanceByIID=cr.type_getInstanceByIID,E.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),E.any_cell_changed=!0,E.any_instance_parallaxed=!1,E.extra={},E.toString=cr.type_toString,E.behaviors=[],n=0,s=a[8].length;n<s;n++){h=a[8][n];var k=this.GetObjectReference(h[1]),P=null;for(r=0,o=this.behaviors.length;r<o;r++)if(this.behaviors[r]instanceof k){P=this.behaviors[r];break}P||((P=new k(this)).my_types=[],P.my_instances=new cr.ObjectSet,P.onCreate&&P.onCreate(),cr.seal(P),this.behaviors.push(P),cr.behaviors.solid&&P instanceof cr.behaviors.solid&&(this.solidBehavior=P),cr.behaviors.jumpthru&&P instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=P),cr.behaviors.shadowcaster&&P instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=P)),-1===P.my_types.indexOf(E)&&P.my_types.push(E);var I=new P.Type(P,E);I.name=h[0],I.sid=h[2],I.onCreate(),cr.seal(I),E.behaviors.push(I)}for(E.global=a[9],E.isOnLoaderLayout=a[10],E.effect_types=[],n=0,s=a[12].length;n<s;n++)E.effect_types.push({id:a[12][n][0],name:a[12][n][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:n});if(E.tile_poly_data=a[13],this.uses_loader_layout&&!E.is_family&&!E.isOnLoaderLayout&&p.is_world||(E.onCreate(),cr.seal(E)),E.name&&(this.types[E.name]=E),this.types_by_index.push(E),p.singleglobal){var R=new p.Instance(E);R.uid=this.next_uid++,R.puid=this.next_puid++,R.iid=0,R.get_iid=cr.inst_get_iid,R.toString=cr.inst_toString,R.properties=a[14],R.onCreate(),cr.seal(R),E.instances.push(R),this.objectsByUid[R.uid.toString()]=R}}for(e=0,i=f[4].length;e<i;e++){var L,B=f[4][e],M=this.types_by_index[B[0]];for(n=1,s=B.length;n<s;n++)(L=this.types_by_index[B[n]]).families.push(M),M.members.push(L)}for(e=0,i=f[28].length;e<i;e++){var F=f[28][e],N=[];for(n=0,s=F.length;n<s;n++)N.push(this.types_by_index[F[n]]);for(n=0,s=N.length;n<s;n++)N[n].is_contained=!0,N[n].container=N}if(0<this.family_count)for(e=0,i=this.types_by_index.length;e<i;e++)if(!(c=this.types_by_index[e]).is_family&&c.families.length){c.family_var_map=new Array(this.family_count),c.family_beh_map=new Array(this.family_count),c.family_fx_map=new Array(this.family_count);var D=[],j=0,W=0,U=0;for(n=0,s=c.families.length;n<s;n++)for(l=c.families[n],c.family_var_map[l.family_index]=j,j+=l.vars_count,c.family_beh_map[l.family_index]=W,W+=l.behs_count,c.family_fx_map[l.family_index]=U,U+=l.fx_count,r=0,o=l.effect_types.length;r<o;r++)D.push(cr.shallowCopy({},l.effect_types[r]));for(c.effect_types=D.concat(c.effect_types),n=0,s=c.effect_types.length;n<s;n++)c.effect_types[n].index=n}for(e=0,i=f[5].length;e<i;e++){a=f[5][e];var G=new cr.layout(this,a);cr.seal(G),this.layouts[G.name]=G,this.layouts_by_index.push(G)}for(e=0,i=f[6].length;e<i;e++){a=f[6][e];var X=new cr.eventsheet(this,a);cr.seal(X),this.eventsheets[X.name]=X,this.eventsheets_by_index.push(X)}for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].postInit();for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].updateDeepIncludes();for(e=0,i=this.triggers_to_postinit.length;e<i;e++)this.triggers_to_postinit[e].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=f[7],this.files_subfolder=f[8],this.pixel_rounding=f[9],this.aspect_scale=1,this.enableWebGL=f[13],this.linearSampling=f[14],this.clearBackground=f[15],this.versionstr=f[16],this.useHighDpi=f[17],this.orientations=f[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=f[22],this.wantFullscreenScalingQuality=f[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=f[24],this.preloadSounds=f[25],this.projectName=f[26],this.enableFrontToBack=f[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()}),s=0,r=[];i.prototype.queueImageLoad=function(t,e){var i=this,n=function(){s--,i.maybeLoadNextImages()};t.addEventListener("load",n),t.addEventListener("error",n),r.push([t,e]),this.maybeLoadNextImages()},i.prototype.maybeLoadNextImages=function(){for(var t;r.length&&s<100;)s++,t=r.shift(),this.setImageSrc(t[0],t[1])},i.prototype.waitForImageLoad=function(e,i){e.cocoonLazyLoad=!0,e.onerror=function(t){e.c2error=!0,b=!0,console&&console.error&&console.error("Error loading image '"+e.src+"': ",t)},this.isEjecta?e.src=i:e.src||("undefined"!=typeof XAPKReader?XAPKReader.get(i,function(t){e.src=t},function(t){e.c2error=!0,b=!0,console&&console.error&&console.error("Error extracting image '"+i+"' from expansion file: ",t)}):(e.crossOrigin="anonymous",this.queueImageLoad(e,i))),this.wait_for_textures.push(e)};var h=0,c=!(i.prototype.findWaitingTexture=function(t){var e,i;for(e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null});i.prototype.getready=function(){this.audioInstance&&(h=this.audioInstance.setPreloadList(this.audio_to_preload))};var w=!(i.prototype.areAllTexturesAndSoundsLoaded=function(){var t,e,i,n=h,s=0,r=0,o=!0;for(t=0,e=this.wait_for_textures.length;t<e;t++){var a=(i=this.wait_for_textures[t]).cr_filesize;(!a||a<=0)&&(a=5e4),n+=a,i.src&&(i.complete||i.loaded)&&!i.c2error?s+=a:o=!1}return o&&this.preloadSounds&&this.audioInstance&&(c||(this.audioInstance.startPreloads(),c=!0),s+=r=this.audioInstance.getPreloadedSize(),r<h&&(o=!1)),this.progress=0==n?1:s/n,o});i.prototype.go=function(){if(this.ctx||this.glwrap){var t=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var e=window.innerWidth,i=window.innerHeight;this.lastWindowWidth===e&&this.lastWindowHeight===i||this.setSize(e,i),this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||w))this.go_loading_finished();else{var s=Date.now()-this.start_time;if(t){var r=this.width,o=this.height,a=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||500<=s&&this.last_progress!=this.progress)){t.clearRect(0,0,r,o);var h,c=r/2,l=o/2,u=0===this.loaderstyle&&this.loaderlogos.logo.complete,p=40*a,d=0,f=80*a;if(u){var g=this.loaderlogos.logo;p=(f=g.width*a)/2,d=(h=g.height*a)/2,t.drawImage(g,cr.floor(c-p),cr.floor(l-d),f,h)}if(this.loaderstyle<=1)l+=d+(u?12*a:0),c-=p,c=cr.floor(c)+.5,l=cr.floor(l)+.5,t.fillStyle=b?"red":"DodgerBlue",t.fillRect(c,l,Math.floor(f*this.progress),6*a),t.strokeStyle="black",t.strokeRect(c,l,f,6*a),t.strokeStyle="white",t.strokeRect(c-1*a,l-1*a,f+2*a,8*a);else if(2===this.loaderstyle){t.font=this.isEjecta?"12pt ArialMT":"12pt Arial",t.fillStyle=b?"#f00":"#999",t.textBaseLine="middle";var m=Math.round(100*this.progress)+"%",y=t.measureText?t.measureText(m):null,_=y?y.width:0;t.fillText(m,c-_/2,l)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(t),void(v?v(function(){n.go()}):setTimeout(function(){n.go()},16))}setTimeout(function(){n.go()},this.isCocoonJs?10:100)}}};var f=-1,g="undefined"==typeof cr_is_preview?200:0,m=!0,y=!1,_=0,x=0,S="undefined"==typeof cr_is_preview?3e3:0,T=null,O=null,A=0;function C(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}i.prototype.draw_c2_splash_loader=function(t){if(!w){for(var e=Math.ceil(this.width),i=Math.ceil(this.height),n=(this.devicePixelRatio,this.loaderlogos.logo),s=this.loaderlogos.powered,r=this.loaderlogos.website,o=0;o<4;++o)if(!n[o].complete||!s[o].complete||!r[o].complete)return;0===A&&(f=Date.now());var a,h,c,l,u=Date.now(),p=!1,d=t;m||y?(t.clearRect(0,0,e,i),c=e,l=i,T&&T.width===c&&T.height===l||((T=document.createElement("canvas")).width=c,T.height=l,O=T.getContext("2d")),d=O,p=!0,m&&1===A&&(f=Date.now())):t.globalAlpha=1,d.fillStyle="#333333",d.fillRect(0,0,e,i),256<this.cssHeight?(h=.25*(a=cr.clamp(.22*i,105,.6*e)),d.drawImage(C(s,a),.5*e-a/2,.2*i-h/2,a,h),h=a=Math.min(.395*i,.95*e),d.drawImage(C(n,a),.5*e-a/2,.485*i-h/2,a,h),h=.25*(a=cr.clamp(.22*i,105,.6*e)),d.drawImage(C(r,a),.5*e-a/2,.868*i-h/2,a,h),d.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),d.fillRect(0,.8*i-h/2,a,h),d.fillStyle=b?"red":"#E0FF65",a=e*this.progress,d.fillRect(.5*e-a/2,.8*i-h/2,a,h)):(h=a=.55*i,d.drawImage(C(n,a),.5*e-a/2,.45*i-h/2,a,h),d.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),d.fillRect(0,.85*i-h/2,a,h),d.fillStyle=b?"red":"#E0FF65",a=e*this.progress,d.fillRect(.5*e-a/2,.85*i-h/2,a,h)),p&&(m?t.globalAlpha=0===A?0:Math.min((u-f)/300,1):y&&(t.globalAlpha=Math.max(1-(u-x)/300,0)),t.drawImage(T,0,0,e,i)),m&&300<=u-f&&2<=A&&(m=!1,_=u),!m&&S<=u-_&&!y&&1<=this.progress&&(y=!0,x=u),(y&&300+g<=u-x||"undefined"!=typeof cr_is_preview&&1<=this.progress&&Date.now()-f<500)&&(y=m=!(w=!0),O=T=null,this.loaderlogos=null),++A}},i.prototype.go_loading_finished=function(){var t,e,i;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();if(2<=this.fullscreen_mode){var n=this.original_width/this.original_height,s=this.width/this.height;2!==this.fullscreen_mode&&n<s||2===this.fullscreen_mode&&s<n?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width}for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},i.prototype.tick=function(t,e,i){if(this.running_layout){var n=cr.performance_now(),s=n;if(i||!this.isSuspended||t){t||(v?this.raf_id=v(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var r=e||n,o=this.fullscreen_mode,a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if((a||this.isNodeFullscreen)&&0<this.fullscreen_scaling&&(o=this.fullscreen_scaling),0<o){var h=window.innerWidth,c=window.innerHeight;this.lastWindowWidth===h&&this.lastWindowHeight===c||this.setSize(h,c)}if(this.isDomFree||(a?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading){var l=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,l&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())}this.logic(r),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||t||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-s}}},i.prototype.logic=function(t){var e,i,n,s,r,o,a,h;1e3<=t-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=t-this.last_fps_time&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var c=0;if(0!==this.last_tick_time){var l=t-this.last_tick_time;l<0&&(l=0),c=l/1e3,this.dt1=c,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(c);var u=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;if(2<=this.fullscreen_mode||u&&0<this.fullscreen_scaling){var p=this.original_width/this.original_height,d=this.width/this.height,f=this.fullscreen_mode;u&&0<this.fullscreen_scaling&&(f=this.fullscreen_scaling),this.aspect_scale=2!==f&&p<d||2===f&&d<p?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var g=this.objects_to_pretick.valuesRef();for(e=0,i=g.length;e<i;e++)g[e].pretick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(n=0,s=a.instances.length;n<s;n++)for(r=0,o=(m=a.instances[n]).behavior_insts.length;r<o;r++)m.behavior_insts[r].tick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(n=0,s=a.instances.length;n<s;n++)for(r=0,o=(m=a.instances[n]).behavior_insts.length;r<o;r++)(h=m.behavior_insts[r]).posttick&&h.posttick();for(e=0,i=(g=this.objects_to_tick.valuesRef()).length;e<i;e++)g[e].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),e=0;this.changelayout&&e++<10;)this.doChangeLayout(this.changelayout);for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(n=0,s=a.instances.length;n<s;n++){var m;for(r=0,o=(m=a.instances[n]).behavior_insts.length;r<o;r++)(h=m.behavior_insts[r]).tick2&&h.tick2()}for(e=0,i=(g=this.objects_to_tick2.valuesRef()).length;e<i;e++)g[e].tick2();this.isInOnDestroy--},i.prototype.onWindowBlur=function(){var t,e,i,n,s,r,o,a,h;for(t=0,e=this.types_by_index.length;t<e;t++)if(!(o=this.types_by_index[t]).is_family)for(i=0,n=o.instances.length;i<n;i++)if((a=o.instances[i]).onWindowBlur&&a.onWindowBlur(),a.behavior_insts)for(s=0,r=a.behavior_insts.length;s<r;s++)(h=a.behavior_insts[s]).onWindowBlur&&h.onWindowBlur()},i.prototype.doChangeLayout=function(t){var e,i,n,s=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(n=this.types_by_index[e]).is_family||!n.unloadTextures||n.global&&0!==n.instances.length||-1!==t.initial_types.indexOf(n)||n.unloadTextures();s==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},i.prototype.runLayoutChangeMethods=function(t){var e,i,n,s,r,o,a,h,c,l;for(e=0,i=this.behaviors.length;e<i;e++)n=this.behaviors[e],t?n.onBeforeLayoutChange&&n.onBeforeLayoutChange():n.onLayoutChange&&n.onLayoutChange();for(e=0,i=this.types_by_index.length;e<i;e++)if((s=this.types_by_index[e]).global||s.plugin.singleglobal)for(r=0,o=s.instances.length;r<o;r++)if(a=s.instances[r],t?a.onBeforeLayoutChange&&a.onBeforeLayoutChange():a.onLayoutChange&&a.onLayoutChange(),a.behavior_insts)for(h=0,c=a.behavior_insts.length;h<c;h++)l=a.behavior_insts[h],t?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange()},i.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},i.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},i.prototype.tickMe=function(t){this.objects_to_tick.add(t)},i.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},i.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},i.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},i.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},i.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},i.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},i.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},i.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},i.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var d=[];i.prototype.DestroyInstance=function(t){var e,i,n=t.type.name,s=null;if(this.deathRow.hasOwnProperty(n)){if((s=this.deathRow[n]).contains(t))return}else s=d.length?d.pop():new cr.ObjectSet,this.deathRow[n]=s;if(s.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&s.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},i.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,n,s,r;for(this.isInClearDeathRow=!0,i=0,s=this.createRow.length;i<s;++i)for((e=(t=this.createRow[i]).type).instances.push(t),n=0,r=e.families.length;n<r;++n)e.families[n].instances.push(t),e.families[n].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},i.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},i.prototype.ClearDeathRowForType=function(t){var e,i,n,s,r,o,a,h,c=t.valuesRef(),l=c[0].type;for(cr.arrayRemoveAllFromObjectSet(l.instances,t),l.stale_iids=!0,0===l.instances.length&&(l.any_instance_parallaxed=!1),e=0,i=l.families.length;e<i;++e)o=l.families[e],cr.arrayRemoveAllFromObjectSet(o.instances,t),o.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((r=this.system.waits[e]).sols.hasOwnProperty(l.index)&&cr.arrayRemoveAllFromObjectSet(r.sols[l.index].insts,t),!l.is_family)for(n=0,s=l.families.length;n<s;++n)o=l.families[n],r.sols.hasOwnProperty(o.index)&&cr.arrayRemoveAllFromObjectSet(r.sols[o.index].insts,t);var u,p=c[0].layer;if(p){if(p.useRenderCells)for(e=0,i=(a=p.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),p.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<c.length;++e)this.ClearDeathRowForSingleInstance(c[e],l);(u=t).clear(),d.push(u),this.redraw=!0},i.prototype.ClearDeathRowForSingleInstance=function(t,e){var i,n,s;for(i=0,n=this.destroycallbacks.length;i<n;++i)this.destroycallbacks[i](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var r=t.layer;if(r&&r.removeFromInstanceList(t,!0),t.behavior_insts)for(i=0,n=t.behavior_insts.length;i<n;++i)(s=t.behavior_insts[i]).onDestroy&&s.onDestroy(),s.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},i.prototype.createInstance=function(t,e,i,n){if(t.is_family){var s=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[s],e,i,n)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,n,!1):null};var E=[];i.prototype.createInstanceFromInit=function(t,e,i,n,s,r){var o,a,h,c,l;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,f=e;for(p||(e=null),u.deadCache.length?((d=u.deadCache.pop()).recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u)).recycled=!1,!i||r||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],(this.objectsByUid[d.uid.toString()]=d).puid=this.next_puid++,d.iid=u.instances.length,o=0,a=this.createRow.length;o<a;++o)this.createRow[o].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString;var g,m=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},"undefined"!=typeof cr_is_preview)for(d.instance_var_names=[],d.instance_var_names.length=m.length,o=0,a=m.length;o<a;o++)d.instance_var_names[o]=m[o][1];d.instance_vars=[],d.instance_vars.length=m.length}for(o=0,a=m.length;o<a;o++)d.instance_vars[o]=m[o][0];if(p){var y=t[0];if(d.x=cr.is_undefined(n)?y[0]:n,d.y=cr.is_undefined(s)?y[1]:s,d.z=y[2],d.width=y[3],d.height=y[4],d.depth=y[5],d.angle=y[6],d.opacity=y[7],d.hotspotX=y[8],d.hotspotY=y[9],d.blend_mode=y[10],l=y[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=l),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(o=0,a=y[12].length;o<a;o++)for(h=0,c=y[12][o].length;h<c;h++)d.effect_params[o][h]=y[12][o][h];d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=y[12].slice(0),o=0,a=d.effect_params.length;o<a;o++)d.effect_params[o]=y[12][o].slice(0);d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,14===y.length&&(d.tilemap_exists=!0,d.tilemap_width=y[13][0],d.tilemap_height=y[13][1],d.tilemap_data=y[13][2]),o=0,a=u.effect_types.length;o<a;o++)d.active_effect_flags[o]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,void(d.earlyz_index=0)===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(E),o=0,a=u.families.length;o<a;o++)E.push.apply(E,u.families[o].behaviors);if(E.push.apply(E,u.behaviors),d.recycled)for(o=0,a=E.length;o<a;o++){var _=E[o];for((v=d.behavior_insts[o]).recycled=!0,_.behavior.Instance.call(v,_,d),h=0,c=(g=t[4][o]).length;h<c;h++)v.properties[h]=g[h];v.onCreate(),_.behavior.my_instances.add(d)}else for(d.behavior_insts=[],o=0,a=E.length;o<a;o++){var v;(v=new(_=E[o]).behavior.Instance(_,d)).recycled=!1,v.properties=t[4][o].slice(0),v.onCreate(),cr.seal(v),d.behavior_insts.push(v),_.behavior.my_instances.add(d)}if(g=t[5],d.recycled)for(o=0,a=g.length;o<a;o++)d.properties[o]=g[o];else d.properties=g.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!r){for(o=0,a=u.container.length;o<a;o++)if(u.container[o]!==u){if(!u.container[o].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[o].default_instance,f,!1,p?d.x:n,p?d.y:s,!0))}for(o=0,a=d.siblings.length;o<a;o++)for(d.siblings[o].siblings.push(d),h=0;h<a;h++)o!==h&&d.siblings[o].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),o=0,a=d.behavior_insts.length;o<a;o++)d.behavior_insts[o].postCreate&&d.behavior_insts[o].postCreate();return d},i.prototype.getLayerByName=function(t){var e,i;for(e=0,i=this.running_layout.layers.length;e<i;e++){var n=this.running_layout.layers[e];if(cr.equals_nocase(n.name,t))return n}return null},i.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},i.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},i.prototype.clearSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},i.prototype.pushCleanSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},i.prototype.pushCopySol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCopySol()},i.prototype.popSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].popSol()},i.prototype.updateAllCells=function(t){if(t.any_cell_changed){var e,i,n=t.instances;for(e=0,i=n.length;e<i;++e)n[e].update_collision_cell();var s=this.createRow;for(e=0,i=s.length;e<i;++e)s[e].type===t&&s[e].update_collision_cell();t.any_cell_changed=!1}},i.prototype.getCollisionCandidates=function(t,e,i,n){var s,r,o,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(s=0,r=e.members.length;s<r;++s)o=e.members[s],a||o.any_instance_parallaxed?cr.appendArray(n,o.instances):(this.updateAllCells(o),o.collision_grid.queryRange(i,n));else a||e.any_instance_parallaxed?cr.appendArray(n,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,n))},i.prototype.getTypesCollisionCandidates=function(t,e,i,n){var s,r;for(s=0,r=e.length;s<r;++s)this.getCollisionCandidates(t,e[s],i,n)},i.prototype.getSolidCollisionCandidates=function(t,e,i){var n=this.getSolidBehavior();if(!n)return null;this.getTypesCollisionCandidates(t,n.my_types,e,i)},i.prototype.getJumpthruCollisionCandidates=function(t,e,i){var n=this.getJumpthruBehavior();if(!n)return null;this.getTypesCollisionCandidates(t,n.my_types,e,i)},i.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,n){var s,r,o,a,h,c,l,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(n||(u.select_all=!1,cr.clearArray(u.instances)),s=0,a=t.instances.length;s<a;s++)if((o=t.instances[s]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(n)return!1;u.instances.push(o)}else p&&u.else_instances.push(o);else{for(s=r=0,a=(l=p?u.else_instances:u.instances).length;s<a;s++)if((o=l[s]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(n)return!1;p?u.instances.push(o):(u.instances[r]=u.instances[s],r++)}n||(l.length=r)}return t.applySolToContainer(),!!n||u.hasObjects()},i.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,n,s,r,o,a,h,c,l,u,p=t.layer,d=e.layer;if(p!==d&&(p.parallaxX!==d.parallaxX||d.parallaxY!=d.parallaxY||p.scale!==d.scale||p.angle!==d.angle||p.zoomRate!==d.zoomRate)){for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,n=l.pts_count;i<n;i++)r=(s=2*i)+1,o=l.pts_cache[s],a=l.pts_cache[r],l.pts_cache[s]=p.layerToCanvas(o+t.x,a+t.y,!0),l.pts_cache[r]=p.layerToCanvas(o+t.x,a+t.y,!1);for(l.update_bbox(),i=0,n=u.pts_count;i<n;i++)r=(s=2*i)+1,o=u.pts_cache[s],a=u.pts_cache[r],u.pts_cache[s]=d.layerToCanvas(o+e.x,a+e.y,!0),u.pts_cache[r]=d.layerToCanvas(o+e.x,a+e.y,!1);return u.update_bbox(),l.intersects_poly(u,0,0)}return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),l=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly),c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),u=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly),l.intersects_poly(u,e.x-t.x,e.y-t.y))))))};var p=new cr.quad,k=new cr.rect(0,0,0,0),P=[];i.prototype.testTilemapOverlap=function(t,e){var i,n,s,r,o=e.bbox,a=t.x,h=t.y;t.getCollisionRectCandidates(o,P);var c=P,l=e.collision_poly&&!e.collision_poly.is_empty();for(i=0,n=c.length;i<n;++i)if(r=(s=c[i]).rc,o.intersects_rect_off(r,a,h)&&(p.set_from_rect(r),p.offset(a,h),p.intersects_quad(e.bquad)))if(l){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),s.poly){if(s.poly.intersects_poly(e.collision_poly,e.x-(a+r.left),e.y-(h+r.top)))return cr.clearArray(P),!0}else if(this.temp_poly.set_from_quad(p,0,0,r.right-r.left,r.bottom-r.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(P),!0}else{if(!s.poly)return cr.clearArray(P),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),s.poly.intersects_poly(this.temp_poly,-(a+r.left),-(h+r.top)))return cr.clearArray(P),!0}return cr.clearArray(P),!1},i.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,P);var i,n,s,r,o=P,a=e.x,h=e.y;for(i=0,n=o.length;i<n;++i)if(r=(s=o[i]).rc,t.intersects_rect_off(r,a,h)){if(!s.poly)return cr.clearArray(P),!0;if(this.temp_poly.set_from_rect(t,0,0),s.poly.intersects_poly(this.temp_poly,-(a+r.left),-(h+r.top)))return cr.clearArray(P),!0}return cr.clearArray(P),!1}return p.set_from_rect(t),!!e.bquad.intersects_quad(p)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),p.offset(-t.left,-t.top),this.temp_poly.set_from_quad(p,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},i.prototype.testSegmentOverlap=function(t,e,i,n,s){if(!s||!s.collisionsEnabled)return!1;s.update_bbox();s.layer;if(k.set(cr.min(t,i),cr.min(e,n),cr.max(t,i),cr.max(e,n)),!s.bbox.intersects_rect(k))return!1;if(s.tilemap_exists){s.getCollisionRectCandidates(k,P);var r,o,a,h,c=P,l=s.x,u=s.y;for(r=0,o=c.length;r<o;++r)if(h=(a=c[r]).rc,k.intersects_rect_off(h,l,u)&&(p.set_from_rect(h),p.offset(l,u),p.intersects_segment(t,e,i,n))){if(!a.poly)return cr.clearArray(P),!0;if(a.poly.intersects_segment(l+h.left,u+h.top,t,e,i,n))return cr.clearArray(P),!0}return cr.clearArray(P),!1}return!!s.bquad.intersects_segment(t,e,i,n)&&(!(s.collision_poly&&!s.collision_poly.is_empty())||(s.collision_poly.cache_poly(s.width,s.height,s.angle),s.collision_poly.intersects_segment(s.x,s.y,t,e,i,n)))},i.prototype.typeHasBehavior=function(t,e){if(!e)return!1;var i,n,s,r,o;for(i=0,n=t.behaviors.length;i<n;i++)if(t.behaviors[i].behavior instanceof e)return!0;if(!t.is_family)for(i=0,n=t.families.length;i<n;i++)for(s=0,r=(o=t.families[i]).behaviors.length;s<r;s++)if(o.behaviors[s].behavior instanceof e)return!0;return!1},i.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},i.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},i.prototype.getSolidBehavior=function(){return this.solidBehavior},i.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var o=[];i.prototype.testOverlapSolid=function(t){var e,i,n;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,o),e=0,i=o.length;e<i;++e)if((n=o[e]).extra.solidEnabled&&this.testOverlap(t,n))return cr.clearArray(o),n;return cr.clearArray(o),null},i.prototype.testRectOverlapSolid=function(t){var e,i,n;for(this.getSolidCollisionCandidates(null,t,o),e=0,i=o.length;e<i;++e)if((n=o[e]).extra.solidEnabled&&this.testRectOverlap(t,n))return cr.clearArray(o),n;return cr.clearArray(o),null};var a=[];i.prototype.testOverlapJumpThru=function(t,e){var i,n,s,r=null;for(e&&(r=a,cr.clearArray(r)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,o),i=0,n=o.length;i<n;++i)if((s=o[i]).extra.jumpthruEnabled&&this.testOverlap(t,s)){if(!e)return cr.clearArray(o),s;r.push(s)}return cr.clearArray(o),r},i.prototype.pushOutSolid=function(t,e,i,n,s,r){var o,a=n||50,h=t.x,c=t.y,l=null,u=null;for(o=0;o<a;o++)if(t.x=h+e*o,t.y=c+i*o,t.set_bbox_changed(),!this.testOverlap(t,l)&&((l=this.testOverlapSolid(t))&&(u=l),!l&&(s&&(l=r?this.testOverlap(t,r)?r:null:this.testOverlapJumpThru(t))&&(u=l),!l)))return u&&this.pushInFractional(t,e,i,u,16),!0;return t.x=h,t.y=c,t.set_bbox_changed(),!1},i.prototype.pushOutSolidAxis=function(t,e,i,n){n=n||50;var s,r,o,a=t.x,h=t.y,c=null,l=null;for(s=0;s<n;++s)for(r=0;r<2;++r)if(o=2*r-1,t.x=a+e*s*o,t.y=h+i*s*o,t.set_bbox_changed(),!this.testOverlap(t,c)){if(!(c=this.testOverlapSolid(t)))return l&&this.pushInFractional(t,e*o,i*o,l,16),!0;l=c}return t.x=a,t.y=h,t.set_bbox_changed(),!1},i.prototype.pushOut=function(t,e,i,n,s){var r,o=n||50,a=t.x,h=t.y;for(r=0;r<o;r++)if(t.x=a+e*r,t.y=h+i*r,t.set_bbox_changed(),!this.testOverlap(t,s))return!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},i.prototype.pushInFractional=function(t,e,i,n,s){for(var r,o=2,a=!1,h=!1,c=t.x,l=t.y;o<=s;)r=1/o,o*=2,t.x+=e*r*(a?1:-1),t.y+=i*r*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,n)?h=a=!0:(h=a=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},i.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,n=0,s=t.x,r=t.y,o=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;n<=i;){switch(o){case 0:a=0,h=-1,n++;break;case 1:h=-(a=1);break;case 2:a=1,h=0;break;case 3:h=a=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:h=a=-1}if(o=(o+1)%8,t.x=cr.floor(s+a*n),t.y=cr.floor(r+h*n),t.set_bbox_changed(),!this.testOverlap(t,c)&&!(c=this.testOverlapSolid(t)))return!0}return t.x=s,t.y=r,t.set_bbox_changed(),!1},i.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},i.prototype.addRegisteredCollisionCandidates=function(t,e,i){var n,s,r,o;for(n=0,s=this.registered_collisions.length;n<s;++n){if((r=this.registered_collisions[n])[0]===t)o=r[1];else{if(r[1]!==t)continue;o=r[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(o.type!==e)continue;-1===i.indexOf(o)&&i.push(o)}},i.prototype.checkRegisteredCollision=function(t,e){var i,n,s;for(i=0,n=this.registered_collisions.length;i<n;i++)if((s=this.registered_collisions[i])[0]===t&&s[1]===e||s[0]===e&&s[1]===t)return!0;return!1},i.prototype.calculateSolidBounceAngle=function(t,e,i,n){var s=t.x,r=t.y,o=cr.max(10,cr.distanceTo(e,i,s,r)),a=cr.angleTo(e,i,s,r),h=n||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);var c,l,u,p,d=h,f=cr.to_radians(5);for(c=1;c<36;c++)if(l=a-c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=n?null:this.testOverlapSolid(t))){u=l;break}36===c&&(u=cr.clamp_angle(a+cr.PI));d=h;for(c=1;c<36;c++)if(l=a+c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=n?null:this.testOverlapSolid(t))){p=l;break}if(36===c&&(p=cr.clamp_angle(a+cr.PI)),t.x=s,t.y=r,t.set_bbox_changed(),p===u)return p;var g,m=cr.angleDiff(p,u)/2;g=cr.angleClockwise(p,u)?cr.clamp_angle(u+m+cr.PI):cr.clamp_angle(p+m);var y=Math.cos(a),_=Math.sin(a),v=Math.cos(g),b=Math.sin(g),w=y*v+_*b,x=y-2*w*v,S=_-2*w*b;return cr.angleTo(0,0,x,S)};var I=-1;function l(){try{return!!window.indexedDB}catch(t){return!1}}function u(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function R(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location=window.location+"?continuous"}function L(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}i.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var n=this.running_layout.event_sheet;if(!n)return!1;var s,r,o,a=!1;I++;var h=n.deep_includes;for(r=0,o=h.length;r<o;++r)s=this.triggerOnSheet(t,e,h[r],i),a=a||s;return s=this.triggerOnSheet(t,e,n,i),I--,a=a||s},i.prototype.triggerOnSheet=function(t,e,i,n){var s,r,o,a,h=!1;if(e)for(o=this.triggerOnSheetForTypeName(t,e,e.type.name,i,n),h=h||o,s=0,r=(a=e.type.families).length;s<r;++s)o=this.triggerOnSheetForTypeName(t,e,a[s].name,i,n),h=h||o;else o=this.triggerOnSheetForTypeName(t,e,"system",i,n),h=h||o;return h},i.prototype.triggerOnSheetForTypeName=function(t,e,i,n,s){var r,o,a,h,c=!1,l=!1,u=void 0!==s,p=(u?n.fasttriggers:n.triggers)[i];if(!p)return c;var d,f=null;for(r=0,o=p.length;r<o;++r)if(p[r].method==t){f=p[r].evs;break}if(!f)return c;if(!(d=u?f[s]:f))return null;for(r=0,o=d.length;r<o;r++)a=d[r][0],h=d[r][1],l=this.executeSingleTrigger(e,i,a,h),c=c||l;return c},i.prototype.executeSingleTrigger=function(t,e,i,n){var s,r,o=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=1<this.trigger_depth;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c=this.pushEventStack(i);if(c.current_event=i,t){var l=this.types[e].getCurrentSol();l.select_all=!1,cr.clearArray(l.instances),l.instances[0]=t,this.types[e].applySolToContainer()}var u=!0;if(i.parent){for(var p=c.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),s=0,r=p.length;s<r;s++)if(!p[s].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(n):i.run(),o=o||c.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===I&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},i.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},i.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},i.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},i.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},i.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},i.prototype.popLocalVarStack=function(){this.localvar_stack_index--},i.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},i.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},i.prototype.popEventStack=function(){this.event_stack_index--},i.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},i.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},i.prototype.popLoopStack=function(){this.loop_stack_index--},i.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},i.prototype.getEventVariableByName=function(t,e){for(var i,n,s,r,o,a;e;){for(i=0,n=e.subevents.length;i<n;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,n=this.eventsheets_by_index.length;i<n;i++)for(s=0,r=(o=this.eventsheets_by_index[i]).events.length;s<r;s++)if((a=o.events[s])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},i.prototype.getLayoutBySid=function(t){var e,i;for(e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},i.prototype.getObjectTypeBySid=function(t){var e,i;for(e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},i.prototype.getGroupBySid=function(t){var e,i;for(e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},i.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},i.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},i.prototype.handleSaveLoad=function(){var i=this,t=this.saveToSlot,n=this.lastSaveJson,e=this.loadFromSlot,s=!1;if(this.signalledContinuousPreview&&(s=!0,t="__c2_continuouspreview",this.signalledContinuousPreview=!1),t.length){if(this.ClearDeathRow(),n=this.saveToJSONString(),l()&&!this.isCocoonJs)!function(i,n,s,r){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=u,t.onerror=r,t.onsuccess=function(t){var e=t.target.result;e.onerror=r,e.transaction(["saves"],"readwrite").objectStore("saves").put({slot:i,data:n}).onsuccess=s}}catch(t){r(t)}}(t,n,function(){cr.logexport("Saved state to IndexedDB storage ("+n.length+" bytes)"),i.lastSaveJson=n,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&R()},function(e){try{localStorage.setItem("__c2save_"+t,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),i.lastSaveJson=n,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&R()}catch(t){cr.logexport("Failed to save game state: "+e+"; "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+t,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),i.lastSaveJson=n,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&R()}catch(t){cr.logexport("Error saving to WebStorage: "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(e.length){if(l()&&!this.isCocoonJs)!function(n,s,r){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=u,t.onerror=r,t.onsuccess=function(t){var e=t.target.result;e.onerror=r;var i=e.transaction(["saves"]).objectStore("saves").get(n);i.onsuccess=function(t){i.result?s(i.result.data):s(null)}}}catch(t){r(t)}}(e,function(t){t?(i.loadFromJson=t,cr.logexport("Loaded state from IndexedDB storage ("+i.loadFromJson.length+" bytes)")):(i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)")),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(t){i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)"),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},i.prototype.saveToJSONString=function(){var t,e,i,n,s,r,o,a,h,c,l,u,p={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};for(t=0,e=this.types_by_index.length;t<e;t++)if(!(s=this.types_by_index[t]).is_family&&!this.typeHasNoSaveBehavior(s)){for(o={instances:[]},cr.hasAnyOwnProperty(s.extra)&&(o.ex=L(s.extra)),i=0,n=s.instances.length;i<n;i++)o.instances.push(this.saveInstanceToJSON(s.instances[i]));p.types[s.sid.toString()]=o}for(t=0,e=this.layouts_by_index.length;t<e;t++)r=this.layouts_by_index[t],p.layouts[r.sid.toString()]=r.saveToJSON();var d=p.events.groups;for(t=0,e=this.allGroups.length;t<e;t++)d[(a=this.allGroups[t]).sid.toString()]=this.groups_by_name[a.group_name].group_active;var f=p.events.cnds;for(u in this.cndsBySid)this.cndsBySid.hasOwnProperty(u)&&(h=this.cndsBySid[u],cr.hasAnyOwnProperty(h.extra)&&(f[u]={ex:L(h.extra)}));var g=p.events.acts;for(u in this.actsBySid)this.actsBySid.hasOwnProperty(u)&&(c=this.actsBySid[u],cr.hasAnyOwnProperty(c.extra)&&(g[u]={ex:L(c.extra)}));var m=p.events.vars;for(u in this.varsBySid)this.varsBySid.hasOwnProperty(u)&&((l=this.varsBySid[u]).is_constant||l.parent&&!l.is_static||(m[u]=l.data));return p.system=this.system.saveToJSON(),JSON.stringify(p)},i.prototype.refreshUidMap=function(){var t,e,i,n,s,r;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(n=0,s=i.instances.length;n<s;n++)r=i.instances[n],this.objectsByUid[r.uid.toString()]=r},i.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(1<e.version)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var n,s,r,o,a,h,c,l,u,p,d,f,g,m,y,_,v,b=i.running_layout;if(b!==this.running_layout.sid){var w=this.getLayoutBySid(b);if(!w)return;this.doChangeLayout(w)}var x=e.types;for(c in x)if(x.hasOwnProperty(c)){if(!(l=this.getObjectTypeBySid(parseInt(c,10)))||l.is_family||this.typeHasNoSaveBehavior(l))continue;for(x[c].ex?l.extra=x[c].ex:cr.wipe(l.extra),u=l.instances,p=x[c].instances,n=0,s=cr.min(u.length,p.length);n<s;n++)this.loadInstanceFromJSON(u[n],p[n]);for(n=p.length,s=u.length;n<s;n++)this.DestroyInstance(u[n]);for(n=u.length,s=p.length;n<s;n++)m=null,l.plugin.is_world&&!(m=this.running_layout.getLayerBySid(p[n].w.l))||(d=this.createInstanceFromInit(l.default_instance,m,!1,0,0,!0),this.loadInstanceFromJSON(d,p[n]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var S=e.layouts;for(c in S)if(S.hasOwnProperty(c)){if(!(g=this.getLayoutBySid(parseInt(c,10))))continue;g.loadFromJSON(S[c])}var T=e.events.groups;for(c in T)T.hasOwnProperty(c)&&(y=this.getGroupBySid(parseInt(c,10)))&&this.groups_by_name[y.group_name]&&this.groups_by_name[y.group_name].setGroupActive(T[c]);var O=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(O.hasOwnProperty(c)?this.cndsBySid[c].extra=O[c].ex:this.cndsBySid[c].extra={});var A=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(A.hasOwnProperty(c)?this.actsBySid[c].extra=A[c].ex:this.actsBySid[c].extra={});var C=e.events.vars;for(c in C)C.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=C[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,n=0,s=this.fireOnCreateAfterLoad.length;n<s;++n)d=this.fireOnCreateAfterLoad[n],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),n=0,s=this.types_by_index.length;n<s;n++)if(!(l=this.types_by_index[n]).is_family&&!this.typeHasNoSaveBehavior(l))for(r=0,o=l.instances.length;r<o;r++){if(d=l.instances[r],l.is_contained)for(_=d.get_iid(),cr.clearArray(d.siblings),a=0,h=l.container.length;a<h;a++)l!==(v=l.container[a])&&d.siblings.push(v.instances[_]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(a=0,h=d.behavior_insts.length;a<h;a++)(f=d.behavior_insts[a]).afterLoad&&f.afterLoad()}return this.redraw=!0},i.prototype.saveInstanceToJSON=function(t,e){var i,n,s,r,o,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=L(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,n=t.instance_vars.length;i<n;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(s={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(s.a=t.angle),1!==t.opacity&&(s.o=t.opacity),.5!==t.hotspotX&&(s.hX=t.hotspotX),.5!==t.hotspotY&&(s.hY=t.hotspotY),0!==t.blend_mode&&(s.bm=t.blend_mode),t.visible||(s.v=t.visible),t.collisionsEnabled||(s.ce=t.collisionsEnabled),-1!==t.my_timescale&&(s.mts=t.my_timescale),a.effect_types.length)for(s.fx=[],i=0,n=a.effect_types.length;i<n;i++)o=a.effect_types[i],s.fx.push({name:o.name,active:t.active_effect_flags[o.index],params:t.effect_params[o.index]});c.w=s}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,n=t.behavior_insts.length;i<n;i++)(r=t.behavior_insts[i]).saveToJSON&&(c.behs[r.type.sid.toString()]=r.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},i.prototype.getInstanceVarIndexBySid=function(t,e){var i,n;for(i=0,n=t.instvar_sids.length;i<n;i++)if(t.instvar_sids[i]===e)return i;return-1},i.prototype.getBehaviorIndexBySid=function(t,e){var i,n;for(i=0,n=t.behavior_insts.length;i<n;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},i.prototype.loadInstanceFromJSON=function(t,e,i){var n,s,r,o,a,h,c,l,u,p,d,f=t.type,g=f.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(n in a)if(a.hasOwnProperty(n)){if((o=this.getInstanceVarIndexBySid(f,parseInt(n,10)))<0||o>=t.instance_vars.length)continue;null===(p=a[n])&&(p=NaN),t.instance_vars[o]=p}if(g.is_world){if(h=e.w,t.layer.sid!==h.l&&(d=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(d.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=d,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(s=0,r=h.fx.length;s<r;s++)(c=f.getEffectIndexByName(h.fx[s].name))<0||(t.active_effect_flags[c]=h.fx[s].active,t.effect_params[c]=h.fx[s].params);t.updateActiveEffects()}if(l=e.behs)for(n in l)if(l.hasOwnProperty(n)){if((u=this.getBehaviorIndexBySid(t,parseInt(n,10)))<0)continue;t.behavior_insts[u].loadFromJSON(l[n])}e.data&&t.loadFromJSON(e.data)},i.prototype.fetchLocalFileViaCordova=function(t,e,i){var n=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(n,function(t){t.file(e,i)},i)},i.prototype.fetchLocalFileViaCordovaAsText=function(t,i,n){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.onerror=n,e.readAsText(t)},n)};var B=[],M=0;i.prototype.maybeStartNextArrayBufferRead=function(){if(B.length&&!(8<=M)){M++;var t=B.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)}},i.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var n=this;B.push({filename:t,successCallback:function(t){M--,n.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){M--,n.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},i.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,i,e){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.readAsArrayBuffer(t)},e)},i.prototype.fetchLocalFileViaCordovaAsURL=function(t,n,e){var s="",i=t.toLowerCase(),r=i.substr(i.length-4),o=i.substr(i.length-5);".mp4"===r?s="video/mp4":".webm"===o?s="video/webm":".m4a"===r?s="audio/mp4":".mp3"===r&&(s="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){var e=new Blob([t],{type:s}),i=URL.createObjectURL(e);n(i)},e)},i.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},i.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(t){alert("Failed to load image: "+t)}):e.src=t},i.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=i,cr.createRuntime=function(t){return new i(document.getElementById(t))},cr.createDCRuntime=function(t,e){return new i({dc:!0,width:t,height:e})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);var e=new i(t);return window.c2runtime=e,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),e},window.createEjectaRuntime=function(){var t=new i(document.getElementById("canvas"));return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime?window.c2runtime:null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){if(0!==t&&0!==e){var i=window.cr_getC2Runtime();i&&i.setSize(t,e)}},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,n,s=e[6];for(this.layers=[],this.initial_types=[],i=0,n=s.length;i<n;i++){var r=new cr.layer(this,s[i]);r.number=i,cr.seal(r),this.layers.push(r)}var o=e[7];for(this.initial_nonworld=[],i=0,n=o.length;i<n;i++){var a=o[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[8].length;i<n;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){var e,i,n;for(e=0,i=this.effect_types.length;e<i;e++)if((n=this.effect_types[e]).name===t)return n;return null};var m=[];function y(t,e){return t.zindex-e.zindex}var _=!0;t.prototype.startRunning=function(){var t,e,i,n,s,r,o,a,h,c,l,u,p,d;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),(this.runtime.running_layout=this).width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,i=this.runtime.types_by_index.length;t<i;t++)if(!(s=this.runtime.types_by_index[t]).is_family)for(e=0,n=(r=s.instances).length;e<n;e++)if((a=r[e]).layer){var f=a.layer.number;f>=this.layers.length&&(f=this.layers.length-1),a.layer=this.layers[f],-1===a.layer.instances.indexOf(a)&&a.layer.instances.push(a),a.layer.zindices_stale=!0}if(!_)for(t=0,i=this.layers.length;t<i;++t)this.layers[t].instances.sort(y);for(cr.clearArray(m),this.boundScrolling(),t=0,i=this.layers.length;t<i;t++)(d=this.layers[t]).createInitialInstances(),d.updateViewport(null);var g=!1;if(!this.first_visit){for(u in this.persist_data)if(this.persist_data.hasOwnProperty(u)){if(!(s=this.runtime.getObjectTypeBySid(parseInt(u,10)))||s.is_family||!this.runtime.typeHasPersistBehavior(s))continue;for(t=0,i=(p=this.persist_data[u]).length;t<i;t++)d=null,s.plugin.is_world&&!(d=this.getLayerBySid(p[t].w.l))||(a=this.runtime.createInstanceFromInit(s.default_instance,d,!1,0,0,!0),this.runtime.loadInstanceFromJSON(a,p[t]),g=!0,m.push(a));cr.clearArray(p)}for(t=0,i=this.layers.length;t<i;t++)this.layers[t].instances.sort(y),this.layers[t].zindices_stale=!0}for(g&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<m.length;t++)if((a=m[t]).type.is_contained)for(h=a.get_iid(),e=0,n=a.type.container.length;e<n;e++)c=a.type.container[e],a.type!==c&&(c.instances.length>h?a.siblings.push(c.instances[h]):c.default_instance&&(l=this.runtime.createInstanceFromInit(c.default_instance,a.layer,!0,a.x,a.y,!0),this.runtime.ClearDeathRow(),c.updateIIDs(),a.siblings.push(l),m.push(l)));for(t=0,i=this.initial_nonworld.length;t<i;t++)o=this.initial_nonworld[t],(s=this.runtime.types_by_index[o[1]]).is_contained||(a=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,i=this.runtime.types_by_index.length;t<i;t++)!(c=this.runtime.types_by_index[t]).is_family&&c.instances.length&&c.preloadCanvas2D&&c.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,m);else for(t=0,i=m.length;t<i;t++)a=m[t],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);cr.clearArray(m),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){var t,e,i,n,s;for(e=t=0,i=this.initial_nonworld.length;t<i;t++)n=this.initial_nonworld[t],(s=this.runtime.types_by_index[n[1]]).global?s.is_contained||this.runtime.createInstanceFromInit(n,null,!0):(this.initial_nonworld[e]=n,e++);cr.truncateArray(this.initial_nonworld,e)},t.prototype.stopRunning=function(){var t,e,i,n,s,r,o;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,n=(s=this.layers[t].instances).length;i<n;i++)(r=s[i]).type.global||this.runtime.typeHasPersistBehavior(r.type)&&this.saveObjectToPersist(r);for(t=0,e=this.layers.length;t<e;t++){for(i=0,n=(s=this.layers[t].instances).length;i<n;i++)(r=s[i]).type.global||this.runtime.DestroyInstance(r);this.runtime.ClearDeathRow(),cr.clearArray(s),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((o=this.runtime.types_by_index[t]).global||o.plugin.is_world||o.plugin.singleglobal||o.is_family)){for(i=0,n=o.instances.length;i<n;i++)this.runtime.DestroyInstance(o.instances[i]);this.runtime.ClearDeathRow()}_=!1,this.runtime.isEndingLayout=!1};var a=new cr.rect(0,0,0,0);function e(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=h(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,n,s=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,n=s.length;i<n;i++){var r=s[i],o=this.runtime.types_by_index[r[1]];o.default_instance||(o.default_instance=r,o.default_layerindex=this.index),this.initial_instances.push(r),-1===this.layout.initial_types.indexOf(o)&&this.layout.initial_types.push(o)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[15].length;i<n;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}t.prototype.recreateInitialObjects=function(t,e,i,n,s){var r,o;for(a.set(e,i,n,s),r=0,o=this.layers.length;r<o;r++)this.layers[r].recreateInitialObjects(t,a)},t.prototype.draw=function(t){var e,i,n,s,r=t,o=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),o=!0),e=this.runtime.layout_canvas,r=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(r,this.runtime.linearSampling)),r.globalAlpha=1,r.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&r.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,n=this.layers.length;i<n;i++)(s=this.layers[i]).visible&&0<s.opacity&&11!==s.blend_mode&&(s.instances.length||!s.transparent)?s.draw(r):s.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;0<=e;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,n,s=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(s?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(n=this.layers[e]).visible&&0<n.opacity&&(n.instances.length||!n.transparent)?n.drawGL(t):n.updateViewport(null);if(s)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var r=this.active_effect_types[0].index;t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[r]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else t.switchProgram(0);this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView();var o=this.runtime.width/2,a=this.runtime.height/2;t.quad(-o,a,o,a,o,-a,-o,-a),t.setTexture(null),t.setDepthTestEnabled(!0)}else this.renderEffectChain(t,null,null,null)},t.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){var t,e,i,n=this.layers[0].getScale();for(t=1,e=this.layers.length;t<e;t++)0===(i=this.layers[t]).parallaxX&&0===i.parallaxY||i.getScale()<n&&(n=i.getScale());return n},t.prototype.scrollToX=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_width*(1/this.getMinLayerScale())/2;t>this.width-e&&(t=this.width-e),t<e&&(t=e)}this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_height*(1/this.getMinLayerScale())/2;t>this.height-e&&(t=this.height-e),t<e&&(t=e)}this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,n){var s=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,r=1,o=0,a=0,h=0,c=this.runtime.draw_width,l=this.runtime.draw_height;i?(r=i.layer.getScale(),o=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,c=i.layer.viewRight,l=i.layer.viewBottom):e&&(r=e.getScale(),o=e.getAngle(),a=e.viewLeft,h=e.viewTop,c=e.viewRight,l=e.viewBottom);var u,p,d,f,g,m=this.runtime.fx_tex,y=0,_=1,v=this.runtime.draw_width,b=this.runtime.draw_height,w=v/2,x=b/2,S=e?e.rcTex:this.rcTex,T=e?e.rcTex2:this.rcTex2,O=0,A=0,C=0,E=0,k=v,P=v,I=b,R=b,L=0,B=0,M=i?i.layer.getAngle():0;if(i){for(u=0,p=s.length;u<p;u++)L+=t.getProgramBoxExtendHorizontal(s[u].shaderindex),B+=t.getProgramBoxExtendVertical(s[u].shaderindex);var F=i.bbox;if(O=e.layerToCanvas(F.left,F.top,!0,!0),C=e.layerToCanvas(F.left,F.top,!1,!0),k=e.layerToCanvas(F.right,F.bottom,!0,!0),I=e.layerToCanvas(F.right,F.bottom,!1,!0),0!==M){var N=e.layerToCanvas(F.right,F.top,!0,!0),D=e.layerToCanvas(F.right,F.top,!1,!0),j=e.layerToCanvas(F.left,F.bottom,!0,!0),W=e.layerToCanvas(F.left,F.bottom,!1,!0);d=Math.min(O,k,N,j),k=Math.max(O,k,N,j),O=d,d=Math.min(C,I,D,W),I=Math.max(C,I,D,W),C=d}O-=L,C-=B,k+=L,I+=B,T.left=O/v,T.top=1-C/b,T.right=k/v,T.bottom=1-I/b,A=O=cr.floor(O),E=C=cr.floor(C),P=k=cr.ceil(k),R=I=cr.ceil(I),O<0&&(O=0),C<0&&(C=0),v<k&&(k=v),b<I&&(I=b),(A-=L)<0&&(A=0),(E-=B)<0&&(E=0),v<(P+=L)&&(P=v),b<(R+=B)&&(R=b),S.left=O/v,S.top=1-C/b,S.right=k/v,S.bottom=1-I/b}else S.left=T.left=0,S.top=T.top=0,S.right=T.right=1,S.bottom=T.bottom=1;var U=i&&(t.programUsesDest(s[0].shaderindex)||0!==L||0!==B||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),U&&(m[y]||(m[y]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),m[y].c2width===v&&m[y].c2height===b||(t.deleteTexture(m[y]),m[y]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(m[y]),f=b-E-(g=R-E),t.clearRect(A,f,P-A,g),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-w,-x),t.updateModelView(),t.quadTex(O,I,k,I,k,C,O,C,S)),T.left=T.top=0,T.right=T.bottom=1,i&&(d=S.top,S.top=S.bottom,S.bottom=d),y=1,_=0),t.setOpacity(1);var G=s.length-1,X=t.programUsesCrossSampling(s[G].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,z=0;for(u=0,p=s.length;u<p;u++){if(m[y]||(m[y]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),m[y].c2width===v&&m[y].c2height===b||(t.deleteTexture(m[y]),m[y]=t.createEmptyTexture(v,b,this.runtime.linearSampling)),t.switchProgram(s[u].shaderindex),z=s[u].index,t.programIsAnimated(s[u].shaderindex)&&(this.runtime.redraw=!0),0!=u||U)t.setProgramParameters(n,1/v,1/b,T.left,T.top,T.right,T.bottom,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i?i.effect_params[z]:e?e.effect_params[z]:this.effect_params[z]),t.setTexture(null),u!==G||X?(t.setRenderingToTexture(m[y]),f=b-E-(g=R-E),t.clearRect(A,f,P-A,g)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(n)),t.setTexture(m[_]),t.resetModelView(),t.translate(-w,-x),t.updateModelView(),t.quadTex(O,I,k,I,k,C,O,C,S),u!==G||X||t.setTexture(null);else{if(t.setRenderingToTexture(m[y]),f=b-E-(g=R-E),t.clearRect(A,f,P-A,g),i){var V,q;if(i.curFrame&&i.curFrame.texture_img){var J=i.curFrame.texture_img;V=1/J.width,q=1/J.height}else V=1/i.width,q=1/i.height;t.setProgramParameters(n,V,q,T.left,T.top,T.right,T.bottom,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i.effect_params[z]),i.drawGL(t)}else t.setProgramParameters(n,1/v,1/b,0,0,1,1,r,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,e?e.effect_params[z]:this.effect_params[z]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-w,-x),t.updateModelView(),t.quadTex(O,I,k,I,k,C,O,C,S);T.left=T.top=0,T.right=T.bottom=1,i&&!X&&(d=I,I=C,C=d)}_=0===(y=0===y?1:0)?1:0}X&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),w=this.runtime.width/2,x=this.runtime.height/2,C=O=0,k=this.runtime.width,I=this.runtime.height),t.setRenderingToTexture(n),t.setTexture(m[_]),t.resetModelView(),t.translate(-w,-x),t.updateModelView(),i&&1===s.length&&!U?t.quadTex(O,C,k,C,k,I,O,I,S):t.quadTex(O,I,k,I,k,C,O,C,S),t.setTexture(null))},t.prototype.getLayerBySid=function(t){var e,i;for(e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){var t,e,i,n,s={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};for(t=0,e=this.effect_types.length;t<e;t++)n=this.effect_types[t],s.fx.push({name:n.name,active:n.active,params:this.effect_params[n.index]});for(t=0,e=this.layers.length;t<e;t++)i=this.layers[t],s.layers[i.sid.toString()]=i.saveToJSON();return s},t.prototype.loadFromJSON=function(t){var e,i,n,s,r;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);var o=t.fx;for(e=0,i=o.length;e<i;e++)(n=this.getEffectByName(o[e].name))&&(n.active=o[e].active,this.effect_params[n.index]=o[e].params);this.updateActiveEffects();var a=t.layers;for(s in a)if(a.hasOwnProperty(s)){if(!(r=this.getLayerBySid(parseInt(s,10))))continue;r.loadFromJSON(a[s])}},cr.layout=t,e.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(t){var e,i,n;for(e=0,i=this.effect_types.length;e<i;e++)if((n=this.effect_types[e]).name===t)return n;return null},e.prototype.createInitialInstances=function(){var t,e,i,n,s,r,o;for(e=t=0,i=this.initial_instances.length;t<i;t++){if(s=this.initial_instances[t],r=this.runtime.types_by_index[s[1]],o=!0,!this.runtime.typeHasPersistBehavior(r)||this.layout.first_visit){if(!(n=this.runtime.createInstanceFromInit(s,this,!0)))continue;m.push(n),n.type.global&&(o=!1,this.created_globals.push(n.uid))}o&&(this.initial_instances[e]=this.initial_instances[t],e++)}this.initial_instances.length=e,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},e.prototype.recreateInitialObjects=function(t,e){var i,n,s,r,o,a,h,c,l,u,p,d=this.runtime.types_by_index,f=t.is_family,g=t.members;for(i=0,n=this.initial_instances.length;i<n;++i)if(a=(o=(s=this.initial_instances[i])[0])[0],h=o[1],e.contains_pt(a,h)){if((r=d[s[1]])!==t){if(!f)continue;if(g.indexOf(r)<0)continue}if(c=this.runtime.createInstanceFromInit(s,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(r.plugin).cnds.OnCreated,c),c.is_contained)for(l=0,u=c.siblings.length;l<u;l++)p=c.siblings[i],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--}},e.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},e.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},e.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},e.prototype.moveInstanceAdjacent=function(t,e,i){var n=t.get_zindex(),s=e.get_zindex();cr.arrayRemove(this.instances,n),n<s&&s--,i&&s++,s===this.instances.length?this.instances.push(t):this.instances.splice(s,0,t),this.setZIndicesStaleFrom(n<s?n:s)},e.prototype.setZIndicesStaleFrom=function(t){-1===this.zindices_stale_from?this.zindices_stale_from=t:t<this.zindices_stale_from&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},e.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},e.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},e.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},e.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var i=[];function h(){return i.length?i.pop():[]}function d(t){cr.clearArray(t),i.push(t)}function c(t,e,i){var n,s,r=0,o=0,a=0,h=t.length,c=e.length;for(i.length=h+c;r<h&&o<c;++a)n=t[r],s=e[o],n.zindex<s.zindex?(i[a]=n,++r):(i[a]=s,++o);for(;r<h;++r,++a)i[a]=t[r];for(;o<c;++o,++a)i[a]=e[o]}var l=[];function n(t,e){var i,n,s,r,o;for(i=0,n=t.length;i<n-1;i+=2)c(s=t[i],r=t[i+1],o=h()),e||(d(s),d(r)),l.push(o);n%2==1&&(e?(s=h(),cr.shallowAssignArray(s,t[n-1]),l.push(s)):l.push(t[n-1])),cr.shallowAssignArray(t,l),cr.clearArray(l)}var s=[];e.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,s),!s.length)return h();if(1===s.length){var t=h();return cr.shallowAssignArray(t,s[0]),cr.clearArray(s),t}var e=function(t){for(var e=!0;1<t.length;)n(t,e),e=!1;return t[0]}(s);return cr.clearArray(s),e},e.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,n=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),n=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,n=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,n=!0),n&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),r=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),r=Math.round(r)),this.rotateViewport(s,r,i);var o,a=this.getScale();i.scale(a,a),i.translate(-s,-r),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;var h,c,l,u=null;for(h=0,c=o.length;h<c;++h)(l=o[h])!==u&&(this.drawInstance(l,i),u=l);this.useRenderCells&&(this.last_render_list=o),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},e.prototype.drawInstance=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e))}},e.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},e.prototype.rotateViewport=function(t,e,i){var n,s=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/s),this.viewBottom=e+this.runtime.draw_height*(1/s),this.viewLeft>this.viewRight&&(n=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=n),this.viewTop>this.viewBottom&&(n=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=n);var r=this.getAngle();0!==r&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-r),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,r),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},e.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var n,s=this.getScale();t.resetModelView(),t.scale(s,s),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;var r,o,a=null;for(r=n.length-1;0<=r;--r)(o=n[r])!==a&&(this.drawInstanceGL_earlyZPass(n[r],t),a=o);this.useRenderCells&&(this.last_render_list=n),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},e.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var n=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(n=Math.round(n),s=Math.round(s)),this.rotateViewport(n,s,null);var r,o=this.getScale();t.resetModelView(),t.scale(o,o),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;var a,h,c,l=null;for(a=0,h=r.length;a<h;++a)(c=r[a])!==l&&(this.drawInstanceGL(r[a],t),l=c);if(this.useRenderCells&&(this.last_render_list=r),this.render_offscreen)if(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity){1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,o,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView();var u=this.runtime.draw_width/2,p=this.runtime.draw_height/2;t.quad(-u,p,u,p,u,-p,-u,-p),t.setTexture(null)}else this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget())},e.prototype.drawInstanceGL=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e)))}},e.prototype.drawInstanceGL_earlyZPass=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e)))}},e.prototype.drawInstanceWithShadersGL=function(t,e){var i=t.active_effect_types[0].shaderindex,n=t.active_effect_types[0].index,s=this.getScale();if(1!==t.active_effect_types.length||e.programUsesCrossSampling(i)||e.programExtendsBox(i)||(t.angle||t.layer.getAngle())&&e.programUsesDest(i)||1!==t.opacity||t.type.plugin.must_predraw)this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(s,s),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();else{e.switchProgram(i),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(i)&&(this.runtime.redraw=!0);var r,o,a=0,h=0,c=0,l=0;if(e.programUsesDest(i)){var u=t.bbox,p=this.layerToCanvas(u.left,u.top,!0,!0),d=this.layerToCanvas(u.left,u.top,!1,!0),f=this.layerToCanvas(u.right,u.bottom,!0,!0),g=this.layerToCanvas(u.right,u.bottom,!1,!0);a=p/windowWidth,h=1-d/windowHeight,c=f/windowWidth,l=1-g/windowHeight}if(t.curFrame&&t.curFrame.texture_img){var m=t.curFrame.texture_img;r=1/m.width,o=1/m.height}else r=1/t.width,o=1/t.height;e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),r,o,a,h,c,l,s,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[n]),t.drawGL(e)}},e.prototype.canvasToLayer=function(t,e,i,n){var s=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=s,e*=s);var r=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,a=(this.layout.scrollX-r)*this.parallaxX+r,h=(this.layout.scrollY-o)*this.parallaxY+o,c=a,l=h,u=1/this.getScale(!n);n?(c-=this.runtime.draw_width*u/2,l-=this.runtime.draw_height*u/2):(c-=this.runtime.width*u/2,l-=this.runtime.height*u/2),c+=t*u,l+=e*u;var p=this.getAngle();if(0!==p){c-=a,l-=h;var d=Math.cos(p),f=Math.sin(p),g=c*d-l*f;l=l*d+c*f,c=g,c+=a,l+=h}return i?c:l},e.prototype.layerToCanvas=function(t,e,i,n){var s=this.runtime.parallax_x_origin,r=this.runtime.parallax_y_origin,o=(this.layout.scrollX-s)*this.parallaxX+s,a=(this.layout.scrollY-r)*this.parallaxY+r,h=o,c=a,l=this.getAngle();if(0!==l){t-=o,e-=a;var u=Math.cos(-l),p=Math.sin(-l),d=t*u-e*p;e=e*u+t*p,t=d,t+=o,e+=a}var f=1/this.getScale(!n);n?(h-=this.runtime.draw_width*f/2,c-=this.runtime.draw_height*f/2):(h-=this.runtime.width*f/2,c-=this.runtime.height*f/2),h=(t-h)/f,c=(e-c)/f;var g=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!n&&(h/=g,c/=g),i?h:c},e.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var n=this.layerToCanvas(t,e,!0),s=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var r=this.canvasToLayer(n,s,!0),o=this.canvasToLayer(n,s,!0);return this.disableAngle=!1,i?r:o},e.prototype.saveToJSON=function(){var t,e,i,n={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};for(t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],n.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});return n},e.prototype.loadFromJSON=function(t){var e,i,n,s;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var r=new cr.ObjectSet;for(e=0,n=this.created_globals.length;e<n;++e)r.add(this.created_globals[e]);for(i=e=0,n=this.initial_instances.length;e<n;++e)r.contains(this.initial_instances[e][2])||(this.initial_instances[i]=this.initial_instances[e],++i);cr.truncateArray(this.initial_instances,i);var o=t.fx;for(e=0,n=o.length;e<n;e++)(s=this.getEffectByName(o[e].name))&&(s.active=o[e].active,this.effect_params[s.index]=o[e].params);this.updateActiveEffects(),this.instances.sort(y),this.zindices_stale=!0},cr.layer=e}(),function(){var o=[];function a(t,e){var i,n=t.length;switch(n){case 0:return!0;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}function h(t,e){return t.index-e.index}function s(t){var e,i,n,s,r;for(2===t.length?t[0].index>t[1].index&&(s=t[0],t[0]=t[1],t[1]=s):2<t.length&&t.sort(h),t.length>=o.length&&(o.length=t.length+1),o[t.length]||(o[t.length]=[]),e=0,i=(r=o[t.length]).length;e<i;e++)if(a(t,n=r[e]))return n;return r.push(t),t}function t(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,n,s=e[1];for(this.events=[],i=0,n=s.length;i<n;i++)this.init_event(s[i],null,this.events)}function e(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function i(t,e,i){var n,s;this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var r=i[5];for(n=0,s=r.length;n<s;n++){var o=new cr.condition(this,r[n]);o.index=n,cr.seal(o),this.conditions.push(o),this.addSolModifier(o.type)}var a=i[6];for(n=0,s=a.length;n<s;n++){var h=new cr.action(this,a[n]);h.index=n,cr.seal(h),this.actions.push(h)}if(8===i.length){var c=i[7];for(n=0,s=c.length;n<s;n++)this.sheet.init_event(c[n],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function n(t,e){var i,n,s;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,n=t.container.length;i<n;i++)t!==(s=t.container[i])&&-1===e.indexOf(s)&&e.push(s)}function r(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=0<e[3],this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){var i,n,s=e[9];for(i=0,n=s.length;i<n;i++){var r=new cr.parameter(this,s[i]);cr.seal(r),this.parameters.push(r)}this.results.length=s.length}}function c(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){var i,n,s=e[5];for(i=0,n=s.length;i<n;i++){var r=new cr.parameter(this,s[i]);cr.seal(r),this.parameters.push(r)}this.results.length=s.length}}t.prototype.toString=function(){return this.name},t.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var n,s,r=new cr.eventblock(this,e,t);if(cr.seal(r),r.orblock)for(i.push(r),n=0,s=r.conditions.length;n<s;n++)r.conditions[n].trigger&&this.init_trigger(r,n);else r.is_trigger()?this.init_trigger(r,0):i.push(r);break;case 1:var o=new cr.eventvariable(this,e,t);cr.seal(o),i.push(o);break;case 2:var a=new cr.eventinclude(this,e,t);cr.seal(a),i.push(a)}},t.prototype.postInit=function(){var t,e;for(t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},t.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},t.prototype.addDeepIncludes=function(t){var e,i,n,s,r=t.deep_includes,o=t.already_included_sheets,a=this.includes.valuesRef();for(e=0,i=a.length;e<i;++e)s=(n=a[e]).include_sheet,!n.isActive()||t===s||-1<o.indexOf(s)||(o.push(s),s.addDeepIncludes(t),r.push(s))},t.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var n=this.events[e];n.run(),this.runtime.clearSol(n.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},t.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i,n=t.conditions[e];i=n.type?n.type.name:"system";var s=n.fasttrigger,r=s?this.fasttriggers:this.triggers;r[i]||(r[i]=[]);var o,a=r[i],h=n.func;if(s){if(!n.parameters.length)return;var c,l=n.parameters[0];if(1!==l.type||2!==l.expression.type)return;var u,p,d=l.expression.value.toLowerCase();for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return void((c=a[u].evs)[d]?c[d].push([t,e]):c[d]=[[t,e]]);(c={})[d]=[[t,e]],a.push({method:h,evs:c})}else{for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return void a[u].evs.push([t,e]);o=h,cr.plugins_.Sprite&&o===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?a.unshift({method:h,evs:[[t,e]]}):a.push({method:h,evs:[[t,e]]})}},cr.eventsheet=t,e.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},e.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},e.prototype.pick_one=function(t){if(t)if(t.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1);var e=this.else_instances.indexOf(t);-1!==e&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t},cr.selection=e,window._c2hh_="A721850C2F06C299DE12B209139075BB55190AF8",i.prototype.postInit=function(t){var e,i,n=this.parent;if(this.group)for(this.toplevelgroup=!0;n;){if(!n.group){this.toplevelgroup=!1;break}n=n.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),n=this.parent;n;){for(e=0,i=n.solModifiers.length;e<i;e++)this.addParentSolModifier(n.solModifiers[e]);n=n.parent}for(this.solModifiers=s(this.solModifiers),this.solModifiersIncludingParents=s(this.solModifiersIncludingParents),e=0,i=this.conditions.length;e<i;e++)this.conditions[e].postInit();for(e=0,i=this.actions.length;e<i;e++)this.actions[e].postInit();for(e=0,i=this.subevents.length;e<i;e++)this.subevents[e].postInit(e<i-1&&this.subevents[e+1].is_else_block)},i.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();0<i&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},i.prototype.addSolModifier=function(t){n(t,this.solModifiers)},i.prototype.addParentSolModifier=function(t){n(t,this.solModifiersIncludingParents)},i.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},i.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},i.prototype.run=function(){var t,e,i=!1,n=this.runtime,s=this.runtime.getCurrentEventStack(),r=(s.current_event=this).conditions;if(this.is_else_block||(s.else_branch_ran=!1),this.orblock){for(0===r.length&&(i=!0),s.cndindex=0,t=r.length;s.cndindex<t;s.cndindex++)(e=r[s.cndindex]).trigger||e.run()&&(i=!0);(s.last_event_true=i)&&this.run_actions_and_subevents()}else{for(s.cndindex=0,t=r.length;s.cndindex<t;s.cndindex++)if(!r[s.cndindex].run())return s.last_event_true=!1,void(this.toplevelevent&&n.hasPendingInstances&&n.ClearDeathRow());s.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(s)},i.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},i.prototype.run_orblocktrigger=function(t){(this.runtime.getCurrentEventStack().current_event=this).conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},i.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.resume_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,n,s=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(n=!this.toplevelgroup||!this.group&&t<s)&&this.runtime.pushCopySol(i.solModifiers),i.run(),n?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},i.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},i.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},i.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;0<=e;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=i,r.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},r.prototype.run_true=function(){return!0},r.prototype.run_system=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},r.prototype.run_static=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},r.prototype.run_object=function(){var t,e,i,n,s,r,o,a,h,c,l,u,p=this.type,d=p.getCurrentSol(),f=this.block.orblock&&!this.trigger,g=0,m=p.is_contained,y=p.is_family,_=p.family_index,v=this.beh_index,b=-1<v,w=this.anyParamVariesPerInstance,x=this.parameters,S=this.results,T=this.inverted,O=this.func;if(w)for(e=0,s=x.length;e<s;++e)(r=x[e]).variesPerInstance||(S[e]=r.get(0));else for(e=0,s=x.length;e<s;++e)S[e]=x[e].get(0);if(d.select_all){for(cr.clearArray(d.instances),cr.clearArray(d.else_instances),t=0,n=(l=p.instances).length;t<n;++t){if(a=l[t],w)for(e=0,s=x.length;e<s;++e)(r=x[e]).variesPerInstance&&(S[e]=r.get(t));b?(g=0,y&&(g=a.type.family_beh_map[_]),o=O.apply(a.behavior_insts[v+g],S)):o=O.apply(a,S),cr.xor(o,T)?d.instances.push(a):f&&d.else_instances.push(a)}return p.finish&&p.finish(!0),d.select_all=!1,p.applySolToContainer(),d.hasObjects()}i=0;var A=f&&!this.block.isFirstConditionOfType(this),C=!1;for(t=0,n=(l=A?d.else_instances:d.instances).length;t<n;++t){if(a=l[t],w)for(e=0,s=x.length;e<s;++e)(r=x[e]).variesPerInstance&&(S[e]=r.get(t));if(b?(g=0,y&&(g=a.type.family_beh_map[_]),o=O.apply(a.behavior_insts[v+g],S)):o=O.apply(a,S),cr.xor(o,T))if(C=!0,A){if(d.instances.push(a),m)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().instances.push(h)}else{if(l[i]=a,m)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().instances[i]=h;i++}else if(A){if(l[i]=a,m)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances[i]=h;i++}else if(f&&(d.else_instances.push(a),m))for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances.push(h)}if(cr.truncateArray(l,i),m)for(t=0,n=(u=p.container).length;t<n;t++)c=u[t].getCurrentSol(),A?cr.truncateArray(c.else_instances,i):cr.truncateArray(c.instances,i);var E=C;if(A&&!C)for(t=0,n=d.instances.length;t<n;t++){if(a=d.instances[t],w)for(e=0,s=x.length;e<s;e++)(r=x[e]).variesPerInstance&&(S[e]=r.get(t));if(o=b?O.apply(a.behavior_insts[v],S):O.apply(a,S),cr.xor(o,T)){C=!0;break}}return p.finish&&p.finish(E||f),f?C:d.hasObjects()},cr.condition=r,c.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},c.prototype.run_system=function(){var t,e,i=this.runtime,n=this.parameters,s=this.results;for(t=0,e=n.length;t<e;++t)s[t]=n[t].get();return this.func.apply(i.system,s)},c.prototype.run_object=function(){var t,e,i,n,s,r,o,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,f=a.getCurrentSol().getObjects(),g=a.is_family,m=-1<h;if(l)for(e=0,n=u.length;e<n;++e)(s=u[e]).variesPerInstance||(p[e]=s.get(0));else for(e=0,n=u.length;e<n;++e)p[e]=u[e].get(0);for(t=0,i=f.length;t<i;++t){if(r=f[t],l)for(e=0,n=u.length;e<n;++e)(s=u[e]).variesPerInstance&&(p[e]=s.get(t));m?(o=0,g&&(o=r.type.family_beh_map[c]),d.apply(r.behavior_insts[h+o],p)):d.apply(r,p)}return!1},cr.action=c;var l=[],u=-1;function p(){return u++,l.length===u&&l.push(new cr.expvalue),l[u]}function d(){u--}function f(t,e){var i,n,s;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,n=e.length;i<n;i++)s=new cr.parameter(this.owner,e[i]),cr.seal(s),this.subparams.push(s),this.variadicret.push(0)}}function g(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],(this.runtime.varsBySid[this.sid.toString()]=this).data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function m(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function y(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}f.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},f.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},f.prototype.setVaries=function(){this.variesPerInstance=!0},f.prototype.get_exp=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.data},f.prototype.get_exp_str=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),cr.is_string(e.data)?e.data:""},f.prototype.get_object=function(){return this.object},f.prototype.get_combosel=function(){return this.combosel},f.prototype.get_layer=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},f.prototype.get_layout=function(){return this.layout},f.prototype.get_key=function(){return this.key},f.prototype.get_instvar=function(){return this.index},f.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,n=null,s=i.getCurrentSol(),r=s.getObjects();if(r.length)n=r[e%r.length].type;else if(s.else_instances.length)n=s.else_instances[e%s.else_instances.length].type;else{if(!i.instances.length)return 0;n=i.instances[e%i.instances.length].type}return this.index+n.family_var_map[i.family_index]},f.prototype.get_eventvar=function(){return this.eventvar},f.prototype.get_audiofile=function(){return this.fileinfo},f.prototype.get_variadic=function(){var t,e;for(t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=f,g.prototype.postInit=function(){this.solModifiers=s(this.solModifiers)},g.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},g.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length?this.initial:void 0===t[this.localIndex]?this.initial:t[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g,m.prototype.toString=function(){return"include:"+this.include_sheet.toString()},m.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=s(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},m.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},m.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},m.prototype.isActive=function(){return this.active},cr.eventinclude=m,y.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},y.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=y}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i,n,s=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(s=e[2],this.results.length=s.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(s=e[5],this.results.length=s.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(s=e[6],this.results.length=s.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),s)for(i=0,n=s.length;i<n;i++)this.parameters.push(new cr.expNode(t,s[i]));cr.seal(this)}t.prototype.postInit=function(){var t,e;if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function f(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function g(){--i}function m(t,e,i){var n,s;for(n=0,s=t.length;n<s;++n)t[n].get(i),e[n+1]=i.data}function n(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,m(e,i,f()),g(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,n=this.parameters,s=this.instance_expr,r=this.func,o=this.owner.solindex,a=e.getCurrentSol(),h=a.getObjects();if(!h.length){if(!a.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));h=a.else_instances}(i[0]=t).object_class=e;var c=f();m(n,i,c),s&&(s.get(c),c.is_number()&&(o=c.data,h=e.instances)),g();var l=h.length;(l<=o||o<=-l)&&(o%=l),o<0&&(o+=l);r.apply(h[o],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,n=this.parameters,s=this.instance_expr,r=this.beh_index,o=this.func,a=this.owner.solindex,h=e.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}(i[0]=t).object_class=e;var l=f();m(n,i,l),s&&(s.get(l),l.is_number()&&(a=l.data,c=e.instances)),g();var u=c.length;(u<=a||a<=-u)&&(a%=u),a<0&&(a+=u);var p=c[a],d=0;e.is_family&&(d=p.type.family_beh_map[e.family_index]);o.apply(p.behavior_insts[r+d],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,n=this.object_type,s=this.varindex,r=this.owner.solindex,o=n.getCurrentSol(),a=o.getObjects();if(!a.length){if(!o.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));a=o.else_instances}if(i){var h=f();if(i.get(h),h.is_number()){r=h.data;var c=n.instances;0!==c.length&&(r%=c.length)<0&&(r+=c.length);var l=(e=n.getInstanceByIID(r)).instance_vars[s];return cr.is_string(l)?t.set_string(l):t.set_float(l),void g()}g()}var u=a.length;(u<=r||r<=-u)&&(r%=u),r<0&&(r+=u),e=a[r];var p=0;n.is_family&&(p=e.type.family_var_map[n.family_index]);l=e.instance_vars[s+p];cr.is_string(l)?t.set_string(l):t.set_float(l)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),g()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),g()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),g()},t.prototype.eval_divide=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),g()},t.prototype.eval_mod=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),g()},t.prototype.eval_power=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),g()},t.prototype.eval_and=function(t){this.first.get(t);var e=f();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),g()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=f();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),g()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data===e.data?1:0),g()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data!==e.data?1:0),g()},t.prototype.eval_less=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data<e.data?1:0),g()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data<=e.data?1:0),g()},t.prototype.eval_greater=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data>e.data?1:0),g()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=f();this.second.get(e),t.set_int(t.data>=e.data?1:0),g()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,n.prototype.is_int=function(){return this.type===cr.exptype.Integer},n.prototype.is_float=function(){return this.type===cr.exptype.Float},n.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},n.prototype.is_string=function(){return this.type===cr.exptype.String},n.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},n.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},n.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},n.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},n.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},n.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},n.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=n,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var t,e,i,n,s,r,o,a,h={};h.waits=[];var c,l=h.waits;for(t=0,e=this.waits.length;t<e;t++){for(c={t:(r=this.waits[t]).time,st:r.signaltag,s:r.signalled,ev:r.ev.sid,sm:[],sols:{}},r.ev.actions[r.actindex]&&(c.act=r.ev.actions[r.actindex].sid),i=0,n=r.solModifiers.length;i<n;i++)c.sm.push(r.solModifiers[i].sid);for(s in r.sols)if(r.sols.hasOwnProperty(s)){for(o=this.runtime.types_by_index[parseInt(s,10)],a={sa:r.sols[s].sa,insts:[]},i=0,n=r.sols[s].insts.length;i<n;i++)a.insts.push(r.sols[s].insts[i].uid);c.sols[o.sid.toString()]=a}l.push(c)}return h},cr.system_object.prototype.loadFromJSON=function(t){var e,i,n,s,r,o,a,h,c,l,u,p,d,f=t.waits;for(cr.clearArray(this.waits),e=0,i=f.length;e<i;e++)if(o=f[e],h=this.runtime.blocksBySid[o.ev.toString()]){for(c=-1,n=0,s=h.actions.length;n<s;n++)if(h.actions[n].sid===o.act){c=n;break}if(-1!==c){for((a={sols:{},solModifiers:[],deleteme:!1}).time=o.t,a.signaltag=o.st||"",a.signalled=!!o.s,a.ev=h,a.actindex=c,n=0,s=o.sm.length;n<s;n++)(l=this.runtime.getObjectTypeBySid(o.sm[n]))&&a.solModifiers.push(l);for(r in o.sols)if(o.sols.hasOwnProperty(r)){if(!(l=this.runtime.getObjectTypeBySid(parseInt(r,10))))continue;for(p={sa:(u=o.sols[r]).sa,insts:[]},n=0,s=u.insts.length;n<s;n++)(d=this.runtime.getObjectByUID(u.insts[n]))&&p.insts.push(d);a.sols[l.index.toString()]=p}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0===t){var n=this.runtime.getCurrentCondition();return!n.extra.CompareTime_executed&&e<=i&&(n.extra.CompareTime_executed=!0)}return cr.do_cmp(i,t,e)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),n=i.current_event,s=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(s)for(e=0;e<t&&!r.stopped;e++)this.runtime.pushCopySol(n.solModifiers),r.index=e,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(e=0;e<t&&!r.stopped;e++)r.index=e,n.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),n=i.current_event,s=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(s)for(e=0;!r.stopped;e++)this.runtime.pushCopySol(n.solModifiers),r.index=e,n.retrigger()||(r.stopped=!0),this.runtime.popSol(n.solModifiers);else for(e=0;!r.stopped;e++)r.index=e,n.retrigger()||(r.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var n,s=this.runtime.getCurrentEventStack(),r=s.current_event,o=s.isModifierAfterCnds(),a=this.runtime.pushLoopStack(t);if(i<e)if(o)for(n=e;i<=n&&!a.stopped;--n)this.runtime.pushCopySol(r.solModifiers),a.index=n,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(n=e;i<=n&&!a.stopped;--n)a.index=n,r.retrigger();else if(o)for(n=e;n<=i&&!a.stopped;++n)this.runtime.pushCopySol(r.solModifiers),a.index=n,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(n=e;n<=i&&!a.stopped;++n)a.index=n,r.retrigger();return this.runtime.popLoopStack(),!1};var _=[],v=-1;function b(t,e){var i=t.extra.c2_feo_val,n=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(n)?i-n:(i=""+i)<(n=""+n)?-1:n<i?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();v++,_.length===v&&_.push([]);var i=_[v];cr.shallowAssignArray(i,e.getObjects());var n,s,r,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,p=l.isModifierAfterCnds(),d=this.runtime.pushLoopStack(),f=t.is_contained;if(p)for(n=0,s=i.length;n<s&&!d.stopped;n++){if(this.runtime.pushCopySol(u.solModifiers),a=i[n],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=a,f)for(r=0,o=a.siblings.length;r<o;r++)(c=(h=a.siblings[r]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=n,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),n=0,s=i.length;n<s&&!d.stopped;n++){if(a=i[n],e.instances[0]=a,f)for(r=0,o=a.siblings.length;r<o;r++)(c=(h=a.siblings[r]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=n,u.retrigger()}return cr.clearArray(i),this.runtime.popLoopStack(),v--,!1},e.prototype.ForEachOrdered=function(t,e,i){var n=t.getCurrentSol();v++,_.length===v&&_.push([]);var s=_[v];cr.shallowAssignArray(s,n.getObjects());var r,o,a,h,c,l,u,p=this.runtime.getCurrentEventStack(),d=p.current_event,f=this.runtime.getCurrentCondition(),g=p.isModifierAfterCnds(),m=this.runtime.pushLoopStack();for(r=0,o=s.length;r<o;r++)s[r].extra.c2_feo_val=f.parameters[1].get(r);s.sort(b),1===i&&s.reverse();var y=t.is_contained;if(g)for(r=0,o=s.length;r<o&&!m.stopped;r++){if(this.runtime.pushCopySol(d.solModifiers),c=s[r],(n=t.getCurrentSol()).select_all=!1,cr.clearArray(n.instances),n.instances[0]=c,y)for(a=0,h=c.siblings.length;a<h;a++)(u=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=l;m.index=r,d.retrigger(),this.runtime.popSol(d.solModifiers)}else for(n.select_all=!1,cr.clearArray(n.instances),r=0,o=s.length;r<o&&!m.stopped;r++){if(c=s[r],n.instances[0]=c,y)for(a=0,h=c.siblings.length;a<h;a++)(u=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=l;m.index=r,d.retrigger()}return cr.clearArray(s),this.runtime.popLoopStack(),v--,!1},e.prototype.PickByComparison=function(t,e,i,n){var s,r,o,a;if(t){v++,_.length===v&&_.push([]);var h=_[v],c=t.getCurrentSol();cr.shallowAssignArray(h,c.getObjects()),c.select_all&&cr.clearArray(c.else_instances);var l=this.runtime.getCurrentCondition();for(o=s=0,r=h.length;s<r;s++)a=h[s],h[o]=a,e=l.parameters[1].get(s),n=l.parameters[3].get(s),cr.do_cmp(e,i,n)?o++:c.else_instances.push(a);return cr.truncateArray(h,o),c.select_all=!1,cr.shallowAssignArray(c.instances,h),cr.clearArray(h),v--,t.applySolToContainer(),!!c.instances.length}},e.prototype.PickByEvaluate=function(t,e){var i,n,s,r;if(t){v++,_.length===v&&_.push([]);var o=_[v],a=t.getCurrentSol();cr.shallowAssignArray(o,a.getObjects()),a.select_all&&cr.clearArray(a.else_instances);var h=this.runtime.getCurrentCondition();for(s=i=0,n=o.length;i<n;i++)r=o[i],o[s]=r,h.parameters[1].get(i)?s++:a.else_instances.push(r);return cr.truncateArray(o,s),a.select_all=!1,cr.shallowAssignArray(a.instances,o),cr.clearArray(o),v--,t.applySolToContainer(),!!a.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,n=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var s=e.extra.Every_seconds;return i+s<=n?(e.extra.Every_lastTime=i+s,n>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=n),e.extra.Every_seconds=t,!0):(n<i-.1&&(e.extra.Every_lastTime=n),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),n=i.getObjects();if((e=cr.floor(e))<0||e>=n.length)return!1;var s=n[e];return i.pick_one(s),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),n=cr.floor(Math.random()*i.length);if(n>=i.length)return!1;var s=i[n];return e.pick_one(s),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return e<=t&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var i=null,n="",s="";function o(t,e){return i&&t===n&&e===s||(i=new RegExp(t,e),n=t,s=e),i.lastIndex=0,i}e.prototype.RegexTest=function(t,e,i){return o(e,i).test(t)};var l=[];function r(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var n,s,r,o=t.getCurrentSol(),a=o.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,c=this.runtime.getCurrentCondition();for(o.select_all?(cr.shallowAssignArray(l,a),cr.clearArray(o.else_instances),o.select_all=!1,cr.clearArray(o.instances)):h?(cr.shallowAssignArray(l,o.else_instances),cr.clearArray(o.else_instances)):(cr.shallowAssignArray(l,a),cr.clearArray(o.instances)),n=0,s=l.length;n<s;++n)(r=l[n]).update_bbox(),cr.xor(r.contains_pt(e,i),c.inverted)?o.instances.push(r):o.else_instances.push(r);return t.applySolToContainer(),cr.xor(!!o.instances.length,c.inverted)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){var n=cr.to_clamped_radians(t),s=cr.to_clamped_radians(e),r=cr.to_clamped_radians(i);return!cr.angleClockwise(r,s)?!(!cr.angleClockwise(n,s)&&cr.angleClockwise(n,r)):cr.angleClockwise(n,s)&&!cr.angleClockwise(n,r)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,r.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},r.prototype.NextPrevLayout=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout){var e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if((!t||0!==e)&&(t||e!==this.runtime.layouts_by_index.length-1)){var i=this.runtime.layouts_by_index[e+(t?-1:1)];this.runtime.changelayout=i}}},r.prototype.CreateObject=function(t,e,i,n){if(e&&t){var s=this.runtime.createInstance(t,e,i,n);if(s){var r,o,a;if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,s),s.is_contained)for(r=0,o=s.siblings.length;r<o;r++)a=s.siblings[r],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),(h.instances[0]=s).is_contained)for(r=0,o=s.siblings.length;r<o;r++)(h=(a=s.siblings[r]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=a}}},r.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},r.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},r.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},r.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},r.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},r.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},r.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},r.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},r.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},r.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},r.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},r.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},r.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},r.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},r.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t){var n,s,r=t.getCurrentSol().getObjects();for(n=0,s=r.length;n<s;n++)r[n].my_timescale=i}},r.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;var e,i,n=t.getCurrentSol().getObjects();for(e=0,i=n.length;e<i;e++)n[e].my_timescale=-1};var u=[];function h(){var t;return(t=u.length?u.pop():{sols:{},solModifiers:[]}).deleteme=!1,t}var p=[];function c(){var t;return(t=p.length?p.pop():{insts:[]}).sa=!1,t}function f(t,e){var i=t[0]-e[0];return 0!==i?i:t[1]-e[1]}function g(t,e){return t[1]-e[1]}function a(){}r.prototype.Wait=function(t){if(!(t<0)){var e,i,n,s,r,o=this.runtime.getCurrentEventStack(),a=h();for(a.time=this.runtime.kahanTime.sum+t,a.signaltag="",a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(n=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(r=c()).sa=n.select_all,cr.shallowAssignArray(r.insts,n.instances),a.sols[e.toString()]=r);return this.waits.push(a),!0}},r.prototype.WaitForSignal=function(t){var e,i,n,s,r,o=this.runtime.getCurrentEventStack(),a=h();for(a.time=-1,a.signaltag=t.toLowerCase(),a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(n=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(r=c()).sa=n.select_all,cr.shallowAssignArray(r.insts,n.instances),a.sols[e.toString()]=r);return this.waits.push(a),!0},r.prototype.Signal=function(t){var e,i,n,s=t.toLowerCase();for(e=0,i=this.waits.length;e<i;++e)-1===(n=this.waits[e]).time&&n.signaltag===s&&(n.signalled=!0)},r.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},r.prototype.ResetGlobals=function(){var t,e,i;for(t=0,e=this.runtime.all_global_vars.length;t<e;t++)(i=this.runtime.all_global_vars[t]).data=i.initial},r.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},r.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},r.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY){var n,s,r=t.instances;for(n=0,s=r.length;n<s;++n)r[n].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},r.prototype.SetLayerBackground=function(t,e){if(t){var i=cr.GetRValue(e),n=cr.GetGValue(e),s=cr.GetBValue(e);t.background_color[0]===i&&t.background_color[1]===n&&t.background_color[2]===s||(t.background_color[0]=i,t.background_color[1]=n,t.background_color[2]=s,this.runtime.redraw=!0)}},r.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},r.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},r.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},r.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},r.prototype.RestartLayout=function(t){var e,i,n;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(n=this.runtime.allGroups[e]).setGroupActive(n.initially_activated)},r.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},r.prototype.SetCanvasSize=function(t,e){if(!(t<=0||e<=0)){var i=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen)&&0<this.runtime.fullscreen_scaling&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},r.prototype.SetLayoutEffectEnabled=function(t,e){if(this.runtime.running_layout&&this.runtime.glwrap){var i=this.runtime.running_layout.getEffectByName(e);if(i){var n=1===t;i.active!=n&&(i.active=n,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},r.prototype.SetLayerEffectEnabled=function(t,e,i){if(t&&this.runtime.glwrap){var n=t.getEffectByName(i);if(n){var s=1===e;n.active!=s&&(n.active=s,t.updateActiveEffects(),this.runtime.redraw=!0)}}},r.prototype.SetLayoutEffectParam=function(t,e,i){if(this.runtime.running_layout&&this.runtime.glwrap){var n=this.runtime.running_layout.getEffectByName(t);if(n){var s=this.runtime.running_layout.effect_params[n.index];(e=Math.floor(e))<0||e>=s.length||(1===this.runtime.glwrap.getProgramParameterType(n.shaderindex,e)&&(i/=100),s[e]!==i&&(s[e]=i,n.active&&(this.runtime.redraw=!0)))}}},r.prototype.SetLayerEffectParam=function(t,e,i,n){if(t&&this.runtime.glwrap){var s=t.getEffectByName(e);if(s){var r=t.effect_params[s.index];(i=Math.floor(i))<0||i>=r.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,i)&&(n/=100),r[i]!==n&&(r[i]=n,s.active&&(this.runtime.redraw=!0)))}}},r.prototype.SaveState=function(t){this.runtime.saveToSlot=t},r.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},r.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},r.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},r.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},r.prototype.ResetPersisted=function(){var t,e;for(t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},r.prototype.RecreateInitialObjects=function(t,e,i,n,s){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,n,s)},r.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},r.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),120<t&&(t=120),this.runtime.minimumFramerate=t},r.prototype.SortZOrderByInstVar=function(t,e){if(t){var i,n,s,r,o,a,h=t.getCurrentSol().getObjects(),c=[],l=[],u=this.runtime.running_layout,p=t.is_family,d=t.family_index;for(i=0,n=h.length;i<n;++i)(s=h[i]).layer&&(r=p?s.instance_vars[e+s.type.family_var_map[d]]:s.instance_vars[e],c.push([s.layer.index,s.get_zindex()]),l.push([s,r]));if(c.length)for(c.sort(f),l.sort(g),i=0,n=c.length;i<n;++i)s=l[i][0],o=u.layers[c[i][0]],a=c[i][1],o.instances[a]!==s&&((o.instances[a]=s).layer=o).setZIndicesStaleFrom(a)}},t.acts=new r,a.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},a.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},a.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},a.prototype.len=function(t,e){t.set_int(e.length||0)},a.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},a.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},a.prototype.abs=function(t,e){t.set_float(Math.abs(e))},a.prototype.round=function(t,e){t.set_int(Math.round(e))},a.prototype.floor=function(t,e){t.set_int(Math.floor(e))},a.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},a.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},a.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},a.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},a.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},a.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},a.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},a.prototype.exp=function(t,e){t.set_float(Math.exp(e))},a.prototype.ln=function(t,e){t.set_float(Math.log(e))},a.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},a.prototype.max=function(t){var e,i,n,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(n=arguments[e])&&s<n&&(s=n);t.set_float(s)},a.prototype.min=function(t){var e,i,n,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(n=arguments[e])&&n<s&&(s=n);t.set_float(s)},a.prototype.dt=function(t){t.set_float(this.runtime.dt)},a.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},a.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},a.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},a.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},a.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},a.prototype.fps=function(t){t.set_int(this.runtime.fps)},a.prototype.loopindex=function(t,e){var i,n;if(this.runtime.loop_stack.length)if(e){for(n=this.runtime.loop_stack_index;0<=n;--n)if((i=this.runtime.loop_stack[n]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},a.prototype.distance=function(t,e,i,n,s){t.set_float(cr.distanceTo(e,i,n,s))},a.prototype.angle=function(t,e,i,n,s){t.set_float(cr.to_degrees(cr.angleTo(e,i,n,s)))},a.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},a.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},a.prototype.newline=function(t){t.set_string("\n")},a.prototype.lerp=function(t,e,i,n){t.set_float(cr.lerp(e,i,n))},a.prototype.qarp=function(t,e,i,n,s){t.set_float(cr.qarp(e,i,n,s))},a.prototype.cubic=function(t,e,i,n,s,r){t.set_float(cr.cubic(e,i,n,s,r))},a.prototype.cosp=function(t,e,i,n){t.set_float(cr.cosp(e,i,n))},a.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},a.prototype.windowheight=function(t){t.set_int(this.runtime.height)},a.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},a.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},a.prototype.clamp=function(t,e,i,n){e<i?t.set_float(i):n<e?t.set_float(n):t.set_float(e)},a.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},a.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},a.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},a.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},a.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},a.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},a.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},a.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},a.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},a.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},a.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},a.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},a.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},a.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},a.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},a.prototype.mid=function(t,e,i,n){t.set_string(cr.is_string(e)?e.substr(i,n):"")},a.prototype.tokenat=function(t,e,i,n){if(cr.is_string(e)&&cr.is_string(n)){var s=e.split(n),r=cr.floor(i);r<0||r>=s.length?t.set_string(""):t.set_string(s[r])}else t.set_string("")},a.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},a.prototype.replace=function(t,e,i,n){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(n)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),n)):t.set_string(cr.is_string(e)?e:"")},a.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},a.prototype.pi=function(t){t.set_float(cr.PI)},a.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},a.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},a.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},a.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},a.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},a.prototype.rgb=function(t,e,i,n){t.set_int(cr.RGB(e,i,n))},a.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},a.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},a.prototype.anglelerp=function(t,e,i,n){e=cr.to_radians(e),i=cr.to_radians(i);var s=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+s*n)):t.set_float(cr.to_clamped_degrees(e-s*n))},a.prototype.anglerotate=function(t,e,i,n){e=cr.to_radians(e),i=cr.to_radians(i),n=cr.to_radians(n),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,n)))},a.prototype.zeropad=function(t,e,i){var n=e<0?"-":"";e<0&&(e=-e);for(var s=i-e.toString().length,r=0;r<s;r++)n+="0";t.set_string(n+e.toString())},a.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},a.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},a.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},a.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},a.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},a.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},a.prototype.unlerp=function(t,e,i,n){t.set_float(cr.unlerp(e,i,n))},a.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},a.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},a.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},a.prototype.canvastolayerx=function(t,e,i,n){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,n,!0):0)},a.prototype.canvastolayery=function(t,e,i,n){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,n,!1):0)},a.prototype.layertocanvasx=function(t,e,i,n){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,n,!0):0)},a.prototype.layertocanvasy=function(t,e,i,n){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,n,!1):0)},a.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},a.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},a.prototype.regexsearch=function(t,e,i,n){var s=o(i,n);t.set_int(e?e.search(s):-1)},a.prototype.regexreplace=function(t,e,i,n,s){var r=o(i,n);t.set_string(e?e.replace(r,s):"")};var d=[],m="",y="",w="";function x(t,e,i){if(t!==m||e!==y||i!==w){var n=o(e,i);d=t.match(n),m=t,y=e,w=i}}a.prototype.regexmatchcount=function(t,e,i,n){o(i,n);x(e.toString(),i,n),t.set_int(d?d.length:0)},a.prototype.regexmatchat=function(t,e,i,n,s){s=Math.floor(s);o(i,n);x(e.toString(),i,n),!d||s<0||s>=d.length?t.set_string(""):t.set_string(d[s])},a.prototype.infinity=function(t){t.set_float(1/0)},a.prototype.setbit=function(t,e,i,n){e|=0,i|=0,n=0!==n?1:0,t.set_int(e&~(1<<i)|n<<i)},a.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},a.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},a.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},a.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new a,t.runWaits=function(){var t,e,i,n,s,r,o,a,h,c=this.runtime.getCurrentEventStack();for(t=0,i=this.waits.length;t<i;t++){if(-1===(n=this.waits[t]).time){if(!n.signalled)continue}else if(n.time>this.runtime.kahanTime.sum)continue;for(s in c.current_event=n.ev,c.actindex=n.actindex,c.cndindex=0,n.sols)n.sols.hasOwnProperty(s)&&(r=this.runtime.types_by_index[parseInt(s,10)].getCurrentSol(),o=n.sols[s],r.select_all=o.sa,cr.shallowAssignArray(r.instances,o.insts),a=o,cr.clearArray(a.insts),p.push(a));n.ev.resume_actions_and_subevents(),this.runtime.clearSol(n.solModifiers),n.deleteme=!0}for(e=t=0,i=this.waits.length;t<i;t++)n=this.waits[t],(this.waits[e]=n).deleteme?(h=n,cr.wipe(h.sols),cr.clearArray(h.solModifiers),u.push(h)):e++;cr.truncateArray(this.waits,e)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],n=t[3],s=t[4],r=t[5],o=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var c=e.cnds,l=e.acts,u=e.exps;n&&(c.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},c.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},c.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},c.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},c.PickDistance=function(t,e,i){var n=this.getCurrentSol(),s=n.getObjects();if(!s.length)return!1;var r,o,a,h=s[0],c=h,l=cr.distanceTo(h.x,h.y,e,i);for(r=1,o=s.length;r<o;r++)h=s[r],a=cr.distanceTo(h.x,h.y,e,i),(0===t&&a<l||1===t&&l<a)&&(l=a,c=h);return n.pick_one(c),!0},l.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},l.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},l.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},l.SetPosToObject=function(t,e){var i,n,s=t.getPairedInstance(this);s&&(s.getImagePoint?(i=s.getImagePoint(e,!0),n=s.getImagePoint(e,!1)):(i=s.x,n=s.y),this.x===i&&this.y===n||(this.x=i,this.y=n,this.set_bbox_changed()))},l.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},l.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},u.X=function(t){t.set_float(this.x)},u.Y=function(t){t.set_float(this.y)},u.dt=function(t){t.set_float(this.runtime.getDt(this))}),s&&(c.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},c.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},l.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},l.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},l.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},u.Width=function(t){t.set_float(this.width)},u.Height=function(t){t.set_float(this.height)},u.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},u.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},u.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},u.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),r&&(c.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},c.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},c.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),n=cr.to_clamped_radians(e),s=cr.clamp_angle(this.angle);return!cr.angleClockwise(n,i)?!(!cr.angleClockwise(s,i)&&cr.angleClockwise(s,n)):cr.angleClockwise(s,i)&&!cr.angleClockwise(s,n)},l.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},l.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},l.RotateTowardPosition=function(t,e,i){var n=e-this.x,s=i-this.y,r=Math.atan2(s,n),o=cr.angleRotate(this.angle,r,cr.to_radians(t));isNaN(o)||this.angle!==o&&(this.angle=o,this.set_bbox_changed())},l.SetTowardPosition=function(t,e){var i=t-this.x,n=e-this.y,s=Math.atan2(n,i);isNaN(s)||this.angle!==s&&(this.angle=s,this.set_bbox_changed())},u.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(c.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},c.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},c.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),n=i.getObjects();if(!n.length)return!1;var s,r,o,a=n[0],h=a,c=a.instance_vars[e];for(s=1,r=n.length;s<r;s++)o=(a=n[s]).instance_vars[e],(0===t&&o<c||1===t&&c<o)&&(c=o,h=a);return i.pick_one(h),!0},c.PickByUID=function(t){var e,i,n,s,r,o,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(o=this.instances).length;e<i;e++)(s=o[e]).uid===t?a.else_instances.push(s):a.instances.push(s);return this.applySolToContainer(),!!a.instances.length}for(n=e=0,i=a.instances.length;e<i;e++)s=a.instances[e],(a.instances[n]=s).uid===t?a.else_instances.push(s):n++;return cr.truncateArray(a.instances,n),this.applySolToContainer(),!!a.instances.length}if(!(s=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(s))return!1;if(this.is_family){for(e=0,i=(r=s.type.families).length;e<i;e++)if(r[e]===this)return a.pick_one(s),this.applySolToContainer(),!0}else if(s.type===this)return a.pick_one(s),this.applySolToContainer(),!0;return!1},c.OnCreated=function(){return!0},c.OnDestroyed=function(){return!0},l.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},l.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},l.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},l.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},l.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},l.Destroy=function(){this.runtime.DestroyInstance(this)},l.LoadFromJsonString||(l.LoadFromJsonString=function(t){var e,i,n,s;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,n=this.behavior_insts.length;i<n;++i)(s=this.behavior_insts[i]).afterLoad&&s.afterLoad()}),u.Count=function(t){var e,i,n,s=t.object_class.instances.length;for(e=0,i=this.runtime.createRow.length;e<i;e++)n=this.runtime.createRow[e],t.object_class.is_family?0<=n.type.families.indexOf(t.object_class)&&s++:n.type===t.object_class&&s++;t.set_int(s)},u.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},u.UID=function(t){t.set_int(this.uid)},u.IID=function(t){t.set_int(this.get_iid())},u.AsJSON||(u.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),o&&(c.IsVisible=function(){return this.visible},l.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},c.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},l.SetOpacity=function(t){var e=t/100;e<0?e=0:1<e&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},u.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(c.IsOnLayer=function(t){return!!t&&this.layer===t},c.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;var n,s,r=i[0],o=r;for(n=1,s=i.length;n<s;n++)r=i[n],0===t?(r.layer.index>o.layer.index||r.layer.index===o.layer.index&&r.get_zindex()>o.get_zindex())&&(o=r):(r.layer.index<o.layer.index||r.layer.index===o.layer.index&&r.get_zindex()<o.get_zindex())&&(o=r);return e.pick_one(o),!0},l.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),(this.layer=t).appendToInstanceList(this,!0),this.runtime.redraw=!0)},l.ZMoveToObject=function(t,e){var i=0===t;if(e){var n=e.getFirstPicked(this);n&&n.uid!==this.uid&&(this.layer.index!==n.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=n.layer,n.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,n,i),this.runtime.redraw=!0)}},u.LayerNumber=function(t){t.set_int(this.layer.number)},u.LayerName=function(t){t.set_string(this.layer.name)},u.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(l.SetEffectEnabled=function(t,e){if(this.runtime.glwrap){var i=this.type.getEffectIndexByName(e);if(!(i<0)){var n=1===t;this.active_effect_flags[i]!==n&&(this.active_effect_flags[i]=n,this.updateActiveEffects(),this.runtime.redraw=!0)}}},l.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var n=this.type.getEffectIndexByName(t);if(!(n<0)){var s=this.type.effect_types[n],r=this.effect_params[n];(e=Math.floor(e))<0||e>=r.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,e)&&(i/=100),r[e]!==i&&(r[e]=i,s.active&&(this.runtime.redraw=!0)))}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var t,e,i=this.bbox_changed_callbacks;for(t=0,e=i.length;t<e;++t)i[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){if(this.bbox_changed){var t=this.bbox,e=this.bquad;t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var i=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var t=this.layer.render_grid,e=this.bbox;i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.rendercells.equals(i)||(this.rendercells.right<this.rendercells.left?t.update(this,null,i):t.update(this,this.rendercells,i),this.rendercells.copy(i),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var t=this.type.collision_grid,e=this.bbox;i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.collcells.equals(i)||(this.collcells.right<this.collcells.left?t.update(this,null,i):t.update(this,this.collcells,i),this.collcells.copy(i),this.cell_changed=!1)}},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t,e,i;cr.clearArray(this.active_effect_types);var n=!0;for(t=0,e=this.active_effect_flags.length;t<e;t++)this.active_effect_flags[t]&&(i=this.type.effect_types[t],this.active_effect_types.push(i),i.preservesOpaqueness||(n=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=n},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){var e,i,n;if(t&&t.is_contained&&t.type!=this)for(e=0,i=t.siblings.length;e<i;e++)if((n=t.siblings[e]).type==this)return n;var s=this.getCurrentSol().getObjects();return s.length?s[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var t,e;for(t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,n=this.runtime.createRow;for(t=0,e=n.length;t<e;++t)n[t].type===this&&(n[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;var e,i,n=this.runtime.createRow;for(e=0,i=n.length;e<i;++e)if(n[e].type===this){if(0===t)return n[e];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,n,s,r,o=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(n=0,s=(r=this.families[e]).behaviors.length;n<s;n++){if(t===r.behaviors[n].name)return this.extra.lastBehIndex=o,r.behaviors[n];o++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=o,this.behaviors[e];o++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){var e,i;for(e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,n,s,r,o;this.updateIIDs();var a=(r=this.getCurrentSol()).select_all,h=this.runtime.getCurrentEventStack(),c=h&&h.current_event&&h.current_event.orblock;for(t=0,e=this.container.length;t<e;t++)if((s=this.container[t])!==this&&(s.updateIIDs(),!((o=s.getCurrentSol()).select_all=a))){for(cr.clearArray(o.instances),i=0,n=r.instances.length;i<n;++i)o.instances[i]=s.getInstanceByIID(r.instances[i].iid);if(c)for(cr.clearArray(o.else_instances),i=0,n=r.else_instances.length;i<n;++i)o.else_instances[i]=s.getInstanceByIID(r.else_instances[i].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return i<t;case 5:return i<=t;default:return!1}}}(),cr.shaders={},cr.plugins_.AJAX=function(t){this.runtime=t},function(){var c=!1,i=null,l=null,u="",t=cr.plugins_.AJAX.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){if(this.type=t,this.runtime=t.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,c=this.runtime.isNWjs){i=require("path"),l=require("fs");var e=window.process||nw.process;u=i.dirname(e.execPath)+"\\"}};var e=t.Instance.prototype,n=null;window.C2_AJAX_DCSide=function(t,e,i){n&&("success"===t?(n.curTag=e,n.lastData=i,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,n)):"error"===t?(n.curTag=e,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,n)):"progress"===t&&(n.progress=i,n.curTag=e,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,n)))},e.onCreate=function(){n=this},e.saveToJSON=function(){return{lastData:this.lastData}},e.loadFromJSON=function(t){this.lastData=t.lastData,this.curTag="",this.progress=0};var p={},d="";function s(){}function r(){}function o(){}e.doRequest=function(i,e,t,n){if(this.runtime.isDirectCanvas)AppMobi.webview.execute('C2_AJAX_WebSide("'+i+'", "'+e+'", "'+t+'", '+(n?'"'+n+'"':"null")+");");else{var s=this,r=null,o=function(){s.curTag=i,s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,s)},a=function(){if(c){var t=u+e;l.existsSync(t)?l.readFile(t,{encoding:"utf8"},function(t,e){t?o():(s.curTag=i,s.lastData=e.replace(/\r\n/g,"\n"),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,s))}):o()}else o()};try{(r=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest).onreadystatechange=function(){4===r.readyState&&(s.curTag=i,r.responseText?s.lastData=r.responseText.replace(/\r\n/g,"\n"):s.lastData="",400<=r.status?(s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,s)):c&&!s.lastData.length||!c&&0===r.status&&!s.lastData.length||(s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,s)))},this.runtime.isWindowsPhone8||(r.onerror=a,r.ontimeout=a,r.onabort=a,r.onprogress=function(t){t.lengthComputable&&(s.progress=t.loaded/t.total,s.curTag=i,s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,s))}),r.open(t,e),this.runtime.isWindowsPhone8||0<=this.timeout&&void 0!==r.timeout&&(r.timeout=this.timeout);try{r.responseType="text"}catch(t){}if(n&&r.setRequestHeader&&!p.hasOwnProperty("Content-Type")&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader){var h;for(h in p)if(p.hasOwnProperty(h))try{r.setRequestHeader(h,p[h])}catch(t){}p={}}if(d&&r.overrideMimeType){try{r.overrideMimeType(d)}catch(t){}d=""}n?r.send(n):r.send()}catch(t){a()}}},s.prototype.OnComplete=function(t){return cr.equals_nocase(t,this.curTag)},s.prototype.OnAnyComplete=function(t){return!0},s.prototype.OnError=function(t){return cr.equals_nocase(t,this.curTag)},s.prototype.OnAnyError=function(t){return!0},s.prototype.OnProgress=function(t){return cr.equals_nocase(t,this.curTag)},t.cnds=new s,r.prototype.Request=function(e,t){var i=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(e,t,"GET")},r.prototype.RequestFile=function(e,t){var i=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(e,t,"GET")},r.prototype.Post=function(t,e,i,n){this.doRequest(t,e,n,i)},r.prototype.SetTimeout=function(t){this.timeout=1e3*t},r.prototype.SetHeader=function(t,e){p[t]=e},r.prototype.OverrideMIMEType=function(t){d=t},t.acts=new r,o.prototype.LastData=function(t){t.set_string(this.lastData)},o.prototype.Progress=function(t){t.set_float(this.progress)},o.prototype.Tag=function(t){t.set_string(this.curTag)},t.exps=new o}(),cr.plugins_.ATPAds=function(t){this.runtime=t},function(){var t,e=!1,i=!1,n=cr.plugins_.ATPAds.prototype;function s(){}function r(){}n.Type=function(t){this.plugin=t,this.runtime=t.runtime},n.Type.prototype.onCreate=function(){},n.Instance=function(t){this.type=t,this.runtime=t.runtime},n.Instance.prototype.onCreate=function(){if((this.runtime.isAndroid||this.runtime.isiOS)&&"undefined"!=typeof Cocoon){switch(this.isShowingBanner=!1,this.isShowingInterstitial=!1,this.androidBannerId=this.properties[0],this.properties[1]){case 0:this.androidBannerSize="SMART";break;case 1:this.androidBannerSize="BANNER";break;case 2:this.androidBannerSize="MEDIUM_REC";break;case 3:this.androidBannerSize="LEADERBOARD"}switch(this.androidInterstitialId=this.properties[2],this.iosBannerId=this.properties[3],this.properties[4]){case 0:this.iosBannerSize="SMART";break;case 1:this.iosBannerSize="BANNER";break;case 2:this.iosBannerSize="MEDIUM_REC";break;case 3:this.iosBannerSize="LEADERBOARD"}this.iosInterstitialId=this.properties[5],this.runtime.isAndroid?(this.bannerAdunit=this.androidBannerId,this.bannerSize=this.androidBannerSize,this.interstitialAdunit=this.androidInterstitialId):this.runtime.isiOS?(this.bannerAdunit=this.iosBannerId,this.bannerSize=this.iosBannerSize,this.interstitialAdunit=this.iosInterstitialId):(this.bannerAdunit="",this.interstitialAdunit=""),this.banner=Cocoon.Ad.createBanner(this.bannerAdunit,this.bannerSize),this.interstitial=Cocoon.Ad.createInterstitial(this.interstitialAdunit),(t=this).banner.on("show",function(){t.isShowingBanner=!0,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onBannerShown,t)}),this.banner.on("load",function(){i=!0,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onBannerLoaded,t)}),this.banner.on("click",function(){t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onBannerClicked,t)}),this.banner.on("fail",function(){i=!1,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onBannerFailed,t)}),this.banner.on("dismiss",function(){t.isShowingBanner=!1,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onBannerDismissed,t)}),this.interstitial.on("show",function(){t.isShowingInterstitial=!0,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onInterstitialShown,t)}),this.interstitial.on("load",function(){!0,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onInterstitialLoaded,t)}),this.interstitial.on("click",function(){t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onInterstitialClicked,t)}),this.interstitial.on("fail",function(){!1,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onInterstitialFailed,t)}),this.interstitial.on("dismiss",function(){t.isShowingInterstitial=!1,!1,t.runtime.trigger(cr.plugins_.ATPAds.prototype.cnds.onInterstitialDismissed,t)})}},s.prototype.onBannerShown=function(){return!0},s.prototype.onBannerHidden=function(){return!0},s.prototype.onBannerLoaded=function(){return!0},s.prototype.onBannerClicked=function(){return!0},s.prototype.onBannerFailed=function(){return!0},s.prototype.onBannerDismissed=function(){return!0},s.prototype.isShowingBanner=function(){return this.isShowingBanner},s.prototype.onInterstitialShown=function(){return!0},s.prototype.onInterstitialLoaded=function(){return!0},s.prototype.onInterstitialClicked=function(){return!0},s.prototype.onInterstitialFailed=function(){return!0},s.prototype.onInterstitialDismissed=function(){return!0},n.cnds=new s,r.prototype.ShowBanner=function(){i?e=!0:this.bannerReady=!1},r.prototype.HideBanner=function(){e&&(e=!1)},r.prototype.LoadBanner=function(){this.bannerReady=!1},s.prototype.isShowingInterstitial=function(){return this.isShowingInterstitial},r.prototype.SetLayout=function(t){switch(t){case 0:"TOP_CENTER";break;case 1:"BOTTOM_CENTER";break;case 2:"CUSTOM"}},r.prototype.SetPosition=function(t,e){this.banner.setPosition(t,e)},r.prototype.ShowInterstitial=function(){},r.prototype.LoadInterstitial=function(){},n.acts=new r}(),cr.plugins_.Audio=function(t){this.runtime=t},function(){var t=cr.plugins_.Audio.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){};var c=null,s=null,r="",o="",a=0,h=1,l=2,u=3,p=a,d=null,f=[],x=[],g=null,m=!1,y=0,S=!1,T=1,_=0,v=0,b=!1,n=1,w=1,O=10,A=1e4,C=1,E=null,k="",P=!1,I=[],R=!1,L=!1;function B(t){-1===I.indexOf(t)&&I.push(t)}function M(e){var t,i=e.instanceObject;try{t=i.play()}catch(t){return void B(e)}t?t.catch(function(t){B(e)}):P&&!c.isInUserInputEvent&&B(e)}function e(){var t,e,i,n;L||b||!d||(!function(){"suspended"===d.state&&d.resume&&d.resume();if(!d.createBuffer)return;var t=d.createBuffer(1,220,22050),e=d.createBufferSource();e.buffer=t,e.connect(d.destination),X(e)}(),"running"===d.state&&(L=!0));var s=I.slice(0);if(cr.clearArray(I),!S)for(t=0,e=s.length;t<e;++t)(i=s[t]).stopped||i.is_paused||(n=i.instanceObject.play())&&n.catch(function(t){B(i)})}function F(t){var e=D(t);return isFinite(e)||(e=0),e<0&&(e=0),1<e&&(e=1),e}function N(t){return t<0&&(t=0),1<t&&(t=1),e=t,Math.log(e)/Math.log(10)*20;var e}function D(t){return Math.pow(10,t/20)}document.addEventListener("pointerup",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),document.addEventListener("gamepadconnected",e,!0);var j={};function W(t){return t=t.toLowerCase(),j.hasOwnProperty(t)&&j[t].length?j[t][0].getInputNode():d.destination}function U(){return d.createGain?d.createGain():d.createGainNode()}function G(t){return d.createDelay?d.createDelay(t):d.createDelayNode(t)}function X(t,e){t.start?t.start(e||0):t.noteOn(e||0)}function z(t,e,i,n){t.start?t.start(n||0,e):t.noteGrainOn(n||0,e,i-e)}function i(t){try{t.stop?t.stop(0):t.noteOff(0)}catch(t){}}function V(t,e,i,n){if(t)if(t.cancelScheduledValues(0),0!==n){var s=d.currentTime;switch(n+=s,i){case 0:t.setValueAtTime(e,n);break;case 1:t.setValueAtTime(t.value,s),t.linearRampToValueAtTime(e,n);break;case 2:t.setValueAtTime(t.value,s),t.exponentialRampToValueAtTime(e,n)}}else t.value=e}var q=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];function J(t,e,i,n,s,r){this.type="filter",this.params=[t,e,i,n,s,r],this.inputNode=U(),this.wetNode=U(),this.wetNode.gain.value=r,this.dryNode=U(),this.dryNode.gain.value=1-r,this.filterNode=d.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=t:this.filterNode.type=q[t],this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=i),this.filterNode.Q.value=n,this.filterNode.gain.value=s,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function Y(t,e,i){this.type="delay",this.params=[t,e,i],this.inputNode=U(),this.wetNode=U(),this.wetNode.gain.value=i,this.dryNode=U(),this.dryNode.gain.value=1-i,this.mainNode=U(),this.delayNode=G(t),this.delayNode.delayTime.value=t,this.delayGainNode=U(),this.delayGainNode.gain.value=e,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function H(t,e,i,n){this.type="convolve",this.params=[e,i,n],this.inputNode=U(),this.wetNode=U(),this.wetNode.gain.value=i,this.dryNode=U(),this.dryNode.gain.value=1-i,this.convolveNode=d.createConvolver(),t&&(this.convolveNode.normalize=e,this.convolveNode.buffer=t),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function K(t,e,i,n,s){this.type="flanger",this.params=[t,e,i,n,s],this.inputNode=U(),this.dryNode=U(),this.dryNode.gain.value=1-s/2,this.wetNode=U(),this.wetNode.gain.value=s/2,this.feedbackNode=U(),this.feedbackNode.gain.value=n,this.delayNode=G(t+e),this.delayNode.delayTime.value=t,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=i,this.oscGainNode=U(),this.oscGainNode.gain.value=e,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),X(this.oscNode)}function Q(t,e,i,n,s,r){this.type="phaser",this.params=[t,e,i,n,s,r],this.inputNode=U(),this.dryNode=U(),this.dryNode.gain.value=1-r/2,this.wetNode=U(),this.wetNode.gain.value=r/2,this.filterNode=d.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=7:this.filterNode.type="allpass",this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=e),this.filterNode.Q.value=i,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=s,this.oscGainNode=U(),this.oscGainNode.gain.value=n,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),X(this.oscNode)}function Z(t){this.type="gain",this.params=[t],this.node=U(),this.node.gain.value=t}function $(t,e){this.type="tremolo",this.params=[t,e],this.node=U(),this.node.gain.value=1-e/2,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=t,this.oscGainNode=U(),this.oscGainNode.gain.value=e/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),X(this.oscNode)}function tt(t,e){this.type="ringmod",this.params=[t,e],this.inputNode=U(),this.wetNode=U(),this.wetNode.gain.value=e,this.dryNode=U(),this.dryNode.gain.value=1-e,this.ringNode=U(),this.ringNode.gain.value=0,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=t,this.oscNode.connect(this.ringNode.gain),X(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function et(t,e,i,n,s){this.type="distortion",this.params=[t,e,i,n,s],this.inputNode=U(),this.preGain=U(),this.postGain=U(),this.setDrive(i,D(n)),this.wetNode=U(),this.wetNode.gain.value=s,this.dryNode=U(),this.dryNode.gain.value=1-s,this.waveShaper=d.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(t,e),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function it(t,e,i,n,s){this.type="compressor",this.params=[t,e,i,n,s],this.node=d.createDynamicsCompressor();try{this.node.threshold.value=t,this.node.knee.value=e,this.node.ratio.value=i,this.node.attack.value=n,this.node.release.value=s}catch(t){}}function nt(t,e){this.type="analyser",this.params=[t,e],this.node=d.createAnalyser(),this.node.fftSize=t,this.node.smoothingTimeConstant=e,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(t),this.peak=0,this.rms=0}function st(){this.obj=null,this.loadUid=0}function rt(t,e){this.src=t,this.myapi=p,this.is_music=e,this.added_end_listener=!1;var i,n=this;switch(this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.wasEverReady=!1,p===h&&e&&!R&&(this.myapi=a,this.outNode=U()),this.bufferObject=null,this.audioData=null,this.myapi){case a:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){n.wasEverReady=!0}),p===h&&d.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!n.mediaSourceNode&&n.bufferObject&&(n.mediaSourceNode=d.createMediaElementSource(n.bufferObject),n.mediaSourceNode.connect(n.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=t;break;case h:c.isWKWebView?c.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){n.audioData=t,n.decodeAudioBuffer()},function(t){n.failedToLoad=!0}):((i=new XMLHttpRequest).open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){n.audioData=i.response,n.decodeAudioBuffer()},i.onerror=function(){n.failedToLoad=!0},i.send());break;case l:case u:this.bufferObject=!0}}function ot(t,e){var i=this;this.tag=e,this.fresh=!0,this.stopped=!0,this.src=t.src,this.buffer=t,this.myapi=p,this.is_music=t.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!i.is_paused&&!i.resume_me){var e=this;e||(e=t.target),e===i.active_buffer&&(i.hasPlaybackEnded=!0,i.stopped=!0,r=i.tag,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,s))}},this.active_buffer=null,this.isTimescaled=1===y&&!this.is_music||2===y,this.mutevol=1,this.startTime=this.isTimescaled?c.kahanTime.sum:c.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var n=!1;switch(this.myapi!==h||this.buffer.myapi!==a||this.buffer.supportWebAudioAPI||(this.myapi=a),this.myapi){case a:this.is_music?(this.instanceObject=t.bufferObject,n=!t.added_end_listener,t.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=t.bufferObject.src,n=!0),n&&this.instanceObject.addEventListener("ended",function(){r=i.tag,i.stopped=!0,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,s)});break;case h:this.gainNode=U(),this.gainNode.connect(W(e)),this.buffer.myapi===h?t.bufferObject&&(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=t.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){r=i.tag,i.stopped=!0,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,s)})));break;case l:this.instanceObject=new window.Media(o+this.src,null,null,function(t){t===window.Media.MEDIA_STOPPED&&(i.hasPlaybackEnded=!0,i.stopped=!0,r=i.tag,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,s))});break;case u:this.instanceObject=!0}}J.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},J.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},J.prototype.getInputNode=function(){return this.inputNode},J.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[5]=e,V(this.wetNode.gain,e,i,n),V(this.dryNode.gain,1-e,i,n);break;case 1:this.params[1]=e,V(this.filterNode.frequency,e,i,n);break;case 2:this.params[2]=e,V(this.filterNode.detune,e,i,n);break;case 3:this.params[3]=e,V(this.filterNode.Q,e,i,n);break;case 4:this.params[4]=e,V(this.filterNode.gain,e,i,n)}},Y.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},Y.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},Y.prototype.getInputNode=function(){return this.inputNode},Y.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[2]=e,V(this.wetNode.gain,e,i,n),V(this.dryNode.gain,1-e,i,n);break;case 4:this.params[1]=F(e),V(this.delayGainNode.gain,F(e),i,n);break;case 5:this.params[0]=e,V(this.delayNode.delayTime,e,i,n)}},H.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},H.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},H.prototype.getInputNode=function(){return this.inputNode},H.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,V(this.wetNode.gain,e,i,n),V(this.dryNode.gain,1-e,i,n)}},K.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},K.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},K.prototype.getInputNode=function(){return this.inputNode},K.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[4]=e,V(this.wetNode.gain,e/2,i,n),V(this.dryNode.gain,1-e/2,i,n);break;case 6:this.params[1]=e/1e3,V(this.oscGainNode.gain,e/1e3,i,n);break;case 7:this.params[2]=e,V(this.oscNode.frequency,e,i,n);break;case 8:this.params[3]=e/100,V(this.feedbackNode.gain,e/100,i,n)}},Q.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},Q.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},Q.prototype.getInputNode=function(){return this.inputNode},Q.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[5]=e,V(this.wetNode.gain,e/2,i,n),V(this.dryNode.gain,1-e/2,i,n);break;case 1:this.params[0]=e,V(this.filterNode.frequency,e,i,n);break;case 2:this.params[1]=e,V(this.filterNode.detune,e,i,n);break;case 3:this.params[2]=e,V(this.filterNode.Q,e,i,n);break;case 6:this.params[3]=e,V(this.oscGainNode.gain,e,i,n);break;case 7:this.params[4]=e,V(this.oscNode.frequency,e,i,n)}},Z.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},Z.prototype.remove=function(){this.node.disconnect()},Z.prototype.getInputNode=function(){return this.node},Z.prototype.setParam=function(t,e,i,n){switch(t){case 4:this.params[0]=F(e),V(this.node.gain,F(e),i,n)}},$.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},$.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},$.prototype.getInputNode=function(){return this.node},$.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,V(this.node.gain.value,1-e/2,i,n),V(this.oscGainNode.gain.value,e/2,i,n);break;case 7:this.params[0]=e,V(this.oscNode.frequency,e,i,n)}},tt.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},tt.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},tt.prototype.getInputNode=function(){return this.inputNode},tt.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,V(this.wetNode.gain,e,i,n),V(this.dryNode.gain,1-e,i,n);break;case 7:this.params[0]=e,V(this.oscNode.frequency,e,i,n)}},et.prototype.setDrive=function(t,e){t<.01&&(t=.01),this.preGain.gain.value=t,this.postGain.gain.value=Math.pow(1/t,.6)*e},et.prototype.shape=function(t,e,i){var n,s,r=1.05*i*e-e,o=t<0?-1:1,a=t<0?-t:t,h=a<e?a:e+r*(n=a-e,s=1/r,1-Math.exp(-s*n));return h*=o},et.prototype.generateColortouchCurve=function(t,e){for(var i=D(t),n=D(e),s=0,r=0;r<32768;++r)s=r/32768,s=this.shape(s,i,n),this.curve[32768+r]=s,this.curve[32768-r-1]=-s},et.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},et.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},et.prototype.getInputNode=function(){return this.inputNode},et.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[4]=e,V(this.wetNode.gain,e,i,n),V(this.dryNode.gain,1-e,i,n)}},it.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},it.prototype.remove=function(){this.node.disconnect()},it.prototype.getInputNode=function(){return this.node},it.prototype.setParam=function(t,e,i,n){},nt.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);for(var t=this.node.fftSize,e=0,i=this.peak=0,n=0;e<t;e++)(n=(this.signal[e]-128)/128)<0&&(n=-n),this.peak<n&&(this.peak=n),i+=n*n;this.peak=N(this.peak),this.rms=N(Math.sqrt(i/t))},nt.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},nt.prototype.remove=function(){this.node.disconnect()},nt.prototype.getInputNode=function(){return this.node},nt.prototype.setParam=function(t,e,i,n){},st.prototype.setObject=function(t){this.obj=t},st.prototype.hasObject=function(){return!!this.obj},st.prototype.tick=function(t){},rt.prototype.release=function(){var t,e,i,n;for(i=t=0,e=x.length;t<e;++t)n=x[t],(x[i]=n).buffer===this?n.stop():++i;x.length=i,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},rt.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var h=this;if(d.decodeAudioData)d.decodeAudioData(this.audioData,function(t){var e,i,n,s;if(h.bufferObject=t,h.audioData=null,cr.is_undefined(h.playTagWhenReady)||S){if(!cr.is_undefined(h.convolveWhenReady)){var r=h.convolveWhenReady.convolveNode;r.normalize=h.normalizeWhenReady,r.buffer=t}}else if(h.panWhenReady.length){for(i=0,n=h.panWhenReady.length;i<n;i++)if(e=h.panWhenReady[i],(s=new ot(h,e.thistag)).setPannerEnabled(!0),void 0===e.objUid||(e.obj=c.getObjectByUID(e.objUid),e.obj)){if(e.obj){var o=cr.rotatePtAround(e.obj.x,e.obj.y,-e.obj.layer.getAngle(),_,v,!0),a=cr.rotatePtAround(e.obj.x,e.obj.y,-e.obj.layer.getAngle(),_,v,!1);s.setPan(o,a,cr.to_degrees(e.obj.angle-e.obj.layer.getAngle()),e.ia,e.oa,e.og),s.setObject(e.obj)}else s.setPan(e.x,e.y,e.a,e.ia,e.oa,e.og);s.play(h.loopWhenReady,h.volumeWhenReady,h.seekWhenReady),h.pauseWhenReady&&s.pause(),x.push(s)}cr.clearArray(h.panWhenReady)}else(s=new ot(h,h.playTagWhenReady||"")).play(h.loopWhenReady,h.volumeWhenReady,h.seekWhenReady),h.pauseWhenReady&&s.pause(),x.push(s)},function(t){h.failedToLoad=!0});else if(this.bufferObject=d.createBuffer(this.audioData,!1),this.audioData=null,cr.is_undefined(this.playTagWhenReady)||S){if(!cr.is_undefined(this.convolveWhenReady)){var t=this.convolveWhenReady.convolveNode;t.normalize=this.normalizeWhenReady,t.buffer=this.bufferObject}}else{var e=new ot(this,this.playTagWhenReady);e.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&e.pause(),x.push(e)}}},rt.prototype.isLoaded=function(){switch(this.myapi){case a:var t=4<=this.bufferObject.readyState;return t&&(this.wasEverReady=!0),t||this.wasEverReady;case h:return!!this.audioData||!!this.bufferObject;case l:case u:return!0}return!1},rt.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case a:return this.isLoaded();case h:return!!this.bufferObject;case l:case u:return!0}return!1},rt.prototype.hasFailedToLoad=function(){switch(this.myapi){case a:return!!this.bufferObject.error;case h:return this.failedToLoad}return!1},ot.prototype.hasEnded=function(){switch(this.myapi){case a:return this.instanceObject.ended;case h:return this.buffer.myapi===h?!(!this.fresh&&!this.stopped&&this.instanceObject.loop)&&(!this.is_paused&&this.hasPlaybackEnded):this.instanceObject.ended;case l:return this.hasPlaybackEnded}return!0},ot.prototype.canBeRecycled=function(){return!(!this.fresh&&!this.stopped)||this.hasEnded()},ot.prototype.setPannerEnabled=function(t){if(p===h)if(!this.pannerEnabled&&t){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=d.createPanner(),"number"==typeof this.pannerNode.panningModel?this.pannerNode.panningModel=n:this.pannerNode.panningModel=["equalpower","HRTF","soundfield"][n],"number"==typeof this.pannerNode.distanceModel?this.pannerNode.distanceModel=w:this.pannerNode.distanceModel=["linear","inverse","exponential"][w],this.pannerNode.refDistance=O,this.pannerNode.maxDistance=A,this.pannerNode.rolloffFactor=C),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(W(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!t){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(W(this.tag)),this.pannerEnabled=!1}},ot.prototype.setPan=function(t,e,i,n,s,r){this.pannerEnabled&&p===h&&(this.pannerNode.setPosition(t,e,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(i)),Math.sin(cr.to_radians(i)),0),this.pannerNode.coneInnerAngle=n,this.pannerNode.coneOuterAngle=s,this.pannerNode.coneOuterGain=r,this.panX=t,this.panY=e,this.panAngle=i,this.panConeInner=n,this.panConeOuter=s,this.panConeOuterGain=r)},ot.prototype.setObject=function(t){this.pannerEnabled&&p===h&&(this.objectTracker||(this.objectTracker=new st),this.objectTracker.setObject(t))},ot.prototype.tick=function(t){if(this.pannerEnabled&&p===h&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(t);var e=this.objectTracker.obj,i=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),_,v,!0),n=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),_,v,!1);this.pannerNode.setPosition(i,n,0);var s=0;void 0!==this.objectTracker.obj.angle&&(s=e.angle-e.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(s),Math.sin(s),0))}},ot.prototype.play=function(t,e,i,n){var s=this.instanceObject;this.looping=t,this.volume=e;var r=i||0;switch(n=n||0,this.myapi){case a:if(1!==s.playbackRate&&(s.playbackRate=1),s.volume!==e*T&&(s.volume=e*T),s.loop!==t&&(s.loop=t),s.muted&&(s.muted=!1),s.currentTime!==r)try{s.currentTime=r}catch(t){}M(this);break;case h:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===h)this.gainNode.gain.value=e*T,this.fresh||(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=t,this.hasPlaybackEnded=!1,0===r?X(this.instanceObject,n):z(this.instanceObject,r,this.getDuration(),n);else{if(1!==s.playbackRate&&(s.playbackRate=1),s.loop!==t&&(s.loop=t),s.volume=e*T,s.currentTime!==r)try{s.currentTime=r}catch(t){}M(this)}break;case l:(!this.fresh&&this.stopped||0!==r)&&s.seekTo(r),s.play(),this.hasPlaybackEnded=!1;break;case u:c.isDirectCanvas?AppMobi.context.playSound(this.src,t):AppMobi.player.playSound(this.src,t)}this.playbackRate=1,this.startTime=(this.isTimescaled?c.kahanTime.sum:c.wallTime.sum)-r,this.fresh=!1,this.stopped=!1,this.is_paused=!1},ot.prototype.stop=function(){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case h:this.buffer.myapi===h?i(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case l:this.instanceObject.stop();break;case u:c.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.stopped=!0,this.is_paused=!1},ot.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case h:this.buffer.myapi===h?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,i(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case l:this.instanceObject.pause();break;case u:c.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.is_paused=!0}},ot.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case a:M(this);break;case h:this.buffer.myapi===h?(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=T*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?c.kahanTime.sum:c.wallTime.sum)-this.resume_position/(this.playbackRate||.001),z(this.instanceObject,this.resume_position,this.getDuration())):M(this);break;case l:this.instanceObject.play();break;case u:c.isDirectCanvas&&AppMobi.context.resumeSound(this.src)}this.is_paused=!1}},ot.prototype.seek=function(t){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case a:try{this.instanceObject.currentTime=t}catch(t){}break;case h:if(this.buffer.myapi===h)this.is_paused?this.resume_position=t:(this.pause(),this.resume_position=t,this.resume());else try{this.instanceObject.currentTime=t}catch(t){}break;case l:break;case u:c.isDirectCanvas&&AppMobi.context.seekSound(this.src,t)}},ot.prototype.reconnect=function(t){this.myapi===h&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(t)):(this.gainNode.disconnect(),this.gainNode.connect(t)))},ot.prototype.getDuration=function(t){var e=0;switch(this.myapi){case a:void 0!==this.instanceObject.duration&&(e=this.instanceObject.duration);break;case h:e=this.buffer.bufferObject.duration;break;case l:e=this.instanceObject.getDuration();break;case u:c.isDirectCanvas&&(e=AppMobi.context.getDurationSound(this.src))}return t&&(e/=this.playbackRate||.001),e},ot.prototype.getPlaybackTime=function(t){var e=this.getDuration(),i=0;switch(this.myapi){case a:void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case h:if(this.buffer.myapi===h){if(this.is_paused)return this.resume_position;i=(this.isTimescaled?c.kahanTime.sum:c.wallTime.sum)-this.startTime}else void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case l:break;case u:c.isDirectCanvas&&(i=AppMobi.context.getPlaybackTimeSound(this.src))}return t&&(i*=this.playbackRate),!this.looping&&e<i&&(i=e),i},ot.prototype.isPlaying=function(){return!(this.is_paused||this.fresh||this.stopped||this.hasEnded())},ot.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},ot.prototype.setVolume=function(t){this.volume=t,this.updateVolume()},ot.prototype.updateVolume=function(){var t=this.volume*T;switch(isFinite(t)||(t=0),this.myapi){case a:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t);break;case h:this.buffer.myapi===h?this.gainNode.gain.value=t*this.mutevol:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t)}},ot.prototype.getVolume=function(){return this.volume},ot.prototype.doSetMuted=function(t){switch(this.myapi){case a:this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t);break;case h:this.buffer.myapi===h?(this.mutevol=t?0:1,this.gainNode.gain.value=T*this.volume*this.mutevol):this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t)}},ot.prototype.setMuted=function(t){this.is_muted=!!t,this.doSetMuted(this.is_muted||this.is_silent)},ot.prototype.setSilent=function(t){this.is_silent=!!t,this.doSetMuted(this.is_muted||this.is_silent)},ot.prototype.setLooping=function(t){switch(this.looping=t,this.myapi){case a:case h:this.instanceObject.loop!==!!t&&(this.instanceObject.loop=!!t);break;case l:break;case u:c.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,t)}},ot.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.updatePlaybackRate()},ot.prototype.updatePlaybackRate=function(){var t=this.playbackRate;switch(this.isTimescaled&&(t*=c.timescale),this.myapi){case a:this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t);break;case h:this.buffer.myapi===h?this.instanceObject.playbackRate.value!==t&&(this.instanceObject.playbackRate.value=t):this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t)}},ot.prototype.setSuspended=function(t){switch(this.myapi){case a:t?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case h:t?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===h?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),i(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===h?(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=T*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?c.kahanTime.sum:c.wallTime.sum)-this.resume_position/(this.playbackRate||.001),z(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case l:t?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}},t.Instance=function(t){if(this.type=t,this.runtime=t.runtime,c=this.runtime,(s=this).listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(R=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isDomFree||this.runtime.isAmazonWebApp||R||(P=!0),d=null,"undefined"!=typeof AudioContext?(p=h,d=new AudioContext):"undefined"!=typeof webkitAudioContext&&(p=h,d=new webkitAudioContext),this.runtime.isiOS&&d&&(d.close&&d.close(),"undefined"!=typeof AudioContext?d=new AudioContext:"undefined"!=typeof webkitAudioContext&&(d=new webkitAudioContext)),p!==h&&(this.runtime.isCordova&&void 0!==window.Media?p=l:this.runtime.isAppMobi&&(p=u)),p===l){var e=(o=location.href).lastIndexOf("/");-1<e&&(o=o.substr(0,e+1)),o=o.replace("file://","")}if(this.runtime.isSafari&&this.runtime.isWindows&&"undefined"==typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)m=this.runtime.isAndroid;else try{m=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')&&!this.runtime.isWindows10}catch(t){m=!1}p,this.runtime.tickMe(this)}};var at=t.Instance.prototype;at.onCreate=function(){this.runtime.audioInstance=this,y=this.properties[0],this.saveload=this.properties[1],this.playinbackground=0!==this.properties[2],this.nextPlayTime=0,n=this.properties[3],w=this.properties[4],this.listenerZ=-this.properties[5],O=this.properties[6],A=this.properties[7],C=this.properties[8],this.listenerTracker=new st;var t=this.runtime.draw_width||this.runtime.width,e=this.runtime.draw_height||this.runtime.height;p===h&&(d.listener.setPosition(t/2,e/2,this.listenerZ),d.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,e){E&&E.disconnect(),k=e.toLowerCase(),(E=d.createMediaStreamSource(t)).connect(W(k))}),this.runtime.addSuspendCallback(function(t){s.onSuspend(t)});var i=this;this.runtime.addDestroyCallback(function(t){i.onInstanceDestroyed(t)})},at.onInstanceDestroyed=function(t){var e,i,n;for(e=0,i=x.length;e<i;e++)(n=x[e]).objectTracker&&n.objectTracker.obj===t&&(n.objectTracker.obj=null,n.pannerEnabled&&n.isPlaying()&&n.looping&&n.stop());this.listenerTracker.obj===t&&(this.listenerTracker.obj=null)},at.saveToJSON=function(){var t,e,i,n,s,r,o,a={silent:S,masterVolume:T,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},h=a.playing;for(t=0,e=x.length;t<e;t++)(i=x[t]).shouldSave()&&3!==this.saveload&&(i.is_music&&1===this.saveload||(i.is_music||2!==this.saveload)&&(o=i.getPlaybackTime(),i.looping&&(o%=i.getDuration()),n={tag:i.tag,buffersrc:i.buffer.src,is_music:i.is_music,playbackTime:o,volume:i.volume,looping:i.looping,muted:i.is_muted,playbackRate:i.playbackRate,paused:i.is_paused,resume_position:i.resume_position},i.pannerEnabled&&(n.pan={},r=n.pan,i.objectTracker&&i.objectTracker.hasObject()?r.objUid=i.objectTracker.obj.uid:(r.x=i.panX,r.y=i.panY,r.a=i.panAngle),r.ia=i.panConeInner,r.oa=i.panConeOuter,r.og=i.panConeOuterGain),h.push(n)));var c,l=a.effects;for(s in j)if(j.hasOwnProperty(s)){for(c=[],t=0,e=j[s].length;t<e;t++)c.push({type:j[s][t].type,params:j[s][t].params});l[s]=c}return a};var ht=[];at.loadFromJSON=function(t){var e=t.silent;T=t.masterVolume,this.listenerZ=t.listenerZ,this.listenerTracker.setObject(null);var i=t.listenerUid;-1!==i&&(this.listenerTracker.loadUid=i,ht.push(this.listenerTracker));var n,s,r,o,a,h,c,l,u,p,d,f,g,m,y,_,v,b,w=t.playing;if(3!==this.saveload)for(n=0,s=x.length;n<s;n++)(d=x[n]).is_music&&1===this.saveload||(d.is_music||2!==this.saveload)&&d.stop();for(f in j)if(j.hasOwnProperty(f))for(n=0,s=j[f].length;n<s;n++)j[f][n].remove();for(f in cr.wipe(j),t.effects)if(t.effects.hasOwnProperty(f))for(n=0,s=(y=t.effects[f]).length;n<s;n++)switch(_=y[n].type,v=y[n].params,_){case"filter":ft(f,new J(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"delay":ft(f,new Y(v[0],v[1],v[2]));break;case"convolve":o=v[2],(p=this.getAudioBuffer(o,!1)).bufferObject?b=new H(p.bufferObject,v[0],v[1],o):(b=new H(null,v[0],v[1],o),p.normalizeWhenReady=v[0],p.convolveWhenReady=b),ft(f,b);break;case"flanger":ft(f,new K(v[0],v[1],v[2],v[3],v[4]));break;case"phaser":ft(f,new Q(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"gain":ft(f,new Z(v[0]));break;case"tremolo":ft(f,new $(v[0],v[1]));break;case"ringmod":ft(f,new tt(v[0],v[1]));break;case"distortion":ft(f,new et(v[0],v[1],v[2],v[3],v[4]));break;case"compressor":ft(f,new it(v[0],v[1],v[2],v[3],v[4]));break;case"analyser":ft(f,new nt(v[0],v[1]))}for(n=0,s=w.length;n<s;n++)3!==this.saveload&&(o=(r=w[n]).buffersrc,a=r.is_music,h=r.tag,c=r.playbackTime,l=r.looping,u=r.volume,m=(g=r.pan)&&g.hasOwnProperty("objUid")?g.objUid:-1,a&&1===this.saveload||(a||2!==this.saveload)&&((d=this.getAudioInstance(o,h,a,l,u))?(d.resume_position=r.resume_position,d.setPannerEnabled(!!g),d.play(l,u,c),d.updatePlaybackRate(),d.updateVolume(),d.doSetMuted(d.is_muted||d.is_silent),r.paused&&d.pause(),r.muted&&d.setMuted(!0),d.doSetMuted(d.is_muted||d.is_silent),g&&(-1!==m?(d.objectTracker=d.objectTracker||new st,d.objectTracker.loadUid=m,ht.push(d.objectTracker)):d.setPan(g.x,g.y,g.a,g.ia,g.oa,g.og))):((p=this.getAudioBuffer(o,a)).seekWhenReady=c,p.pauseWhenReady=r.paused,g&&(-1!==m?p.panWhenReady.push({objUid:m,ia:g.ia,oa:g.oa,og:g.og,thistag:h}):p.panWhenReady.push({x:g.x,y:g.y,a:g.a,ia:g.ia,oa:g.oa,og:g.og,thistag:h})))));if(e&&!S){for(n=0,s=x.length;n<s;n++)x[n].setSilent(!0);S=!0}else if(!e&&S){for(n=0,s=x.length;n<s;n++)x[n].setSilent(!1);S=!1}},at.afterLoad=function(){var t,e,i,n;for(t=0,e=ht.length;t<e;t++)i=ht[t],n=this.runtime.getObjectByUID(i.loadUid),i.setObject(n),i.loadUid=-1,n&&(_=n.x,v=n.y);cr.clearArray(ht)},at.onSuspend=function(t){if(!this.playinbackground){var e,i;for(!t&&d&&d.resume&&(d.resume(),b=!1),e=0,i=x.length;e<i;e++)x[e].setSuspended(t);t&&d&&d.suspend&&(d.suspend(),b=!0)}},at.tick=function(){var t,e,i,n,s,r,o=this.runtime.dt;for(t=0,e=x.length;t<e;t++)(i=x[t]).tick(o),0!==y&&i.updatePlaybackRate();for(n in j)if(j.hasOwnProperty(n))for(t=0,e=(s=j[n]).length;t<e;t++)(r=s[t]).tick&&r.tick();p===h&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(o),_=this.listenerTracker.obj.x,v=this.listenerTracker.obj.y,d.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var ct=[];at.setPreloadList=function(t){var e,i,n,s,r,o,a=0;for(e=0,i=t.length;e<i;++e)s=(n=t[e])[0],r=2*n[1],((o=4<s.length&&".ogg"===s.substr(s.length-4))&&m||!o&&!m)&&(ct.push({filename:s,size:r,obj:null}),a+=r);return a},at.startPreloads=function(){var t,e,i,n;for(t=0,e=ct.length;t<e;++t)i=ct[t],n=this.runtime.files_subfolder+i.filename,i.obj=this.getAudioBuffer(n,!1)},at.getPreloadedSize=function(){var t,e,i,n=0;for(t=0,e=ct.length;t<e;++t)(i=ct[t]).obj.isLoadedAndDecoded()||i.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?n+=i.size:i.obj.isLoaded()&&(n+=Math.floor(i.size/2));return n},at.releaseAllMusicBuffers=function(){var t,e,i,n;for(i=t=0,e=f.length;t<e;++t)n=f[t],(f[i]=n).is_music?n.release():++i;f.length=i},at.getAudioBuffer=function(t,e,i){var n,s,r,o=null;for(n=0,s=f.length;n<s;n++)if((r=f[n]).src===t){o=r;break}return o||i||(R&&e&&this.releaseAllMusicBuffers(),o=new rt(t,e),f.push(o)),o},at.getAudioInstance=function(t,e,i,n,s){var r,o,a;for(r=0,o=x.length;r<o;r++)if((a=x[r]).src===t&&(a.canBeRecycled()||i))return a.tag=e,a;var h=this.getAudioBuffer(t,i);return h.bufferObject?(a=new ot(h,e),x.push(a),a):("<preload>"!==e&&(h.playTagWhenReady=e,h.loopWhenReady=n,h.volumeWhenReady=s),null)};var lt=[];function ut(t,e){var i=t.isPlaying()?1:0,n=e.isPlaying()?1:0;return i===n?0:i<n?1:-1}function pt(t,e){if(cr.clearArray(lt),!t.length)return!g||g.hasEnded()?void 0:(cr.clearArray(lt),void(lt[0]=g));var i,n,s;for(i=0,n=x.length;i<n;i++)s=x[i],cr.equals_nocase(t,s.tag)&&lt.push(s);e&&lt.sort(ut)}function dt(t){var e,i,n,s,r=d.destination;if(j.hasOwnProperty(t)&&(n=j[t]).length)for(r=n[0].getInputNode(),e=0,i=n.length;e<i;e++)s=n[e],e+1===i?s.connectTo(d.destination):s.connectTo(n[e+1].getInputNode());for(pt(t),e=0,i=lt.length;e<i;e++)lt[e].reconnect(r);E&&k===t&&(E.disconnect(),E.connect(r))}function ft(t,e){j.hasOwnProperty(t)?j[t].push(e):j[t]=[e],dt(t)}function gt(){}function mt(){}function yt(){}function _t(t,e){var i=null;return j.hasOwnProperty(t)&&(i=j[t]),i&&0<=e&&e<i.length&&i[e].freqBins?i[e]:null}gt.prototype.OnEnded=function(t){return cr.equals_nocase(r,t)},gt.prototype.PreloadsComplete=function(){var t,e;for(t=0,e=f.length;t<e;t++)if(!f[t].isLoadedAndDecoded()&&!f[t].hasFailedToLoad())return!1;return!0},gt.prototype.AdvancedAudioSupported=function(){return p===h},gt.prototype.IsSilent=function(){return S},gt.prototype.IsAnyPlaying=function(){var t,e;for(t=0,e=x.length;t<e;t++)if(x[t].isPlaying())return!0;return!1},gt.prototype.IsTagPlaying=function(t){var e,i;for(pt(t),e=0,i=lt.length;e<i;e++)if(lt[e].isPlaying())return!0;return!1},t.cnds=new gt,mt.prototype.Play=function(t,e,i,n){if(!S){var s=F(i),r=t[1],o=this.runtime.files_subfolder+t[0]+(m?".ogg":".m4a");(g=this.getAudioInstance(o,n,r,0!==e,s))&&(g.setPannerEnabled(!1),g.play(0!==e,s,0,this.nextPlayTime),this.nextPlayTime=0)}},mt.prototype.PlayAtPosition=function(t,e,i,n,s,r,o,a,h,c){if(!S){var l=F(i),u=t[1],p=this.runtime.files_subfolder+t[0]+(m?".ogg":".m4a");if(g=this.getAudioInstance(p,c,u,0!==e,l))g.setPannerEnabled(!0),g.setPan(n,s,r,o,a,F(h)),g.play(0!==e,l,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(p,u).panWhenReady.push({x:n,y:s,a:r,ia:o,oa:a,og:F(h),thistag:c})}},mt.prototype.PlayAtObject=function(t,e,i,n,s,r,o,a){if(!S&&n){var h=n.getFirstPicked();if(h){var c=F(i),l=t[1],u=this.runtime.files_subfolder+t[0]+(m?".ogg":".m4a");if(g=this.getAudioInstance(u,a,l,0!==e,c)){g.setPannerEnabled(!0);var p=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),_,v,!0),d=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),_,v,!1);g.setPan(p,d,cr.to_degrees(h.angle-h.layer.getAngle()),s,r,F(o)),g.setObject(h),g.play(0!==e,c,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(u,l).panWhenReady.push({obj:h,ia:s,oa:r,og:F(o),thistag:a})}}}},mt.prototype.PlayByName=function(t,e,i,n,s){if(!S){var r=F(n),o=1===t,a=this.runtime.files_subfolder+e.toLowerCase()+(m?".ogg":".m4a");(g=this.getAudioInstance(a,s,o,0!==i,r))&&(g.setPannerEnabled(!1),g.play(0!==i,r,0,this.nextPlayTime),this.nextPlayTime=0)}},mt.prototype.PlayAtPositionByName=function(t,e,i,n,s,r,o,a,h,c,l){if(!S){var u=F(n),p=1===t,d=this.runtime.files_subfolder+e.toLowerCase()+(m?".ogg":".m4a");if(g=this.getAudioInstance(d,l,p,0!==i,u))g.setPannerEnabled(!0),g.setPan(s,r,o,a,h,F(c)),g.play(0!==i,u,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(d,p).panWhenReady.push({x:s,y:r,a:o,ia:a,oa:h,og:F(c),thistag:l})}},mt.prototype.PlayAtObjectByName=function(t,e,i,n,s,r,o,a,h){if(!S&&s){var c=s.getFirstPicked();if(c){var l=F(n),u=1===t,p=this.runtime.files_subfolder+e.toLowerCase()+(m?".ogg":".m4a");if(g=this.getAudioInstance(p,h,u,0!==i,l)){g.setPannerEnabled(!0);var d=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),_,v,!0),f=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),_,v,!1);g.setPan(d,f,cr.to_degrees(c.angle-c.layer.getAngle()),r,o,F(a)),g.setObject(c),g.play(0!==i,l,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(p,u).panWhenReady.push({obj:c,ia:r,oa:o,og:F(a),thistag:h})}}}},mt.prototype.SetLooping=function(t,e){var i,n;for(pt(t),i=0,n=lt.length;i<n;i++)lt[i].setLooping(0===e)},mt.prototype.SetMuted=function(t,e){var i,n;for(pt(t),i=0,n=lt.length;i<n;i++)lt[i].setMuted(0===e)},mt.prototype.SetVolume=function(t,e){pt(t);var i,n,s=F(e);for(i=0,n=lt.length;i<n;i++)lt[i].setVolume(s)},mt.prototype.Preload=function(t){if(!S){var e=t[1],i=this.runtime.files_subfolder+t[0]+(m?".ogg":".m4a");p!==u?p!==l&&this.getAudioInstance(i,"<preload>",e,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(i):AppMobi.player.loadSound(i)}},mt.prototype.PreloadByName=function(t,e){if(!S){var i=1===t,n=this.runtime.files_subfolder+e.toLowerCase()+(m?".ogg":".m4a");p!==u?p!==l&&this.getAudioInstance(n,"<preload>",i,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(n):AppMobi.player.loadSound(n)}},mt.prototype.SetPlaybackRate=function(t,e){var i,n;for(pt(t),e<0&&(e=0),i=0,n=lt.length;i<n;i++)lt[i].setPlaybackRate(e)},mt.prototype.Stop=function(t){var e,i;for(pt(t),e=0,i=lt.length;e<i;e++)lt[e].stop()},mt.prototype.StopAll=function(){var t,e;for(t=0,e=x.length;t<e;t++)x[t].stop()},mt.prototype.SetPaused=function(t,e){var i,n;for(pt(t),i=0,n=lt.length;i<n;i++)0===e?lt[i].pause():lt[i].resume()},mt.prototype.Seek=function(t,e){var i,n;for(pt(t),i=0,n=lt.length;i<n;i++)lt[i].seek(e)},mt.prototype.SetSilent=function(t){var e,i;if(2===t&&(t=S?1:0),0!==t||S){if(1===t&&S){for(e=0,i=x.length;e<i;e++)x[e].setSilent(!1);S=!1}}else{for(e=0,i=x.length;e<i;e++)x[e].setSilent(!0);S=!0}},mt.prototype.SetMasterVolume=function(t){var e,i;for(T=F(t),e=0,i=x.length;e<i;e++)x[e].updateVolume()},mt.prototype.AddFilterEffect=function(t,e,i,n,s,r,o){p!==h||e<0||q.length<=e||!d.createBiquadFilter||((o/=100)<0&&(o=0),1<o&&(o=1),ft(t=t.toLowerCase(),new J(e,i,n,s,r,o)))},mt.prototype.AddDelayEffect=function(t,e,i,n){p===h&&((n/=100)<0&&(n=0),1<n&&(n=1),ft(t=t.toLowerCase(),new Y(e,F(i),n)))},mt.prototype.AddFlangerEffect=function(t,e,i,n,s,r){p===h&&d.createOscillator&&((r/=100)<0&&(r=0),1<r&&(r=1),ft(t=t.toLowerCase(),new K(e/1e3,i/1e3,n,s/100,r)))},mt.prototype.AddPhaserEffect=function(t,e,i,n,s,r,o){p===h&&d.createOscillator&&((o/=100)<0&&(o=0),1<o&&(o=1),ft(t=t.toLowerCase(),new Q(e,i,n,s,r,o)))},mt.prototype.AddConvolutionEffect=function(t,e,i,n){if(p===h&&d.createConvolver){var s,r=0===i,o=this.runtime.files_subfolder+e[0]+(m?".ogg":".m4a"),a=this.getAudioBuffer(o,!1);t=t.toLowerCase(),(n/=100)<0&&(n=0),1<n&&(n=1),a.bufferObject?s=new H(a.bufferObject,r,n,o):(s=new H(null,r,n,o),a.normalizeWhenReady=r,a.convolveWhenReady=s),ft(t,s)}},mt.prototype.AddGainEffect=function(t,e){p===h&&ft(t=t.toLowerCase(),new Z(F(e)))},mt.prototype.AddMuteEffect=function(t){p===h&&ft(t=t.toLowerCase(),new Z(0))},mt.prototype.AddTremoloEffect=function(t,e,i){p===h&&d.createOscillator&&((i/=100)<0&&(i=0),1<i&&(i=1),ft(t=t.toLowerCase(),new $(e,i)))},mt.prototype.AddRingModEffect=function(t,e,i){p===h&&d.createOscillator&&((i/=100)<0&&(i=0),1<i&&(i=1),ft(t=t.toLowerCase(),new tt(e,i)))},mt.prototype.AddDistortionEffect=function(t,e,i,n,s,r){p===h&&d.createWaveShaper&&((r/=100)<0&&(r=0),1<r&&(r=1),ft(t=t.toLowerCase(),new et(e,i,n,s,r)))},mt.prototype.AddCompressorEffect=function(t,e,i,n,s,r){p===h&&d.createDynamicsCompressor&&ft(t=t.toLowerCase(),new it(e,i,n,s/1e3,r/1e3))},mt.prototype.AddAnalyserEffect=function(t,e,i){p===h&&ft(t=t.toLowerCase(),new nt(e,i))},mt.prototype.RemoveEffects=function(t){var e,i,n;if(p===h&&(t=t.toLowerCase(),j.hasOwnProperty(t)&&(n=j[t]).length)){for(e=0,i=n.length;e<i;e++)n[e].remove();cr.clearArray(n),dt(t)}},mt.prototype.SetEffectParameter=function(t,e,i,n,s,r){var o;p===h&&(t=t.toLowerCase(),e=Math.floor(e),j.hasOwnProperty(t)&&(o=j[t],e<0||e>=o.length||o[e].setParam(i,n,s,r)))},mt.prototype.SetListenerObject=function(t){if(t&&p===h){var e=t.getFirstPicked();e&&(this.listenerTracker.setObject(e),_=e.x,v=e.y)}},mt.prototype.SetListenerZ=function(t){this.listenerZ=t},mt.prototype.ScheduleNextPlay=function(t){d&&(this.nextPlayTime=t)},mt.prototype.UnloadAudio=function(t){var e=t[1],i=this.runtime.files_subfolder+t[0]+(m?".ogg":".m4a"),n=this.getAudioBuffer(i,e,!0);n&&(n.release(),cr.arrayFindRemove(f,n))},mt.prototype.UnloadAudioByName=function(t,e){var i=1===t,n=this.runtime.files_subfolder+e.toLowerCase()+(m?".ogg":".m4a"),s=this.getAudioBuffer(n,i,!0);s&&(s.release(),cr.arrayFindRemove(f,s))},mt.prototype.UnloadAll=function(){var t,e;for(t=0,e=f.length;t<e;++t)f[t].release();cr.clearArray(f)},t.acts=new mt,yt.prototype.Duration=function(t,e){pt(e,!0),lt.length?t.set_float(lt[0].getDuration()):t.set_float(0)},yt.prototype.PlaybackTime=function(t,e){pt(e,!0),lt.length?t.set_float(lt[0].getPlaybackTime(!0)):t.set_float(0)},yt.prototype.Volume=function(t,e){if(pt(e,!0),lt.length){var i=lt[0].getVolume();t.set_float(N(i))}else t.set_float(0)},yt.prototype.MasterVolume=function(t){t.set_float(N(T))},yt.prototype.EffectCount=function(t,e){e=e.toLowerCase();var i=null;j.hasOwnProperty(e)&&(i=j[e]),t.set_int(i?i.length:0)},yt.prototype.AnalyserFreqBinCount=function(t,e,i){var n=_t(e=e.toLowerCase(),i=Math.floor(i));t.set_int(n?n.node.frequencyBinCount:0)},yt.prototype.AnalyserFreqBinAt=function(t,e,i,n){e=e.toLowerCase(),i=Math.floor(i),n=Math.floor(n);var s=_t(e,i);s?n<0||n>=s.node.frequencyBinCount?t.set_float(0):t.set_float(s.freqBins[n]):t.set_float(0)},yt.prototype.AnalyserPeakLevel=function(t,e,i){var n=_t(e=e.toLowerCase(),i=Math.floor(i));n?t.set_float(n.peak):t.set_float(0)},yt.prototype.AnalyserRMSLevel=function(t,e,i){var n=_t(e=e.toLowerCase(),i=Math.floor(i));n?t.set_float(n.rms):t.set_float(0)},yt.prototype.SampleRate=function(t){t.set_int(d?d.sampleRate:0)},yt.prototype.CurrentTime=function(t){t.set_float(d?d.currentTime:cr.performance_now())},t.exps=new yt}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var t=document.createElement("script");t.onload=function(){offlineScriptReady=!0,checkReady()},t.src="offlineClient.js",document.head.appendChild(t)}});var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var e=this;window.addEventListener("resize",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,e)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,e)}),window.addEventListener("offline",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,e)})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,e)}),document.addEventListener("backbutton",function(){if (confirm('Do you want to exit the Game?')) {
                window.history.back();
            } else {
               
            }}),document.addEventListener("menubutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)}),document.addEventListener("searchbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,e)}),document.addEventListener("tizenhwkey",function(t){switch(t.keyName){case"back":if (confirm('Do you want to exit the Game?')) {
                window.history.back();
            } else {
               
            };break;case"menu":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)||t.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(t){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)&&(t.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(t){return!!e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),this.runtime.addSuspendCallback(function(t){t?e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,e):e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,e)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var t=navigator.getBattery();loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t})}}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){if (confirm('Do you want to exit the Game?')) {
                window.history.back();
            } else {
               
            }
            }, Acts.prototype.Focus = function () { this.runtime.isNodeWebkit ? window.nwgui.Window.get().focus() : this.is_arcade || this.runtime.isDomFree || window.focus() }, Acts.prototype.Blur = function () { this.runtime.isNodeWebkit ? window.nwgui.Window.get().blur() : this.is_arcade || this.runtime.isDomFree || window.blur() }, Acts.prototype.GoBack = function () {
                if (confirm('Do you want to exit the Game?')) { window.history.back(); } else { }
            }, Acts.prototype.GoForward = function () { this.is_arcade || this.runtime.isDomFree || !window.forward || window.forward() }, Acts.prototype.GoHome = function () { this.is_arcade || this.runtime.isDomFree || !window.home || window.home() }, Acts.prototype.GoToURL = function (t, e) { this.runtime.isCocoonJs ? CocoonJS.App.openURL(t) : this.runtime.isEjecta ? ejecta.openURL(t) : this.runtime.isWinJS ? Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)) : navigator.app && navigator.app.loadUrl ? navigator.app.loadUrl(t, { openExternal: !0 }) : this.runtime.isCordova ? window.open(t, "_system") : this.is_arcade || this.runtime.isDomFree || (2 !== e || this.is_arcade ? 1 !== e || this.is_arcade ? window.location = t : window.parent.location = t : window.top.location = t) }, Acts.prototype.GoToURLWindow = function (t, e) { this.runtime.isCocoonJs ? CocoonJS.App.openURL(t) : this.runtime.isEjecta ? ejecta.openURL(t) : this.runtime.isWinJS ? Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)) : navigator.app && navigator.app.loadUrl ? navigator.app.loadUrl(t, { openExternal: !0 }) : this.runtime.isCordova ? window.open(t, "_system") : this.is_arcade || this.runtime.isDomFree || window.open(t, e) }, Acts.prototype.Reload = function () { this.is_arcade || this.runtime.isDomFree || window.location.reload() }; var firstRequestFullscreen = !0, crruntime = null; function onFullscreenError(t) { console && console.warn && console.warn("Fullscreen request failed: ", t), crruntime.setSize(window.innerWidth, window.innerHeight) } Acts.prototype.RequestFullScreen = function (t) { if (this.runtime.isDomFree) cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored"); else if (2 <= t && (t += 1), 6 === t && (t = 2), this.runtime.isNodeWebkit) this.runtime.isDebug ? debuggerFullscreen(!0) : !this.runtime.isNodeFullscreen && window.nwgui && (window.nwgui.Window.get().enterFullscreen(), this.runtime.isNodeFullscreen = !0, this.runtime.fullscreen_scaling = 2 <= t ? t : 0); else { if (document.mozFullScreen || document.webkitIsFullScreen || document.msFullscreenElement || document.fullScreen || document.fullScreenElement) return; this.runtime.fullscreen_scaling = 2 <= t ? t : 0; var e = document.documentElement; firstRequestFullscreen && (firstRequestFullscreen = !1, crruntime = this.runtime, e.addEventListener("mozfullscreenerror", onFullscreenError), e.addEventListener("webkitfullscreenerror", onFullscreenError), e.addEventListener("MSFullscreenError", onFullscreenError), e.addEventListener("fullscreenerror", onFullscreenError)), e.requestFullscreen ? e.requestFullscreen() : e.mozRequestFullScreen ? e.mozRequestFullScreen() : e.msRequestFullscreen ? e.msRequestFullscreen() : e.webkitRequestFullScreen && ("undefined" != typeof Element && void 0 !== Element.ALLOW_KEYBOARD_INPUT ? e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT) : e.webkitRequestFullScreen()) } }, Acts.prototype.CancelFullScreen = function () { this.runtime.isDomFree ? cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored") : this.runtime.isNodeWebkit ? this.runtime.isDebug ? debuggerFullscreen(!1) : this.runtime.isNodeFullscreen && window.nwgui && (window.nwgui.Window.get().leaveFullscreen(), this.runtime.isNodeFullscreen = !1) : document.exitFullscreen ? document.exitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.msExitFullscreen ? document.msExitFullscreen() : document.webkitCancelFullScreen && document.webkitCancelFullScreen() }, Acts.prototype.Vibrate = function (t) { try { var e, i, n = t.split(","); for (e = 0, i = n.length; e < i; e++) n[e] = parseInt(n[e], 10); navigator.vibrate ? navigator.vibrate(n) : navigator.mozVibrate ? navigator.mozVibrate(n) : navigator.webkitVibrate ? navigator.webkitVibrate(n) : navigator.msVibrate && navigator.msVibrate(n) } catch (t) { } }, Acts.prototype.InvokeDownload = function (t, e) { var i = document.createElement("a"); if (void 0 === i.download) window.open(t); else { var n = document.getElementsByTagName("body")[0]; i.textContent = e, i.href = t, i.download = e, n.appendChild(i); var s = new MouseEvent("click"); i.dispatchEvent(s), n.removeChild(i) } }, Acts.prototype.InvokeDownloadString = function (t, e, i) { var n = "data:" + e + "," + encodeURIComponent(t), s = document.createElement("a"); if (void 0 === s.download) window.open(n); else { var r = document.getElementsByTagName("body")[0]; s.textContent = i, s.href = n, s.download = i, r.appendChild(s); var o = new MouseEvent("click"); s.dispatchEvent(o), r.removeChild(s) } }, Acts.prototype.ConsoleLog = function (t, e) { "undefined" != typeof console && (0 === t && console.log && console.log(e.toString()), 1 === t && console.warn && console.warn(e.toString()), 2 === t && console.error && console.error(e.toString())) }, Acts.prototype.ConsoleGroup = function (t) { console && console.group && console.group(t) }, Acts.prototype.ConsoleGroupEnd = function () { console && console.groupEnd && console.groupEnd() }, Acts.prototype.ExecJs = function (js_) { try { eval && eval(js_) } catch (t) { console && console.error && console.error("Error executing Javascript: ", t) } }; var orientations = ["portrait", "landscape", "portrait-primary", "portrait-secondary", "landscape-primary", "landscape-secondary"]; function Exps() { } Acts.prototype.LockOrientation = function (t) { if (!((t = Math.floor(t)) < 0 || t >= orientations.length)) { this.runtime.autoLockOrientation = !1; var e = orientations[t]; screen.orientation && screen.orientation.lock ? screen.orientation.lock(e) : screen.lockOrientation ? screen.lockOrientation(e) : screen.webkitLockOrientation ? screen.webkitLockOrientation(e) : screen.mozLockOrientation ? screen.mozLockOrientation(e) : screen.msLockOrientation && screen.msLockOrientation(e) } }, Acts.prototype.UnlockOrientation = function () { this.runtime.autoLockOrientation = !1, screen.orientation && screen.orientation.unlock ? screen.orientation.unlock() : screen.unlockOrientation ? screen.unlockOrientation() : screen.webkitUnlockOrientation ? screen.webkitUnlockOrientation() : screen.mozUnlockOrientation ? screen.mozUnlockOrientation() : screen.msUnlockOrientation && screen.msUnlockOrientation() }, pluginProto.acts = new Acts, Exps.prototype.URL = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.toString()) }, Exps.prototype.Protocol = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.protocol) }, Exps.prototype.Domain = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.hostname) }, Exps.prototype.PathName = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.pathname) }, Exps.prototype.Hash = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.hash) }, Exps.prototype.Referrer = function (t) { t.set_string(this.runtime.isDomFree ? "" : document.referrer) }, Exps.prototype.Title = function (t) { t.set_string(this.runtime.isDomFree ? "" : document.title) }, Exps.prototype.Name = function (t) { t.set_string(this.runtime.isDomFree ? "" : navigator.appName) }, Exps.prototype.Version = function (t) { t.set_string(this.runtime.isDomFree ? "" : navigator.appVersion) }, Exps.prototype.Language = function (t) { navigator && navigator.language ? t.set_string(navigator.language) : t.set_string("") }, Exps.prototype.Platform = function (t) { t.set_string(this.runtime.isDomFree ? "" : navigator.platform) }, Exps.prototype.Product = function (t) { navigator && navigator.product ? t.set_string(navigator.product) : t.set_string("") }, Exps.prototype.Vendor = function (t) { navigator && navigator.vendor ? t.set_string(navigator.vendor) : t.set_string("") }, Exps.prototype.UserAgent = function (t) { t.set_string(this.runtime.isDomFree ? "" : navigator.userAgent) }, Exps.prototype.QueryString = function (t) { t.set_string(this.runtime.isDomFree ? "" : window.location.search) }, Exps.prototype.QueryParam = function (t, e) { if (this.runtime.isDomFree) t.set_string(""); else { var i = RegExp("[?&]" + e + "=([^&]*)").exec(window.location.search); i ? t.set_string(decodeURIComponent(i[1].replace(/\+/g, " "))) : t.set_string("") } }, Exps.prototype.Bandwidth = function (t) { var e = navigator.connection || navigator.mozConnection || navigator.webkitConnection; e ? void 0 !== e.bandwidth ? t.set_float(e.bandwidth) : void 0 !== e.downlinkMax ? t.set_float(e.downlinkMax) : t.set_float(Number.POSITIVE_INFINITY) : t.set_float(Number.POSITIVE_INFINITY) }, Exps.prototype.ConnectionType = function (t) { var e = navigator.connection || navigator.mozConnection || navigator.webkitConnection; e ? t.set_string(e.type || "unknown") : t.set_string("unknown") }, Exps.prototype.BatteryLevel = function (t) { var e = navigator.battery || navigator.mozBattery || navigator.webkitBattery; e ? t.set_float(e.level) : (maybeLoadBatteryManager(), batteryManager ? t.set_float(batteryManager.level) : t.set_float(1)) }, Exps.prototype.BatteryTimeLeft = function (t) { var e = navigator.battery || navigator.mozBattery || navigator.webkitBattery; e ? t.set_float(e.dischargingTime) : (maybeLoadBatteryManager(), batteryManager ? t.set_float(batteryManager.dischargingTime) : t.set_float(Number.POSITIVE_INFINITY)) }, Exps.prototype.ExecJS = function (ret, js_) { if (eval) { var result = 0; try { result = eval(js_) } catch (t) { console && console.error && console.error("Error executing Javascript: ", t) } "number" == typeof result ? ret.set_any(result) : "string" == typeof result ? ret.set_any(result) : "boolean" == typeof result ? ret.set_any(result ? 1 : 0) : ret.set_any(0) } else ret.set_any(0) }, Exps.prototype.ScreenWidth = function (t) { t.set_int(screen.width) }, Exps.prototype.ScreenHeight = function (t) { t.set_int(screen.height) }, Exps.prototype.DevicePixelRatio = function (t) { t.set_float(this.runtime.devicePixelRatio) }, Exps.prototype.WindowInnerWidth = function (t) { t.set_int(window.innerWidth) }, Exps.prototype.WindowInnerHeight = function (t) { t.set_int(window.innerHeight) }, Exps.prototype.WindowOuterWidth = function (t) { t.set_int(window.outerWidth) }, Exps.prototype.WindowOuterHeight = function (t) { t.set_int(window.outerHeight) }, pluginProto.exps = new Exps
}(), cr.plugins_.Keyboard = function (t) { this.runtime = t }, function () { var t = cr.plugins_.Keyboard.prototype; t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime, this.keyMap = new Array(256), this.usedKeys = new Array(256), this.triggerKey = 0 }; var e = t.Instance.prototype; e.onCreate = function () { var e = this; this.runtime.isDomFree || (jQuery(document).keydown(function (t) { e.onKeyDown(t) }), jQuery(document).keyup(function (t) { e.onKeyUp(t) })) }; var s = [32, 33, 34, 35, 36, 37, 38, 39, 40, 44]; function i() { } function n() { } e.onKeyDown = function (t) { var e = !1; if (window != window.top && -1 < s.indexOf(t.which) && (t.preventDefault(), e = !0, t.stopPropagation()), this.keyMap[t.which]) this.usedKeys[t.which] && !e && t.preventDefault(); else { this.keyMap[t.which] = !0, this.triggerKey = t.which, this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey, this); var i = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey, this), n = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode, this); this.runtime.isInUserInputEvent = !1, (i || n) && (this.usedKeys[t.which] = !0, e || t.preventDefault()) } }, e.onKeyUp = function (t) { this.keyMap[t.which] = !1, this.triggerKey = t.which, this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased, this); var e = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased, this), i = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased, this); this.runtime.isInUserInputEvent = !1, (e || i || this.usedKeys[t.which]) && (this.usedKeys[t.which] = !0, t.preventDefault()) }, e.onWindowBlur = function () { var t; for (t = 0; t < 256; ++t) if (this.keyMap[t]) { this.keyMap[t] = !1, this.triggerKey = t, this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased, this); var e = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased, this), i = this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased, this); (e || i) && (this.usedKeys[t] = !0) } }, e.saveToJSON = function () { return { triggerKey: this.triggerKey } }, e.loadFromJSON = function (t) { this.triggerKey = t.triggerKey }, i.prototype.IsKeyDown = function (t) { return this.keyMap[t] }, i.prototype.OnKey = function (t) { return t === this.triggerKey }, i.prototype.OnAnyKey = function (t) { return !0 }, i.prototype.OnAnyKeyReleased = function (t) { return !0 }, i.prototype.OnKeyReleased = function (t) { return t === this.triggerKey }, i.prototype.IsKeyCodeDown = function (t) { return !((t = Math.floor(t)) < 0 || t >= this.keyMap.length) && this.keyMap[t] }, i.prototype.OnKeyCode = function (t) { return t === this.triggerKey }, i.prototype.OnKeyCodeReleased = function (t) { return t === this.triggerKey }, t.cnds = new i, t.acts = new function () { }, n.prototype.LastKeyCode = function (t) { t.set_int(this.triggerKey) }, n.prototype.StringFromKeyCode = function (t, e) { t.set_string(function (t) { switch (t = Math.floor(t)) { case 8: return "backspace"; case 9: return "tab"; case 13: return "enter"; case 16: return "shift"; case 17: return "control"; case 18: return "alt"; case 19: return "pause"; case 20: return "capslock"; case 27: return "esc"; case 33: return "pageup"; case 34: return "pagedown"; case 35: return "end"; case 36: return "home"; case 37: return ""; case 38: return ""; case 39: return ""; case 40: return ""; case 45: return "insert"; case 46: return "del"; case 91: return "left window key"; case 92: return "right window key"; case 93: return "select"; case 96: return "numpad 0"; case 97: return "numpad 1"; case 98: return "numpad 2"; case 99: return "numpad 3"; case 100: return "numpad 4"; case 101: return "numpad 5"; case 102: return "numpad 6"; case 103: return "numpad 7"; case 104: return "numpad 8"; case 105: return "numpad 9"; case 106: return "numpad *"; case 107: return "numpad +"; case 109: return "numpad -"; case 110: return "numpad ."; case 111: return "numpad /"; case 112: return "F1"; case 113: return "F2"; case 114: return "F3"; case 115: return "F4"; case 116: return "F5"; case 117: return "F6"; case 118: return "F7"; case 119: return "F8"; case 120: return "F9"; case 121: return "F10"; case 122: return "F11"; case 123: return "F12"; case 144: return "numlock"; case 145: return "scroll lock"; case 186: return ";"; case 187: return "="; case 188: return ","; case 189: return "-"; case 190: return "."; case 191: return "/"; case 192: return "'"; case 219: return "["; case 220: return "\\"; case 221: return "]"; case 222: return "#"; case 223: return "`"; default: return String.fromCharCode(t) } }(e)) }, t.exps = new n }(); var localForageInitFailed = !1; try { !function () { var t, l, u, p, d; p = {}, d = {}, u = l = function (o) { function t(t) { if ("." !== t.charAt(0)) return t; for (var e = t.split("/"), i = o.split("/").slice(0, -1), n = 0, s = e.length; n < s; n++) { var r = e[n]; if (".." === r) i.pop(); else { if ("." === r) continue; i.push(r) } } return i.join("/") } if (u._eak_seen = p, d[o]) return d[o]; if (d[o] = {}, !p[o]) throw new Error("Could not find module " + o); for (var e, i = p[o], n = i.deps, s = i.callback, r = [], a = 0, h = n.length; a < h; a++) "exports" === n[a] ? r.push(e = {}) : r.push(l(t(n[a]))); var c = s.apply(this, r); return d[o] = e || c }, (t = function (t, e, i) { p[t] = { deps: e, callback: i } })("promise/all", ["./utils", "exports"], function (t, e) { "use strict"; var i = t.isArray, c = t.isFunction; e.all = function (h) { if (!i(h)) throw new TypeError("You must pass an array to all."); return new this(function (i, t) { function e(e) { return function (t) { n(e, t) } } function n(t, e) { r[t] = e, 0 == --o && i(r) } var s, r = [], o = h.length; 0 === o && i([]); for (var a = 0; a < h.length; a++) (s = h[a]) && c(s.then) ? s.then(e(a), t) : n(a, s) }) } }), t("promise/asap", ["exports"], function (t) { "use strict"; function e() { for (var t = 0; t < c.length; t++) { var e = c[t]; (0, e[0])(e[1]) } c = [] } var i, n, s, r, o = "undefined" != typeof window ? window : {}, a = o.MutationObserver || o.WebKitMutationObserver, h = "undefined" != typeof global ? global : void 0 === this ? window : this, c = []; i = "undefined" != typeof process && "[object process]" === {}.toString.call(process) ? function () { process.nextTick(e) } : a ? (n = 0, s = new a(e), r = document.createTextNode(""), s.observe(r, { characterData: !0 }), function () { r.data = n = ++n % 2 }) : function () { h.setTimeout(e, 1) }, t.asap = function (t, e) { 1 === c.push([t, e]) && i() } }), t("promise/config", ["exports"], function (t) { "use strict"; var i = { instrument: !1 }; t.config = i, t.configure = function (t, e) { return 2 !== arguments.length ? i[t] : void (i[t] = e) } }), t("promise/polyfill", ["./promise", "./utils", "exports"], function (t, e, i) { "use strict"; var n = t.Promise, s = e.isFunction; i.polyfill = function () { var t, e; "Promise" in (t = "undefined" != typeof global ? global : "undefined" != typeof window && window.document ? window : self) && "resolve" in t.Promise && "reject" in t.Promise && "all" in t.Promise && "race" in t.Promise && (new t.Promise(function (t) { e = t }), s(e)) || (t.Promise = n) } }), t("promise/promise", ["./config", "./utils", "./all", "./race", "./resolve", "./reject", "./asap", "exports"], function (t, e, i, n, s, r, o, a) { "use strict"; function h(t) { if (!v(t)) throw new TypeError("You must pass a resolver function as the first argument to the promise constructor"); if (!(this instanceof h)) throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function."); this._subscribers = [], function (t, e) { function i(t) { f(e, t) } try { t(function (t) { p(e, t) }, i) } catch (t) { i(t) } }(t, this) } function l(t, e, i, n) { var s, r, o, a, h = v(i); if (h) try { s = i(n), o = !0 } catch (t) { a = !0, r = t } else s = n, o = !0; u(e, s) || (h && o ? p(e, s) : a ? f(e, r) : t === C ? p(e, s) : t === E && f(e, s)) } function c(t, e) { for (var i = t._subscribers, n = t._detail, s = 0; s < i.length; s += 3) l(e, i[s], i[s + e], n); t._subscribers = null } function u(e, i) { var n, t = null; try { if (e === i) throw new TypeError("A promises callback cannot return that same promise."); if (_(i) && (t = i.then, v(t))) return t.call(i, function (t) { return !!n || (n = !0, void (i !== t ? p(e, t) : d(e, t))) }, function (t) { return !!n || (n = !0, void f(e, t)) }), !0 } catch (t) { return n || f(e, t), !0 } return !1 } function p(t, e) { t === e ? d(t, e) : u(t, e) || d(t, e) } function d(t, e) { t._state === O && (t._state = A, t._detail = e, y.async(g, t)) } function f(t, e) { t._state === O && (t._state = A, t._detail = e, y.async(m, t)) } function g(t) { c(t, t._state = C) } function m(t) { c(t, t._state = E) } var y = t.config, _ = (t.configure, e.objectOrFunction), v = e.isFunction, b = (e.now, i.all), w = n.race, x = s.resolve, S = r.reject, T = o.asap; y.async = T; var O = void 0, A = 0, C = 1, E = 2; h.prototype = { constructor: h, _state: void 0, _detail: void 0, _subscribers: void 0, then: function (t, e) { var i, n, s, r, o, a = this, h = new this.constructor(function () { }); if (this._state) { var c = arguments; y.async(function () { l(a._state, h, c[a._state - 1], a._detail) }) } else i = h, n = t, s = e, r = this._subscribers, o = r.length, r[o] = i, r[o + C] = n, r[o + E] = s; return h }, catch: function (t) { return this.then(null, t) } }, h.all = b, h.race = w, h.resolve = x, h.reject = S, a.Promise = h }), t("promise/race", ["./utils", "exports"], function (t, e) { "use strict"; var i = t.isArray; e.race = function (s) { if (!i(s)) throw new TypeError("You must pass an array to race."); return new this(function (t, e) { for (var i, n = 0; n < s.length; n++) (i = s[n]) && "function" == typeof i.then ? i.then(t, e) : t(i) }) } }), t("promise/reject", ["exports"], function (t) { "use strict"; t.reject = function (i) { return new this(function (t, e) { e(i) }) } }), t("promise/resolve", ["exports"], function (t) { "use strict"; t.resolve = function (e) { return e && "object" == typeof e && e.constructor === this ? e : new this(function (t) { t(e) }) } }), t("promise/utils", ["exports"], function (t) { "use strict"; function e(t) { return "function" == typeof t } var i = Date.now || function () { return (new Date).getTime() }; t.objectOrFunction = function (t) { return e(t) || "object" == typeof t && null !== t }, t.isFunction = e, t.isArray = function (t) { return "[object Array]" === Object.prototype.toString.call(t) }, t.now = i }), l("promise/polyfill").polyfill() }(), function (t, e) { "object" == typeof exports && "object" == typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : "object" == typeof exports ? exports.localforage = e() : t.localforage = e() }(this, function () { return function (i) { function n(t) { if (s[t]) return s[t].exports; var e = s[t] = { exports: {}, id: t, loaded: !1 }; return i[t].call(e.exports, e, e.exports, n), e.loaded = !0, e.exports } var s = {}; return n.m = i, n.c = s, n.p = "", n(0) }([function (t, e, c) { "use strict"; e.__esModule = !0; var i = function (t) { function i(e, i) { e[i] = function () { var t = arguments; return e.ready().then(function () { return e[i].apply(e, t) }) } } function n() { for (var t = 1; t < arguments.length; t++) { var e = arguments[t]; if (e) for (var i in e) e.hasOwnProperty(i) && (h(e[i]) ? arguments[0][i] = e[i].slice() : arguments[0][i] = e[i]) } return arguments[0] } function l(t) { for (var e in r) if (r.hasOwnProperty(e) && r[e] === t) return !0; return !1 } var e, s, u = {}, r = { INDEXEDDB: "asyncStorage", LOCALSTORAGE: "localStorageWrapper", WEBSQL: "webSQLStorage" }, o = [r.INDEXEDDB, r.WEBSQL, r.LOCALSTORAGE], p = ["clear", "getItem", "iterate", "key", "keys", "length", "removeItem", "setItem"], a = { description: "", driver: o.slice(), name: "localforage", size: 4980736, storeName: "keyvaluepairs", version: 1 }, d = (e = t, (s = {})[r.INDEXEDDB] = !!function () { try { var t = t || e.indexedDB || e.webkitIndexedDB || e.mozIndexedDB || e.OIndexedDB || e.msIndexedDB; return !(void 0 !== e.openDatabase && e.navigator && e.navigator.userAgent && /Safari/.test(e.navigator.userAgent) && !/Chrome/.test(e.navigator.userAgent)) && t && "function" == typeof t.open && void 0 !== e.IDBKeyRange } catch (t) { return !1 } }(), s[r.WEBSQL] = !!function () { try { return e.openDatabase } catch (t) { return !1 } }(), s[r.LOCALSTORAGE] = !!function () { try { return e.localStorage && "setItem" in e.localStorage && e.localStorage.setItem } catch (t) { return !1 } }(), s), h = Array.isArray || function (t) { return "[object Array]" === Object.prototype.toString.call(t) }; return new (function () { function e(t) { (function (t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") })(this, e), this.INDEXEDDB = r.INDEXEDDB, this.LOCALSTORAGE = r.LOCALSTORAGE, this.WEBSQL = r.WEBSQL, this._defaultConfig = n({}, a), this._config = n({}, this._defaultConfig, t), this._driverSet = null, this._initDriver = null, this._ready = !1, this._dbInfo = null, this._wrapLibraryMethodsWithReady(), this.setDriver(this._config.driver) } return e.prototype.config = function (t) { if ("object" == typeof t) { if (this._ready) return new Error("Can't call config() after localforage has been used."); for (var e in t) "storeName" === e && (t[e] = t[e].replace(/\W/g, "_")), this._config[e] = t[e]; return "driver" in t && t.driver && this.setDriver(this._config.driver), !0 } return "string" == typeof t ? this._config[t] : this._config }, e.prototype.defineDriver = function (c, t, e) { var i = new Promise(function (e, i) { try { var n = c._driver, t = new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"), s = new Error("Custom driver name already in use: " + c._driver); if (!c._driver) return void i(t); if (l(c._driver)) return void i(s); for (var r = p.concat("_initStorage"), o = 0; o < r.length; o++) { var a = r[o]; if (!a || !c[a] || "function" != typeof c[a]) return void i(t) } var h = Promise.resolve(!0); "_support" in c && (h = c._support && "function" == typeof c._support ? c._support() : Promise.resolve(!!c._support)), h.then(function (t) { d[n] = t, u[n] = c, e() }, i) } catch (t) { i(t) } }); return i.then(t, e), i }, e.prototype.driver = function () { return this._driver || null }, e.prototype.getDriver = function (t, e, i) { var n = this, s = function () { if (l(t)) switch (t) { case n.INDEXEDDB: return new Promise(function (t, e) { t(c(1)) }); case n.LOCALSTORAGE: return new Promise(function (t, e) { t(c(2)) }); case n.WEBSQL: return new Promise(function (t, e) { t(c(4)) }) } else if (u[t]) return Promise.resolve(u[t]); return Promise.reject(new Error("Driver not found.")) }(); return s.then(e, i), s }, e.prototype.getSerializer = function (e) { var t = new Promise(function (t, e) { t(c(3)) }); return e && "function" == typeof e && t.then(function (t) { e(t) }), t }, e.prototype.ready = function (t) { var e = this, i = e._driverSet.then(function () { return null === e._ready && (e._ready = e._initDriver()), e._ready }); return i.then(t, t), i }, e.prototype.setDriver = function (t, e, i) { function r() { o._config.driver = o.driver() } var o = this; h(t) || (t = [t]); var n = this._getSupportedDrivers(t), s = null !== this._driverSet ? this._driverSet.catch(function () { return Promise.resolve() }) : Promise.resolve(); return this._driverSet = s.then(function () { var t = n[0]; return o._dbInfo = null, o._ready = null, o.getDriver(t).then(function (t) { var s; o._driver = t._driver, r(), o._wrapLibraryMethodsWithReady(), o._initDriver = (s = n, function () { var n = 0; return function t() { for (; n < s.length;) { var e = s[n]; return n++, o._dbInfo = null, o._ready = null, o.getDriver(e).then(function (t) { return o._extend(t), r(), o._ready = o._initStorage(o._config), o._ready }).catch(t) } r(); var i = new Error("No available storage method found."); return o._driverSet = Promise.reject(i), o._driverSet }() }) }) }).catch(function () { r(); var t = new Error("No available storage method found."); return o._driverSet = Promise.reject(t), o._driverSet }), this._driverSet.then(e, i), this._driverSet }, e.prototype.supports = function (t) { return !!d[t] }, e.prototype._extend = function (t) { n(this, t) }, e.prototype._getSupportedDrivers = function (t) { for (var e = [], i = 0, n = t.length; i < n; i++) { var s = t[i]; this.supports(s) && e.push(s) } return e }, e.prototype._wrapLibraryMethodsWithReady = function () { for (var t = 0; t < p.length; t++) i(this, p[t]) }, e.prototype.createInstance = function (t) { return new e(t) }, e }()) }("undefined" != typeof window ? window : self); e.default = i, t.exports = e.default }, function (t, e) { "use strict"; e.__esModule = !0; var i = function (l) { function r(e, i) { e = e || [], i = i || {}; try { return new Blob(e, i) } catch (t) { if ("TypeError" !== t.name) throw t; for (var n = new (l.BlobBuilder || l.MSBlobBuilder || l.MozBlobBuilder || l.WebKitBlobBuilder), s = 0; s < e.length; s += 1) n.append(e[s]); return n.getBlob(i.type) } } function h(n) { return new Promise(function (s, e) { var t = r([""], { type: "image/png" }), i = n.transaction([y], "readwrite"); i.objectStore(y).put(t, "key"), i.oncomplete = function () { var t = n.transaction([y], "readwrite").objectStore(y).get("key"); t.onerror = e, t.onsuccess = function (t) { var n, e = t.target.result, i = URL.createObjectURL(e); (n = i, new Promise(function (t, e) { var i = new XMLHttpRequest; i.open("GET", n), i.withCredentials = !0, i.responseType = "arraybuffer", i.onreadystatechange = function () { return 4 === i.readyState ? 200 === i.status ? t({ response: i.response, type: i.getResponseHeader("Content-Type") }) : void e({ status: i.status, response: i.response }) : void 0 }, i.send() })).then(function (t) { s(!(!t || "image/png" !== t.type)) }, function () { s(!1) }).then(function () { URL.revokeObjectURL(i) }) } }, i.onerror = i.onabort = e }).catch(function () { return !1 }) } function a(t) { return r([function (t) { for (var e = t.length, i = new ArrayBuffer(e), n = new Uint8Array(i), s = 0; s < e; s++) n[s] = t.charCodeAt(s); return i }(atob(t.data))], { type: t.type }) } function c(t) { return t && t.__local_forage_encoded_blob } function u(t) { var e = this, i = e._initReady().then(function () { var t = m[e._dbInfo.name]; return t && t.dbReady ? t.dbReady : void 0 }); return i.then(t, t), i } function p(o, a) { return new Promise(function (e, t) { if (o.db) { if (!a) return e(o.db); i = m[o.name], (n = {}).promise = new Promise(function (t) { n.resolve = t }), i.deferredOperations.push(n), i.dbReady ? i.dbReady = i.dbReady.then(function () { return n.promise }) : i.dbReady = n.promise, o.db.close() } var i, n, s = [o.name]; a && s.push(o.version); var r = f.open.apply(f, s); a && (r.onupgradeneeded = function (e) { var t = r.result; try { t.createObjectStore(o.storeName), e.oldVersion <= 1 && t.createObjectStore(y) } catch (t) { if ("ConstraintError" !== t.name) throw t; l.console.warn('The database "' + o.name + '" has been upgraded from version ' + e.oldVersion + " to version " + e.newVersion + ', but the storage "' + o.storeName + '" already exists.') } }), r.onerror = function () { t(r.error) }, r.onsuccess = function () { var t; e(r.result), (t = m[o.name].deferredOperations.pop()) && t.resolve() } }) } function d(t, e) { e && t.then(function (t) { e(null, t) }, function (t) { e(t) }) } var f = f || l.indexedDB || l.webkitIndexedDB || l.mozIndexedDB || l.OIndexedDB || l.msIndexedDB; if (f) { var g, m, y = "local-forage-detect-blob-support"; return { _driver: "asyncStorage", _initStorage: function (t) { function e() { return Promise.resolve() } var n = this, s = { db: null }; if (t) for (var i in t) s[i] = t[i]; m || (m = {}); var r = m[s.name]; r || (r = { forages: [], db: null, dbReady: null, deferredOperations: [] }, m[s.name] = r), r.forages.push(n), n._initReady || (n._initReady = n.ready, n.ready = u); for (var o = [], a = 0; a < r.forages.length; a++) { var h = r.forages[a]; h !== n && o.push(h._initReady().catch(e)) } var c = r.forages.slice(0); return Promise.all(o).then(function () { return s.db = r.db, p(s, !1) }).then(function (t) { return s.db = t, function (t, e) { if (!t.db) return !0; var i = !t.db.objectStoreNames.contains(t.storeName), n = t.version < t.db.version, s = t.version > t.db.version; if (n && (t.version !== e && l.console.warn('The database "' + t.name + "\" can't be downgraded from version " + t.db.version + " to version " + t.version + "."), t.version = t.db.version), s || i) { if (i) { var r = t.db.version + 1; r > t.version && (t.version = r) } return !0 } return !1 }(s, n._defaultConfig.version) ? p(s, !0) : t }).then(function (t) { s.db = r.db = t, n._dbInfo = s; for (var e = 0; e < c.length; e++) { var i = c[e]; i !== n && (i._dbInfo.db = s.db, i._dbInfo.version = s.version) } }) }, iterate: function (o, t) { var i = this, e = new Promise(function (r, e) { i.ready().then(function () { var t = i._dbInfo, n = t.db.transaction(t.storeName, "readonly").objectStore(t.storeName).openCursor(), s = 1; n.onsuccess = function () { var t = n.result; if (t) { var e = t.value; c(e) && (e = a(e)); var i = o(e, t.key, s++); void 0 !== i ? r(i) : t.continue() } else r() }, n.onerror = function () { e(n.error) } }).catch(e) }); return d(e, t), e }, getItem: function (s, t) { var r = this; "string" != typeof s && (l.console.warn(s + " used as a key, but it is not a string."), s = String(s)); var e = new Promise(function (i, n) { r.ready().then(function () { var t = r._dbInfo, e = t.db.transaction(t.storeName, "readonly").objectStore(t.storeName).get(s); e.onsuccess = function () { var t = e.result; void 0 === t && (t = null), c(t) && (t = a(t)), i(t) }, e.onerror = function () { n(e.error) } }).catch(n) }); return d(e, t), e }, setItem: function (a, e, t) { var i = this; "string" != typeof a && (l.console.warn(a + " used as a key, but it is not a string."), a = String(a)); var n = new Promise(function (s, r) { var o; i.ready().then(function () { return o = i._dbInfo, e instanceof Blob ? (t = o.db, "boolean" == typeof g ? Promise.resolve(g) : h(t).then(function (t) { return g = t })).then(function (t) { return t ? e : (n = e, new Promise(function (i, t) { var e = new FileReader; e.onerror = t, e.onloadend = function (t) { var e = btoa(t.target.result || ""); i({ __local_forage_encoded_blob: !0, data: e, type: n.type }) }, e.readAsBinaryString(n) })); var n }) : e; var t }).then(function (t) { var e = o.db.transaction(o.storeName, "readwrite"), i = e.objectStore(o.storeName); null === t && (t = void 0), e.oncomplete = function () { void 0 === t && (t = null), s(t) }, e.onabort = e.onerror = function () { var t = n.error ? n.error : n.transaction.error; r(t) }; var n = i.put(t, a) }).catch(r) }); return d(n, t), n }, removeItem: function (r, t) { var o = this; "string" != typeof r && (l.console.warn(r + " used as a key, but it is not a string."), r = String(r)); var e = new Promise(function (n, s) { o.ready().then(function () { var t = o._dbInfo, e = t.db.transaction(t.storeName, "readwrite"), i = e.objectStore(t.storeName).delete(r); e.oncomplete = function () { n() }, e.onerror = function () { s(i.error) }, e.onabort = function () { var t = i.error ? i.error : i.transaction.error; s(t) } }).catch(s) }); return d(e, t), e }, clear: function (t) { var r = this, e = new Promise(function (n, s) { r.ready().then(function () { var t = r._dbInfo, e = t.db.transaction(t.storeName, "readwrite"), i = e.objectStore(t.storeName).clear(); e.oncomplete = function () { n() }, e.onabort = e.onerror = function () { var t = i.error ? i.error : i.transaction.error; s(t) } }).catch(s) }); return d(e, t), e }, length: function (t) { var s = this, e = new Promise(function (i, n) { s.ready().then(function () { var t = s._dbInfo, e = t.db.transaction(t.storeName, "readonly").objectStore(t.storeName).count(); e.onsuccess = function () { i(e.result) }, e.onerror = function () { n(e.error) } }).catch(n) }); return d(e, t), e }, key: function (o, t) { var a = this, e = new Promise(function (s, r) { return o < 0 ? void s(null) : void a.ready().then(function () { var t = a._dbInfo, e = t.db.transaction(t.storeName, "readonly").objectStore(t.storeName), i = !1, n = e.openCursor(); n.onsuccess = function () { var t = n.result; return t ? void (0 === o ? s(t.key) : i ? s(t.key) : (i = !0, t.advance(o))) : void s(null) }, n.onerror = function () { r(n.error) } }).catch(r) }); return d(e, t), e }, keys: function (t) { var r = this, e = new Promise(function (n, s) { r.ready().then(function () { var t = r._dbInfo, e = t.db.transaction(t.storeName, "readonly").objectStore(t.storeName).openCursor(), i = []; e.onsuccess = function () { var t = e.result; return t ? (i.push(t.key), void t.continue()) : void n(i) }, e.onerror = function () { s(e.error) } }).catch(s) }); return d(e, t), e } } } }("undefined" != typeof window ? window : self); e.default = i, t.exports = e.default }, function (t, e, n) { "use strict"; e.__esModule = !0; var i = function (s) { function r(t, e) { e && t.then(function (t) { e(null, t) }, function (t) { e(t) }) } var l = null; try { if (!(s.localStorage && "setItem" in s.localStorage)) return; l = s.localStorage } catch (t) { return } return { _driver: "localStorageWrapper", _initStorage: function (t) { var e = {}; if (t) for (var i in t) e[i] = t[i]; return e.keyPrefix = e.name + "/", e.storeName !== this._defaultConfig.storeName && (e.keyPrefix += e.storeName + "/"), this._dbInfo = e, new Promise(function (t, e) { t(n(3)) }).then(function (t) { return e.serializer = t, Promise.resolve() }) }, iterate: function (h, t) { var c = this, e = c.ready().then(function () { for (var t = c._dbInfo, e = t.keyPrefix, i = e.length, n = l.length, s = 1, r = 0; r < n; r++) { var o = l.key(r); if (0 === o.indexOf(e)) { var a = l.getItem(o); if (a && (a = t.serializer.deserialize(a)), void 0 !== (a = h(a, o.substring(i), s++))) return a } } }); return r(e, t), e }, getItem: function (i, t) { var n = this; "string" != typeof i && (s.console.warn(i + " used as a key, but it is not a string."), i = String(i)); var e = n.ready().then(function () { var t = n._dbInfo, e = l.getItem(t.keyPrefix + i); return e && (e = t.serializer.deserialize(e)), e }); return r(e, t), e }, setItem: function (o, t, e) { var a = this; "string" != typeof o && (s.console.warn(o + " used as a key, but it is not a string."), o = String(o)); var i = a.ready().then(function () { void 0 === t && (t = null); var r = t; return new Promise(function (i, n) { var s = a._dbInfo; s.serializer.serialize(t, function (t, e) { if (e) n(e); else try { l.setItem(s.keyPrefix + o, t), i(r) } catch (t) { ("QuotaExceededError" === t.name || "NS_ERROR_DOM_QUOTA_REACHED" === t.name) && n(t), n(t) } }) }) }); return r(i, e), i }, removeItem: function (e, t) { var i = this; "string" != typeof e && (s.console.warn(e + " used as a key, but it is not a string."), e = String(e)); var n = i.ready().then(function () { var t = i._dbInfo; l.removeItem(t.keyPrefix + e) }); return r(n, t), n }, clear: function (t) { var n = this, e = n.ready().then(function () { for (var t = n._dbInfo.keyPrefix, e = l.length - 1; 0 <= e; e--) { var i = l.key(e); 0 === i.indexOf(t) && l.removeItem(i) } }); return r(e, t), e }, length: function (t) { var e = this.keys().then(function (t) { return t.length }); return r(e, t), e }, key: function (i, t) { var n = this, e = n.ready().then(function () { var e, t = n._dbInfo; try { e = l.key(i) } catch (t) { e = null } return e && (e = e.substring(t.keyPrefix.length)), e }); return r(e, t), e }, keys: function (t) { var s = this, e = s.ready().then(function () { for (var t = s._dbInfo, e = l.length, i = [], n = 0; n < e; n++) 0 === l.key(n).indexOf(t.keyPrefix) && i.push(l.key(n).substring(t.keyPrefix.length)); return i }); return r(e, t), e } } }("undefined" != typeof window ? window : self); e.default = i, t.exports = e.default }, function (t, e) { "use strict"; e.__esModule = !0; var i = function (o) { function a(t) { var e, i, n, s, r, o = .75 * t.length, a = t.length, h = 0; "=" === t[t.length - 1] && (o--, "=" === t[t.length - 2] && o--); var c = new ArrayBuffer(o), l = new Uint8Array(c); for (e = 0; e < a; e += 4) i = u.indexOf(t[e]), n = u.indexOf(t[e + 1]), s = u.indexOf(t[e + 2]), r = u.indexOf(t[e + 3]), l[h++] = i << 2 | n >> 4, l[h++] = (15 & n) << 4 | s >> 2, l[h++] = (3 & s) << 6 | 63 & r; return c } function h(t) { var e, i = new Uint8Array(t), n = ""; for (e = 0; e < i.length; e += 3) n += u[i[e] >> 2], n += u[(3 & i[e]) << 4 | i[e + 1] >> 4], n += u[(15 & i[e + 1]) << 2 | i[e + 2] >> 6], n += u[63 & i[e + 2]]; return i.length % 3 == 2 ? n = n.substring(0, n.length - 1) + "=" : i.length % 3 == 1 && (n = n.substring(0, n.length - 2) + "=="), n } var u = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", c = /^~~local_forage_type~([^~]+)~/, l = "__lfsc__:", p = l.length, d = p + "arbf".length; return { serialize: function (e, i) { var t = ""; if (e && (t = e.toString()), e && ("[object ArrayBuffer]" === e.toString() || e.buffer && "[object ArrayBuffer]" === e.buffer.toString())) { var n, s = l; e instanceof ArrayBuffer ? (n = e, s += "arbf") : (n = e.buffer, "[object Int8Array]" === t ? s += "si08" : "[object Uint8Array]" === t ? s += "ui08" : "[object Uint8ClampedArray]" === t ? s += "uic8" : "[object Int16Array]" === t ? s += "si16" : "[object Uint16Array]" === t ? s += "ur16" : "[object Int32Array]" === t ? s += "si32" : "[object Uint32Array]" === t ? s += "ui32" : "[object Float32Array]" === t ? s += "fl32" : "[object Float64Array]" === t ? s += "fl64" : i(new Error("Failed to get type for BinaryArray"))), i(s + h(n)) } else if ("[object Blob]" === t) { var r = new FileReader; r.onload = function () { var t = "~~local_forage_type~" + e.type + "~" + h(this.result); i(l + "blob" + t) }, r.readAsArrayBuffer(e) } else try { i(JSON.stringify(e)) } catch (t) { console.error("Couldn't convert value into a JSON string: ", e), i(null, t) } }, deserialize: function (t) { if (t.substring(0, p) !== l) return JSON.parse(t); var e, i = t.substring(d), n = t.substring(p, d); if ("blob" === n && c.test(i)) { var s = i.match(c); e = s[1], i = i.substring(s[0].length) } var r = a(i); switch (n) { case "arbf": return r; case "blob": return function (e, i) { e = e || [], i = i || {}; try { return new Blob(e, i) } catch (t) { if ("TypeError" !== t.name) throw t; for (var n = new (o.BlobBuilder || o.MSBlobBuilder || o.MozBlobBuilder || o.WebKitBlobBuilder), s = 0; s < e.length; s += 1) n.append(e[s]); return n.getBlob(i.type) } }([r], { type: e }); case "si08": return new Int8Array(r); case "ui08": return new Uint8Array(r); case "uic8": return new Uint8ClampedArray(r); case "si16": return new Int16Array(r); case "ur16": return new Uint16Array(r); case "si32": return new Int32Array(r); case "ui32": return new Uint32Array(r); case "fl32": return new Float32Array(r); case "fl64": return new Float64Array(r); default: throw new Error("Unkown type: " + n) } }, stringToBuffer: a, bufferToString: h } }("undefined" != typeof window ? window : self); e.default = i, t.exports = e.default }, function (t, e, o) { "use strict"; e.__esModule = !0; var i = function (n) { function h(t, e) { e && t.then(function (t) { e(null, t) }, function (t) { e(t) }) } var r = n.openDatabase; if (r) return { _driver: "webSQLStorage", _initStorage: function (t) { var n = this, s = { db: null }; if (t) for (var e in t) s[e] = "string" != typeof t[e] ? t[e].toString() : t[e]; var i = new Promise(function (e, i) { try { s.db = r(s.name, String(s.version), s.description, s.size) } catch (t) { return i(t) } s.db.transaction(function (t) { t.executeSql("CREATE TABLE IF NOT EXISTS " + s.storeName + " (id INTEGER PRIMARY KEY, key unique, value)", [], function () { n._dbInfo = s, e() }, function (t, e) { i(e) }) }) }); return new Promise(function (t, e) { t(o(3)) }).then(function (t) { return s.serializer = t, i }) }, iterate: function (c, t) { var e = this, i = new Promise(function (h, i) { e.ready().then(function () { var a = e._dbInfo; a.db.transaction(function (t) { t.executeSql("SELECT * FROM " + a.storeName, [], function (t, e) { for (var i = e.rows, n = i.length, s = 0; s < n; s++) { var r = i.item(s), o = r.value; if (o && (o = a.serializer.deserialize(o)), void 0 !== (o = c(o, r.key, s + 1))) return void h(o) } h() }, function (t, e) { i(e) }) }) }).catch(i) }); return h(i, t), i }, getItem: function (e, t) { var r = this; "string" != typeof e && (n.console.warn(e + " used as a key, but it is not a string."), e = String(e)); var i = new Promise(function (s, i) { r.ready().then(function () { var n = r._dbInfo; n.db.transaction(function (t) { t.executeSql("SELECT * FROM " + n.storeName + " WHERE key = ? LIMIT 1", [e], function (t, e) { var i = e.rows.length ? e.rows.item(0).value : null; i && (i = n.serializer.deserialize(i)), s(i) }, function (t, e) { i(e) }) }) }).catch(i) }); return h(i, t), i }, setItem: function (o, t, e) { var a = this; "string" != typeof o && (n.console.warn(o + " used as a key, but it is not a string."), o = String(o)); var i = new Promise(function (s, r) { a.ready().then(function () { void 0 === t && (t = null); var i = t, n = a._dbInfo; n.serializer.serialize(t, function (e, t) { t ? r(t) : n.db.transaction(function (t) { t.executeSql("INSERT OR REPLACE INTO " + n.storeName + " (key, value) VALUES (?, ?)", [o, e], function () { s(i) }, function (t, e) { r(e) }) }, function (t) { t.code === t.QUOTA_ERR && r(t) }) }) }).catch(r) }); return h(i, e), i }, removeItem: function (s, t) { var r = this; "string" != typeof s && (n.console.warn(s + " used as a key, but it is not a string."), s = String(s)); var e = new Promise(function (i, n) { r.ready().then(function () { var e = r._dbInfo; e.db.transaction(function (t) { t.executeSql("DELETE FROM " + e.storeName + " WHERE key = ?", [s], function () { i() }, function (t, e) { n(e) }) }) }).catch(n) }); return h(e, t), e }, clear: function (t) { var s = this, e = new Promise(function (i, n) { s.ready().then(function () { var e = s._dbInfo; e.db.transaction(function (t) { t.executeSql("DELETE FROM " + e.storeName, [], function () { i() }, function (t, e) { n(e) }) }) }).catch(n) }); return h(e, t), e }, length: function (t) { var s = this, e = new Promise(function (n, i) { s.ready().then(function () { var e = s._dbInfo; e.db.transaction(function (t) { t.executeSql("SELECT COUNT(key) as c FROM " + e.storeName, [], function (t, e) { var i = e.rows.item(0).c; n(i) }, function (t, e) { i(e) }) }) }).catch(i) }); return h(e, t), e }, key: function (s, t) { var r = this, e = new Promise(function (n, i) { r.ready().then(function () { var e = r._dbInfo; e.db.transaction(function (t) { t.executeSql("SELECT key FROM " + e.storeName + " WHERE id = ? LIMIT 1", [s + 1], function (t, e) { var i = e.rows.length ? e.rows.item(0).key : null; n(i) }, function (t, e) { i(e) }) }) }).catch(i) }); return h(e, t), e }, keys: function (t) { var n = this, e = new Promise(function (s, i) { n.ready().then(function () { var e = n._dbInfo; e.db.transaction(function (t) { t.executeSql("SELECT key FROM " + e.storeName, [], function (t, e) { for (var i = [], n = 0; n < e.rows.length; n++) i.push(e.rows.item(n).key); s(i) }, function (t, e) { i(e) }) }) }).catch(i) }); return h(e, t), e } } }("undefined" != typeof window ? window : self); e.default = i, t.exports = e.default }]) }) } catch (t) { localForageInitFailed = !0 } cr.plugins_.LocalStorage = function (t) { this.runtime = t }, function () { var s = "", r = "", a = [], h = ""; function c(t) { return t ? "string" == typeof t ? t : "string" == typeof t.message ? t.message : "string" == typeof t.name ? t.name : "string" == typeof t.data ? t.data : "unknown error" : "unknown error" } function l(t, e) { h = e, t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, t) } var u = "101", t = void 0 !== window.is_scirra_arcade; function p(t) { return !u || t.substr(0, u.length) === u } t && (u = "sa101" + window.scirra_arcade_id + "_"); var e = cr.plugins_.LocalStorage.prototype; e.Type = function (t) { this.plugin = t, this.runtime = t.runtime }, e.Type.prototype.onCreate = function () { }, e.Instance = function (t) { this.type = t, this.runtime = t.runtime }; var i = e.Instance.prototype; i.onCreate = function () { this.pendingSets = 0, this.pendingGets = 0 }, i.onDestroy = function () { }, i.saveToJSON = function () { return {} }, i.loadFromJSON = function (t) { }; function n() { } function o() { } function d() { } n.prototype.OnItemSet = function (t) { return s === t }, n.prototype.OnAnyItemSet = function () { return !0 }, n.prototype.OnItemGet = function (t) { return s === t }, n.prototype.OnAnyItemGet = function () { return !0 }, n.prototype.OnItemRemoved = function (t) { return s === t }, n.prototype.OnAnyItemRemoved = function () { return !0 }, n.prototype.OnCleared = function () { return !0 }, n.prototype.OnAllKeyNamesLoaded = function () { return !0 }, n.prototype.OnError = function () { return !0 }, n.prototype.OnItemExists = function (t) { return s === t }, n.prototype.OnItemMissing = function (t) { return s === t }, n.prototype.CompareKey = function (t, e) { return cr.do_cmp(s, t, e) }, n.prototype.CompareValue = function (t, e) { return cr.do_cmp(r, t, e) }, n.prototype.IsProcessingSets = function () { return 0 < this.pendingSets }, n.prototype.IsProcessingGets = function () { return 0 < this.pendingGets }, n.prototype.OnAllSetsComplete = function () { return !0 }, n.prototype.OnAllGetsComplete = function () { return !0 }, e.cnds = new n, o.prototype.SetItem = function (i, t) { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else { var e = u + i; this.pendingSets++; var n = this; localforage.setItem(e, t, function (t, e) { !0, n.pendingSets--, t ? (h = c(t), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, n)) : (s = i, r = e, n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet, n), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet, n), r = s = ""), 0 === n.pendingSets && n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete, n) }) } }, o.prototype.GetItem = function (i) { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else { var t = u + i; this.pendingGets++; var n = this; localforage.getItem(t, function (t, e) { n.pendingGets--, t ? (h = c(t), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, n)) : (s = i, null == (r = e) && (r = ""), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet, n), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet, n), r = s = ""), 0 === n.pendingGets && n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete, n) }) } }, o.prototype.CheckItemExists = function (i) { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else { var t = u + i, n = this; localforage.getItem(t, function (t, e) { t ? (h = c(t), n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, n)) : (s = i, null === e ? (r = "", n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing, n)) : (r = e, n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists, n)), r = s = "") }) } }, o.prototype.RemoveItem = function (e) { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else { var t = u + e, i = this; localforage.removeItem(t, function (t) { !0, t ? (h = c(t), i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, i)) : (s = e, r = "", i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved, i), i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved, i), s = "") }) } }, o.prototype.ClearStorage = function () { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else if (!t) { var e = this; localforage.clear(function (t) { !0, t ? (h = c(t), e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, e)) : (r = s = "", cr.clearArray(a), e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared, e)) }) } }, o.prototype.GetAllKeyNames = function () { if (localForageInitFailed) l(this, "storage failed to initialise - may be disabled in browser settings"); else { var o = this; localforage.keys(function (t, e) { var i, n, s, r; if (t) h = c(t), o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError, o); else { for (cr.clearArray(a), i = 0, n = e.length; i < n; ++i) p(s = e[i]) && a.push((r = s, u ? p(r) ? r.substr(u.length) : void 0 : r)); o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded, o) } }) } }, e.acts = new o, d.prototype.ItemValue = function (t) { t.set_any(r) }, d.prototype.Key = function (t) { t.set_string(s) }, d.prototype.KeyCount = function (t) { t.set_int(a.length) }, d.prototype.KeyAt = function (t, e) { (e = Math.floor(e)) < 0 || e >= a.length ? t.set_string("") : t.set_string(a[e]) }, d.prototype.ErrorMessage = function (t) { t.set_string(h) }, e.exps = new d }(), cr.plugins_.Mouse = function (t) { this.runtime = t }, function () { var t = cr.plugins_.Mouse.prototype; t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime, this.buttonMap = new Array(4), this.mouseXcanvas = 0, this.mouseYcanvas = 0, this.triggerButton = 0, this.triggerType = 0, this.triggerDir = 0, this.handled = !1 }; var e = t.Instance.prototype; e.onCreate = function () { var e = this; if (!this.runtime.isDomFree) { jQuery(document).mousemove(function (t) { e.onMouseMove(t) }), jQuery(document).mousedown(function (t) { e.onMouseDown(t) }), jQuery(document).mouseup(function (t) { e.onMouseUp(t) }), jQuery(document).dblclick(function (t) { e.onDoubleClick(t) }); var t = function (t) { e.onWheel(t) }; document.addEventListener("mousewheel", t, !1), document.addEventListener("DOMMouseScroll", t, !1) } }; var i = { left: 0, top: 0 }; function n() { } function s() { } e.onMouseMove = function (t) { var e = this.runtime.isDomFree ? i : jQuery(this.runtime.canvas).offset(); this.mouseXcanvas = t.pageX - e.left, this.mouseYcanvas = t.pageY - e.top }, e.mouseInGame = function () { return 0 < this.runtime.fullscreen_mode || 0 <= this.mouseXcanvas && 0 <= this.mouseYcanvas && this.mouseXcanvas < this.runtime.width && this.mouseYcanvas < this.runtime.height }, e.onMouseDown = function (t) { this.mouseInGame() && (this.buttonMap[t.which] = !0, this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick, this), this.triggerButton = t.which - 1, this.triggerType = 0, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick, this), this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked, this), this.runtime.isInUserInputEvent = !1) }, e.onMouseUp = function (t) { this.buttonMap[t.which] && (this.runtime.had_a_click && !this.runtime.isMobile && t.preventDefault(), this.runtime.had_a_click = !0, this.buttonMap[t.which] = !1, this.runtime.isInUserInputEvent = !0, this.triggerButton = t.which - 1, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease, this), this.runtime.isInUserInputEvent = !1) }, e.onDoubleClick = function (t) { this.mouseInGame() && (t.preventDefault(), this.runtime.isInUserInputEvent = !0, this.triggerButton = t.which - 1, this.triggerType = 1, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick, this), this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked, this), this.runtime.isInUserInputEvent = !1) }, e.onWheel = function (t) { var e = t.wheelDelta ? t.wheelDelta : t.detail ? -t.detail : 0; this.triggerDir = e < 0 ? 0 : 1, this.handled = !1, this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel, this), this.runtime.isInUserInputEvent = !1, this.handled && cr.isCanvasInputEvent(t) && t.preventDefault() }, e.onWindowBlur = function () { var t, e; for (t = 0, e = this.buttonMap.length; t < e; ++t) this.buttonMap[t] && (this.buttonMap[t] = !1, this.triggerButton = t - 1, this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease, this)) }, n.prototype.OnClick = function (t, e) { return t === this.triggerButton && e === this.triggerType }, n.prototype.OnAnyClick = function () { return !0 }, n.prototype.IsButtonDown = function (t) { return this.buttonMap[t + 1] }, n.prototype.OnRelease = function (t) { return t === this.triggerButton }, n.prototype.IsOverObject = function (t) { var e = this.runtime.getCurrentCondition(), i = this.mouseXcanvas, n = this.mouseYcanvas; return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(t, i, n, e.inverted), e.inverted) }, n.prototype.OnObjectClicked = function (t, e, i) { return t === this.triggerButton && e === this.triggerType && this.runtime.testAndSelectCanvasPointOverlap(i, this.mouseXcanvas, this.mouseYcanvas, !1) }, n.prototype.OnWheel = function (t) { return this.handled = !0, t === this.triggerDir }, t.cnds = new n; var r = null; function o() { } s.prototype.SetCursor = function (t) { if (!this.runtime.isDomFree) { var e = ["auto", "pointer", "text", "crosshair", "move", "help", "wait", "none"][t]; r !== e && (r = e, document.body.style.cursor = e) } }, s.prototype.SetCursorSprite = function (t) { if (!this.runtime.isDomFree && !this.runtime.isMobile && t) { var e = t.getFirstPicked(); if (e && e.curFrame) { var i = e.curFrame; if (r !== i) { var n = "url(" + (r = i).getDataUri() + ") " + Math.round(i.hotspotX * i.width) + " " + Math.round(i.hotspotY * i.height) + ", auto"; document.body.style.cursor = "", document.body.style.cursor = n } } } }, t.acts = new s, o.prototype.X = function (t, e) { var i, n, s, r, o; cr.is_undefined(e) ? (n = (i = this.runtime.getLayerByNumber(0)).scale, s = i.zoomRate, r = i.parallaxX, o = i.angle, i.scale = 1, i.zoomRate = 1, i.parallaxX = 1, i.angle = 0, t.set_float(i.canvasToLayer(this.mouseXcanvas, this.mouseYcanvas, !0)), i.scale = n, i.zoomRate = s, i.parallaxX = r, i.angle = o) : (i = cr.is_number(e) ? this.runtime.getLayerByNumber(e) : this.runtime.getLayerByName(e)) ? t.set_float(i.canvasToLayer(this.mouseXcanvas, this.mouseYcanvas, !0)) : t.set_float(0) }, o.prototype.Y = function (t, e) { var i, n, s, r, o; cr.is_undefined(e) ? (n = (i = this.runtime.getLayerByNumber(0)).scale, s = i.zoomRate, r = i.parallaxY, o = i.angle, i.scale = 1, i.zoomRate = 1, i.parallaxY = 1, i.angle = 0, t.set_float(i.canvasToLayer(this.mouseXcanvas, this.mouseYcanvas, !1)), i.scale = n, i.zoomRate = s, i.parallaxY = r, i.angle = o) : (i = cr.is_number(e) ? this.runtime.getLayerByNumber(e) : this.runtime.getLayerByName(e)) ? t.set_float(i.canvasToLayer(this.mouseXcanvas, this.mouseYcanvas, !1)) : t.set_float(0) }, o.prototype.AbsoluteX = function (t) { t.set_float(this.mouseXcanvas) }, o.prototype.AbsoluteY = function (t) { t.set_float(this.mouseYcanvas) }, t.exps = new o }(), cr.plugins_.Sprite = function (t) { this.runtime = t }, function () { var t = cr.plugins_.Sprite.prototype; t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }; var e = t.Type.prototype; function l() { if (0 === this.datauri.length) { var t = document.createElement("canvas"); t.width = this.width, t.height = this.height; var e = t.getContext("2d"); this.spritesheeted ? e.drawImage(this.texture_img, this.offx, this.offy, this.width, this.height, 0, 0, this.width, this.height) : e.drawImage(this.texture_img, 0, 0, this.width, this.height), this.datauri = t.toDataURL("image/png") } return this.datauri } e.onCreate = function () { var t, e, i, n, s, r, o, a, h, c; if (!this.is_family) for (this.all_frames = [], this.has_loaded_textures = !1, t = 0, e = this.animations.length; t < e; t++) { for (s = this.animations[t], (o = {}).name = s[0], o.speed = s[1], o.loop = s[2], o.repeatcount = s[3], o.repeatto = s[4], o.pingpong = s[5], o.sid = s[6], o.frames = [], i = 0, n = s[7].length; i < n; i++) r = s[7][i], (a = {}).texture_file = r[0], a.texture_filesize = r[1], a.offx = r[2], a.offy = r[3], a.width = r[4], a.height = r[5], a.duration = r[6], a.hotspotX = r[7], a.hotspotY = r[8], a.image_points = r[9], a.poly_pts = r[10], a.pixelformat = r[11], a.spritesheeted = 0 !== a.width, a.datauri = "", a.getDataUri = l, c = { left: 0, top: 0, right: 1, bottom: 1 }, a.sheetTex = c, a.webGL_texture = null, (h = this.runtime.findWaitingTexture(r[0])) ? a.texture_img = h : (a.texture_img = new Image, a.texture_img.cr_src = r[0], a.texture_img.cr_filesize = r[1], a.texture_img.c2webGL_texture = null, this.runtime.waitForImageLoad(a.texture_img, r[0])), cr.seal(a), o.frames.push(a), this.all_frames.push(a); cr.seal(o), this.animations[t] = o } }, e.updateAllCurrentTexture = function () { var t, e, i; for (t = 0, e = this.instances.length; t < e; t++) (i = this.instances[t]).curWebGLTexture = i.curFrame.webGL_texture }, e.onLostWebGLContext = function () { if (!this.is_family) { var t, e, i; for (t = 0, e = this.all_frames.length; t < e; ++t) (i = this.all_frames[t]).texture_img.c2webGL_texture = null, i.webGL_texture = null; this.has_loaded_textures = !1, this.updateAllCurrentTexture() } }, e.onRestoreWebGLContext = function () { if (!this.is_family && this.instances.length) { var t, e, i; for (t = 0, e = this.all_frames.length; t < e; ++t) (i = this.all_frames[t]).webGL_texture = this.runtime.glwrap.loadTexture(i.texture_img, !1, this.runtime.linearSampling, i.pixelformat); this.updateAllCurrentTexture() } }, e.loadTextures = function () { if (!this.is_family && !this.has_loaded_textures && this.runtime.glwrap) { var t, e, i; for (t = 0, e = this.all_frames.length; t < e; ++t) (i = this.all_frames[t]).webGL_texture = this.runtime.glwrap.loadTexture(i.texture_img, !1, this.runtime.linearSampling, i.pixelformat); this.has_loaded_textures = !0 } }, e.unloadTextures = function () { if (!this.is_family && !this.instances.length && this.has_loaded_textures) { var t, e, i; for (t = 0, e = this.all_frames.length; t < e; ++t) i = this.all_frames[t], this.runtime.glwrap.deleteTexture(i.webGL_texture), i.webGL_texture = null; this.has_loaded_textures = !1 } }; var s = []; e.preloadCanvas2D = function (t) { var e, i, n; for (cr.clearArray(s), e = 0, i = this.all_frames.length; e < i; ++e) n = this.all_frames[e].texture_img, -1 === s.indexOf(n) && (t.drawImage(n, 0, 0), s.push(n)) }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime; var e = this.type.animations[0].frames[0].poly_pts; this.recycled ? this.collision_poly.set_pts(e) : this.collision_poly = new cr.CollisionPoly(e) }; var i = t.Instance.prototype; function n() { } i.onCreate = function () { this.visible = 0 === this.properties[0], this.isTicking = !1, this.inAnimTrigger = !1, this.collisionsEnabled = 0 !== this.properties[3], this.cur_animation = this.getAnimationByName(this.properties[1]) || this.type.animations[0], this.cur_frame = this.properties[2], this.cur_frame < 0 && (this.cur_frame = 0), this.cur_frame >= this.cur_animation.frames.length && (this.cur_frame = this.cur_animation.frames.length - 1); var t, e, i, n, s, r, o, a, h = this.cur_animation.frames[this.cur_frame]; for (this.collision_poly.set_pts(h.poly_pts), this.hotspotX = h.hotspotX, this.hotspotY = h.hotspotY, this.cur_anim_speed = this.cur_animation.speed, this.cur_anim_repeatto = this.cur_animation.repeatto, 1 === this.type.animations.length && 1 === this.type.animations[0].frames.length || 0 === this.cur_anim_speed || (this.runtime.tickMe(this), this.isTicking = !0), this.recycled ? this.animTimer.reset() : this.animTimer = new cr.KahanAdder, this.frameStart = this.getNowTime(), this.animPlaying = !0, this.animRepeats = 0, this.animForwards = !0, this.animTriggerName = "", this.changeAnimName = "", this.changeAnimFrom = 0, this.changeAnimFrame = -1, this.type.loadTextures(), t = 0, e = this.type.animations.length; t < e; t++) for (i = 0, n = (s = this.type.animations[t]).frames.length; i < n; i++) 0 === (r = s.frames[i]).width && (r.width = r.texture_img.width, r.height = r.texture_img.height), r.spritesheeted && (a = r.texture_img, (o = r.sheetTex).left = r.offx / a.width, o.top = r.offy / a.height, o.right = (r.offx + r.width) / a.width, o.bottom = (r.offy + r.height) / a.height, 0 === r.offx && 0 === r.offy && r.width === a.width && r.height === a.height && (r.spritesheeted = !1)); this.curFrame = this.cur_animation.frames[this.cur_frame], this.curWebGLTexture = this.curFrame.webGL_texture }, i.saveToJSON = function () { var t = { a: this.cur_animation.sid, f: this.cur_frame, cas: this.cur_anim_speed, fs: this.frameStart, ar: this.animRepeats, at: this.animTimer.sum, rt: this.cur_anim_repeatto }; return this.animPlaying || (t.ap = this.animPlaying), this.animForwards || (t.af = this.animForwards), t }, i.loadFromJSON = function (t) { var e = this.getAnimationBySid(t.a); e && (this.cur_animation = e), this.cur_frame = t.f, this.cur_frame < 0 && (this.cur_frame = 0), this.cur_frame >= this.cur_animation.frames.length && (this.cur_frame = this.cur_animation.frames.length - 1), this.cur_anim_speed = t.cas, this.frameStart = t.fs, this.animRepeats = t.ar, this.animTimer.reset(), this.animTimer.sum = t.at, this.animPlaying = !t.hasOwnProperty("ap") || t.ap, this.animForwards = !t.hasOwnProperty("af") || t.af, t.hasOwnProperty("rt") ? this.cur_anim_repeatto = t.rt : this.cur_anim_repeatto = this.cur_animation.repeatto, this.curFrame = this.cur_animation.frames[this.cur_frame], this.curWebGLTexture = this.curFrame.webGL_texture, this.collision_poly.set_pts(this.curFrame.poly_pts), this.hotspotX = this.curFrame.hotspotX, this.hotspotY = this.curFrame.hotspotY }, i.animationFinish = function (t) { this.cur_frame = t ? 0 : this.cur_animation.frames.length - 1, this.animPlaying = !1, this.animTriggerName = this.cur_animation.name, this.inAnimTrigger = !0, this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished, this), this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished, this), this.inAnimTrigger = !1, this.animRepeats = 0 }, i.getNowTime = function () { return this.animTimer.sum }, i.tick = function () { this.animTimer.add(this.runtime.getDt(this)), this.changeAnimName.length && this.doChangeAnim(), 0 <= this.changeAnimFrame && this.doChangeAnimFrame(); var t, e = this.getNowTime(), i = this.cur_animation, n = i.frames[this.cur_frame], s = n.duration / this.cur_anim_speed; this.animPlaying && e >= this.frameStart + s && (this.animForwards ? this.cur_frame++ : this.cur_frame--, this.frameStart += s, this.cur_frame >= i.frames.length && (i.pingpong ? (this.animForwards = !1, this.cur_frame = i.frames.length - 2) : i.loop ? this.cur_frame = this.cur_anim_repeatto : (this.animRepeats++, this.animRepeats >= i.repeatcount ? this.animationFinish(!1) : this.cur_frame = this.cur_anim_repeatto)), this.cur_frame < 0 && (i.pingpong ? (this.cur_frame = 1, this.animForwards = !0, i.loop || (this.animRepeats++, this.animRepeats >= i.repeatcount && this.animationFinish(!0))) : i.loop ? this.cur_frame = this.cur_anim_repeatto : (this.animRepeats++, this.animRepeats >= i.repeatcount ? this.animationFinish(!0) : this.cur_frame = this.cur_anim_repeatto)), this.cur_frame < 0 ? this.cur_frame = 0 : this.cur_frame >= i.frames.length && (this.cur_frame = i.frames.length - 1), e > this.frameStart + i.frames[this.cur_frame].duration / this.cur_anim_speed && (this.frameStart = e), t = i.frames[this.cur_frame], this.OnFrameChanged(n, t), this.runtime.redraw = !0) }, i.getAnimationByName = function (t) { var e, i, n; for (e = 0, i = this.type.animations.length; e < i; e++) if (n = this.type.animations[e], cr.equals_nocase(n.name, t)) return n; return null }, i.getAnimationBySid = function (t) { var e, i, n; for (e = 0, i = this.type.animations.length; e < i; e++) if ((n = this.type.animations[e]).sid === t) return n; return null }, i.doChangeAnim = function () { var t = this.cur_animation.frames[this.cur_frame], e = this.getAnimationByName(this.changeAnimName); this.changeAnimName = "", e && (cr.equals_nocase(e.name, this.cur_animation.name) && this.animPlaying || (this.cur_animation = e, this.cur_anim_speed = e.speed, this.cur_anim_repeatto = e.repeatto, this.cur_frame < 0 && (this.cur_frame = 0), this.cur_frame >= this.cur_animation.frames.length && (this.cur_frame = this.cur_animation.frames.length - 1), 1 === this.changeAnimFrom && (this.cur_frame = 0), this.animPlaying = !0, this.frameStart = this.getNowTime(), this.animForwards = !0, this.OnFrameChanged(t, this.cur_animation.frames[this.cur_frame]), this.runtime.redraw = !0)) }, i.doChangeAnimFrame = function () { var t = this.cur_animation.frames[this.cur_frame], e = this.cur_frame; this.cur_frame = cr.floor(this.changeAnimFrame), this.cur_frame < 0 && (this.cur_frame = 0), this.cur_frame >= this.cur_animation.frames.length && (this.cur_frame = this.cur_animation.frames.length - 1), e !== this.cur_frame && (this.OnFrameChanged(t, this.cur_animation.frames[this.cur_frame]), this.frameStart = this.getNowTime(), this.runtime.redraw = !0), this.changeAnimFrame = -1 }, i.OnFrameChanged = function (t, e) { var i, n, s, r = t.width, o = t.height, a = e.width, h = e.height; for (r != a && (this.width *= a / r), o != h && (this.height *= h / o), this.hotspotX = e.hotspotX, this.hotspotY = e.hotspotY, this.collision_poly.set_pts(e.poly_pts), this.set_bbox_changed(), this.curFrame = e, this.curWebGLTexture = e.webGL_texture, i = 0, n = this.behavior_insts.length; i < n; i++) (s = this.behavior_insts[i]).onSpriteFrameChanged && s.onSpriteFrameChanged(t, e); this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged, this) }, i.draw = function (t) { t.globalAlpha = this.opacity; var e = this.curFrame, i = e.spritesheeted, n = e.texture_img, s = this.x, r = this.y, o = this.width, a = this.height; if (0 === this.angle && 0 <= o && 0 <= a) s -= this.hotspotX * o, r -= this.hotspotY * a, this.runtime.pixel_rounding && (s = Math.round(s), r = Math.round(r)), i ? t.drawImage(n, e.offx, e.offy, e.width, e.height, s, r, o, a) : t.drawImage(n, s, r, o, a); else { this.runtime.pixel_rounding && (s = Math.round(s), r = Math.round(r)), t.save(); var h = 0 < o ? 1 : -1, c = 0 < a ? 1 : -1; t.translate(s, r), 1 === h && 1 === c || t.scale(h, c), t.rotate(this.angle * h * c); var l = 0 - this.hotspotX * cr.abs(o), u = 0 - this.hotspotY * cr.abs(a); i ? t.drawImage(n, e.offx, e.offy, e.width, e.height, l, u, cr.abs(o), cr.abs(a)) : t.drawImage(n, l, u, cr.abs(o), cr.abs(a)), t.restore() } }, i.drawGL_earlyZPass = function (t) { this.drawGL(t) }, i.drawGL = function (t) { t.setTexture(this.curWebGLTexture), t.setOpacity(this.opacity); var e = this.curFrame, i = this.bquad; if (this.runtime.pixel_rounding) { var n = Math.round(this.x) - this.x, s = Math.round(this.y) - this.y; e.spritesheeted ? t.quadTex(i.tlx + n, i.tly + s, i.trx + n, i.try_ + s, i.brx + n, i.bry + s, i.blx + n, i.bly + s, e.sheetTex) : t.quad(i.tlx + n, i.tly + s, i.trx + n, i.try_ + s, i.brx + n, i.bry + s, i.blx + n, i.bly + s) } else e.spritesheeted ? t.quadTex(i.tlx, i.tly, i.trx, i.try_, i.brx, i.bry, i.blx, i.bly, e.sheetTex) : t.quad(i.tlx, i.tly, i.trx, i.try_, i.brx, i.bry, i.blx, i.bly) }, i.getImagePointIndexByName = function (t) { var e, i, n = this.curFrame; for (e = 0, i = n.image_points.length; e < i; e++) if (cr.equals_nocase(t, n.image_points[e][0])) return e; return -1 }, i.getImagePoint = function (t, e) { var i, n = this.curFrame, s = n.image_points; if (i = cr.is_string(t) ? this.getImagePointIndexByName(t) : t - 1, (i = cr.floor(i)) < 0 || i >= s.length) return e ? this.x : this.y; var r = (s[i][1] - n.hotspotX) * this.width, o = s[i][2]; o = (o - n.hotspotY) * this.height; var a = Math.cos(this.angle), h = Math.sin(this.angle), c = r * a - o * h; return o = o * a + r * h, r = c, r += this.x, o += this.y, e ? r : o }; var h = []; function O(t) { t[0] = 0, t[1] = 0, t[2] = 0, h.push(t) } function A(t, e) { return t < e ? t + "," + e : e + "," + t } function C(t, e, i, n) { var s = e.uid, r = i.uid, o = A(s, r); if (t.hasOwnProperty(o)) t[o][2] = n; else { var a = h.length ? h.pop() : [0, 0, 0]; a[0] = s, a[1] = r, a[2] = n, t[o] = a } } var E = -2; var k = []; n.prototype.OnCollision = function (t) { if (!t) return !1; var e = this.runtime, i = e.getCurrentCondition(), n = i.type, s = null; i.extra.collmemory ? s = i.extra.collmemory : (s = {}, i.extra.collmemory = s), i.extra.spriteCreatedDestroyCallback || (i.extra.spriteCreatedDestroyCallback = !0, e.addDestroyCallback(function (t) { !function (t, e) { var i, n, s = e.uid; for (i in t) t.hasOwnProperty(i) && ((n = t[i])[0] !== s && n[1] !== s || (O(t[i]), delete t[i])) }(i.extra.collmemory, t) })); var r, o, a, h, c, l, u, p, d, f, g, m, y, _, v = n.getCurrentSol(), b = t.getCurrentSol(), w = v.getObjects(), x = this.runtime.tickcount, S = x - 1, T = e.getCurrentEventStack().current_event; T.orblock; for (o = 0; o < w.length; o++) { for (a = w[o], b.select_all ? (a.update_bbox(), this.runtime.getCollisionCandidates(a.layer, t, a.bbox, k), r = k, this.runtime.addRegisteredCollisionCandidates(a, t, r)) : r = b.getObjects(), h = 0; h < r.length; h++) c = r[h], e.testOverlap(a, c) || e.checkRegisteredCollision(a, c) ? (m = s, y = c, void 0, _ = A(a.uid, y.uid), p = !(m.hasOwnProperty(_) ? (E = m[_][2], !0) : !(E = -2)) || E < S, C(s, a, c, x), p && (e.pushCopySol(T.solModifiers), l = n.getCurrentSol(), u = t.getCurrentSol(), l.select_all = !1, u.select_all = !1, n === t ? (l.instances.length = 2, l.instances[0] = a, l.instances[1] = c, n.applySolToContainer()) : (l.instances.length = 1, u.instances.length = 1, l.instances[0] = a, u.instances[0] = c, n.applySolToContainer(), t.applySolToContainer()), T.retrigger(), e.popSol(T.solModifiers))) : (d = s, f = c, void 0, g = A(a.uid, f.uid), d.hasOwnProperty(g) && (O(d[g]), delete d[g])); cr.clearArray(k) } return !1 }; var m = null, y = new cr.ObjectSet, _ = !1, v = [], b = new cr.rect(0, 0, 0, 0); function r(t, e, i) { if (!t) return !1; var n, s, r, o, a, h, c = 0 !== e || 0 !== i, l = !1, u = this.runtime.getCurrentCondition(), p = u.type, d = u.inverted, f = t.getCurrentSol(), g = this.runtime.getCurrentEventStack().current_event.orblock; for (f.select_all ? (this.update_bbox(), b.copy(this.bbox), b.offset(e, i), this.runtime.getCollisionCandidates(this.layer, t, b, v), h = v) : h = g ? this.runtime.isCurrentConditionFirst() && !f.else_instances.length && f.instances.length ? f.instances : f.else_instances : f.instances, _ = p !== (m = t) && !d, c && (n = this.x, s = this.y, this.x += e, this.y += i, this.set_bbox_changed()), r = 0, o = h.length; r < o; r++) if (a = h[r], this.runtime.testOverlap(this, a)) { if (l = !0, d) break; p !== t && y.add(a) } return c && (this.x = n, this.y = s, this.set_bbox_changed()), cr.clearArray(v), l } function o() { } function a() { } e.finish = function (t) { if (_) { if (t) { var e, i, n, s = this.runtime.getCurrentEventStack().current_event.orblock, r = m.getCurrentSol(), o = y.valuesRef(); if (r.select_all) { for (r.select_all = !1, cr.clearArray(r.instances), e = 0, i = o.length; e < i; ++e) r.instances[e] = o[e]; if (s) for (cr.clearArray(r.else_instances), e = 0, i = m.instances.length; e < i; ++e) n = m.instances[e], y.contains(n) || r.else_instances.push(n) } else if (s) { var a = r.instances.length; for (e = 0, i = o.length; e < i; ++e) r.instances[a + e] = o[e], cr.arrayFindRemove(r.else_instances, o[e]) } else cr.shallowAssignArray(r.instances, o); m.applySolToContainer() } y.clear(), _ = !1 } }, n.prototype.IsOverlapping = function (t) { return r.call(this, t, 0, 0) }, n.prototype.IsOverlappingOffset = function (t, e, i) { return r.call(this, t, e, i) }, n.prototype.IsAnimPlaying = function (t) { return this.changeAnimName.length ? cr.equals_nocase(this.changeAnimName, t) : cr.equals_nocase(this.cur_animation.name, t) }, n.prototype.CompareFrame = function (t, e) { return cr.do_cmp(this.cur_frame, t, e) }, n.prototype.CompareAnimSpeed = function (t, e) { var i = this.animForwards ? this.cur_anim_speed : -this.cur_anim_speed; return cr.do_cmp(i, t, e) }, n.prototype.OnAnimFinished = function (t) { return cr.equals_nocase(this.animTriggerName, t) }, n.prototype.OnAnyAnimFinished = function () { return !0 }, n.prototype.OnFrameChanged = function () { return !0 }, n.prototype.IsMirrored = function () { return this.width < 0 }, n.prototype.IsFlipped = function () { return this.height < 0 }, n.prototype.OnURLLoaded = function () { return !0 }, n.prototype.IsCollisionEnabled = function () { return this.collisionsEnabled }, t.cnds = new n, o.prototype.Spawn = function (t, e, i) { if (t && e) { var n = this.runtime.createInstance(t, e, this.getImagePoint(i, !0), this.getImagePoint(i, !1)); if (n) { var s, r, o; if (void 0 !== n.angle && (n.angle = this.angle, n.set_bbox_changed()), this.runtime.isInOnDestroy++, this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated, n), n.is_contained) for (s = 0, r = n.siblings.length; s < r; s++) o = n.siblings[s], this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated, o); this.runtime.isInOnDestroy--; var a, h = this.runtime.getCurrentAction(), c = !1; if ((cr.is_undefined(h.extra.Spawn_LastExec) || h.extra.Spawn_LastExec < this.runtime.execcount) && (c = !0, h.extra.Spawn_LastExec = this.runtime.execcount), t != this.type && ((a = t.getCurrentSol()).select_all = !1, c ? (cr.clearArray(a.instances), a.instances[0] = n) : a.instances.push(n), n.is_contained)) for (s = 0, r = n.siblings.length; s < r; s++) (a = (o = n.siblings[s]).type.getCurrentSol()).select_all = !1, c ? (cr.clearArray(a.instances), a.instances[0] = o) : a.instances.push(o) } } }, o.prototype.SetEffect = function (t) { this.blend_mode = t, this.compositeOp = cr.effectToCompositeOp(t), cr.setGLBlend(this, t, this.runtime.gl), this.runtime.redraw = !0 }, o.prototype.StopAnim = function () { this.animPlaying = !1 }, o.prototype.StartAnim = function (t) { this.animPlaying = !0, this.frameStart = this.getNowTime(), 1 === t && 0 !== this.cur_frame && (this.changeAnimFrame = 0, this.inAnimTrigger || this.doChangeAnimFrame()), this.isTicking || (this.runtime.tickMe(this), this.isTicking = !0) }, o.prototype.SetAnim = function (t, e) { this.changeAnimName = t, this.changeAnimFrom = e, this.isTicking || (this.runtime.tickMe(this), this.isTicking = !0), this.inAnimTrigger || this.doChangeAnim() }, o.prototype.SetAnimFrame = function (t) { this.changeAnimFrame = t, this.isTicking || (this.runtime.tickMe(this), this.isTicking = !0), this.inAnimTrigger || this.doChangeAnimFrame() }, o.prototype.SetAnimSpeed = function (t) { this.cur_anim_speed = cr.abs(t), this.animForwards = 0 <= t, this.isTicking || (this.runtime.tickMe(this), this.isTicking = !0) }, o.prototype.SetAnimRepeatToFrame = function (t) { (t = Math.floor(t)) < 0 && (t = 0), t >= this.cur_animation.frames.length && (t = this.cur_animation.frames.length - 1), this.cur_anim_repeatto = t }, o.prototype.SetMirrored = function (t) { var e = cr.abs(this.width) * (0 === t ? -1 : 1); this.width !== e && (this.width = e, this.set_bbox_changed()) }, o.prototype.SetFlipped = function (t) { var e = cr.abs(this.height) * (0 === t ? -1 : 1); this.height !== e && (this.height = e, this.set_bbox_changed()) }, o.prototype.SetScale = function (t) { var e = this.curFrame, i = this.width < 0 ? -1 : 1, n = this.height < 0 ? -1 : 1, s = e.width * t * i, r = e.height * t * n; this.width === s && this.height === r || (this.width = s, this.height = r, this.set_bbox_changed()) }, o.prototype.LoadURL = function (t, e, i) { var n = new Image, s = this, r = this.curFrame; n.onload = function () { if (r.texture_img.src === n.src) return s.runtime.glwrap && s.curFrame === r && (s.curWebGLTexture = r.webGL_texture), 0 === e && (s.width = n.width, s.height = n.height, s.set_bbox_changed()), s.runtime.redraw = !0, void s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded, s); r.texture_img = n, r.offx = 0, r.offy = 0, r.width = n.width, r.height = n.height, r.spritesheeted = !1, r.datauri = "", r.pixelformat = 0, s.runtime.glwrap && (r.webGL_texture && s.runtime.glwrap.deleteTexture(r.webGL_texture), r.webGL_texture = s.runtime.glwrap.loadTexture(n, !1, s.runtime.linearSampling), s.curFrame === r && (s.curWebGLTexture = r.webGL_texture), s.type.updateAllCurrentTexture()), 0 === e && (s.width = n.width, s.height = n.height, s.set_bbox_changed()), s.runtime.redraw = !0, s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded, s) }, "data:" !== t.substr(0, 5) && 0 === i && (n.crossOrigin = "anonymous"), this.runtime.setImageSrc(n, t) }, o.prototype.SetCollisions = function (t) { this.collisionsEnabled !== (0 !== t) && (this.collisionsEnabled = 0 !== t, this.collisionsEnabled ? this.set_bbox_changed() : (this.collcells.right >= this.collcells.left && this.type.collision_grid.update(this, this.collcells, null), this.collcells.set(0, 0, -1, -1))) }, t.acts = new o, a.prototype.AnimationFrame = function (t) { t.set_int(this.cur_frame) }, a.prototype.AnimationFrameCount = function (t) { t.set_int(this.cur_animation.frames.length) }, a.prototype.AnimationName = function (t) { t.set_string(this.cur_animation.name) }, a.prototype.AnimationSpeed = function (t) { t.set_float(this.animForwards ? this.cur_anim_speed : -this.cur_anim_speed) }, a.prototype.ImagePointX = function (t, e) { t.set_float(this.getImagePoint(e, !0)) }, a.prototype.ImagePointY = function (t, e) { t.set_float(this.getImagePoint(e, !1)) }, a.prototype.ImagePointCount = function (t) { t.set_int(this.curFrame.image_points.length) }, a.prototype.ImageWidth = function (t) { t.set_float(this.curFrame.width) }, a.prototype.ImageHeight = function (t) { t.set_float(this.curFrame.height) }, t.exps = new a }(), cr.plugins_.Spritefont2 = function (t) { this.runtime = t }, function () { var t = cr.plugins_.Spritefont2.prototype; t.onCreate = function () { }, t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }; var e = t.Type.prototype; e.onCreate = function () { this.is_family || (this.texture_img = new Image, this.runtime.waitForImageLoad(this.texture_img, this.texture_file), this.webGL_texture = null) }, e.onLostWebGLContext = function () { this.is_family || (this.webGL_texture = null) }, e.onRestoreWebGLContext = function () { var t, e; if (!this.is_family && this.instances.length) for (this.webGL_texture || (this.webGL_texture = this.runtime.glwrap.loadTexture(this.texture_img, !1, this.runtime.linearSampling, this.texture_pixelformat)), t = 0, e = this.instances.length; t < e; t++) this.instances[t].webGL_texture = this.webGL_texture }, e.unloadTextures = function () { this.is_family || this.instances.length || !this.webGL_texture || (this.runtime.glwrap.deleteTexture(this.webGL_texture), this.webGL_texture = null) }, e.preloadCanvas2D = function (t) { t.drawImage(this.texture_img, 0, 0) }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime }; var i = t.Instance.prototype; function p(t) { return t.replace(/\s\s*$/, "") } i.onDestroy = function () { var t, e; c(this.lines), t = this.clipList, s(C, t, !1), e = this.clipUV, s(E, e, !1), cr.wipe(this.characterWidthList) }, i.onCreate = function () { this.texture_img = this.type.texture_img, this.characterWidth = this.properties[0], this.characterHeight = this.properties[1], this.characterSet = this.properties[2], this.text = this.properties[3], this.characterScale = this.properties[4], this.visible = 0 === this.properties[5], this.halign = this.properties[6] / 2, this.valign = this.properties[7] / 2, this.wrapbyword = 0 === this.properties[9], this.characterSpacing = this.properties[10], this.lineHeight = this.properties[11], this.textWidth = 0, this.textHeight = 0, this.recycled ? (cr.clearArray(this.lines), cr.wipe(this.clipList), cr.wipe(this.clipUV), cr.wipe(this.characterWidthList)) : (this.lines = [], this.clipList = {}, this.clipUV = {}, this.characterWidthList = {}), this.text_changed = !0, this.lastwrapwidth = this.width, this.runtime.glwrap && (this.type.webGL_texture || (this.type.webGL_texture = this.runtime.glwrap.loadTexture(this.type.texture_img, !1, this.runtime.linearSampling, this.type.texture_pixelformat)), this.webGL_texture = this.type.webGL_texture), this.SplitSheet() }, i.saveToJSON = function () { var t = { t: this.text, csc: this.characterScale, csp: this.characterSpacing, lh: this.lineHeight, tw: this.textWidth, th: this.textHeight, lrt: this.last_render_tick, ha: this.halign, va: this.valign, cw: {} }; for (var e in this.characterWidthList) t.cw[e] = this.characterWidthList[e]; return t }, i.loadFromJSON = function (t) { for (var e in this.text = t.t, this.characterScale = t.csc, this.characterSpacing = t.csp, this.lineHeight = t.lh, this.textWidth = t.tw, this.textHeight = t.th, this.last_render_tick = t.lrt, t.hasOwnProperty("ha") && (this.halign = t.ha), t.hasOwnProperty("va") && (this.valign = t.va), t.cw) this.characterWidthList[e] = t.cw[e]; this.text_changed = !0, this.lastwrapwidth = this.width }; var n = 1e3; function A(t, e) { return t.length ? t.pop() : new e } function d(t, e) { t.length < n && t.push(e) } function s(t, e, i) { if (i) { var n, s; for (n = 0, s = e.length; n < s; n++) d(t, e[n]); cr.clearArray(e) } else { var r; for (r in e) Object.prototype.hasOwnProperty.call(e, r) && (d(t, e[r]), delete e[r]) } } function f(t, e, i) { var n, s = t.lines; i = p(i), e >= s.length && s.push(h()), (n = s[e]).text = i, n.width = t.measureWidth(i), t.textWidth = cr.max(t.textWidth, n.width) } var g = []; function h() { return A(g, Object) } function c(t) { s(g, t, !0) } var C = []; var E = []; i.SplitSheet = function () { for (var t, e, i, n, s, r, o, a, h, c, l, u, p = this.texture_img, d = p.width, f = p.height, g = this.characterWidth, m = this.characterHeight, y = g / d, _ = m / f, v = this.characterSet, b = Math.floor(d / g), w = Math.floor(f / m), x = 0; x < v.length && !(b * w <= x) ; x++) { var S = x % b, T = Math.floor(x / b), O = v.charAt(x); this.runtime.glwrap ? (o = this.clipUV, h = S * y, c = T * _, l = (S + 1) * y, u = (T + 1) * _, void 0 === o[a = O] && (o[a] = A(E, cr.rect)), o[a].left = h, o[a].top = c, o[a].right = l, o[a].bottom = u) : (t = this.clipList, i = S * g, n = T * m, s = g, r = m, void 0 === t[e = O] && (t[e] = A(C, Object)), t[e].x = i, t[e].y = n, t[e].w = s, t[e].h = r) } }; var m = []; t.TokeniseWords = function (t) { cr.clearArray(m); for (var e, i = "", n = 0; n < t.length;) if ("\n" === (e = t.charAt(n))) i.length && (m.push(i), i = ""), m.push("\n"), ++n; else if (" " === e || "\t" === e || "-" === e) { for (; i += t.charAt(n), ++n < t.length && (" " === t.charAt(n) || "\t" === t.charAt(n)) ;); m.push(i), i = "" } else n < t.length && (i += e, n++); i.length && m.push(i) }, t.WordWrap = function (t) { var e = t.text, i = t.lines; if (e && e.length) { var n = t.width; if (n <= 2) c(i); else { var s = t.characterWidth, r = t.characterScale, o = t.characterSpacing; if (e.length * (s * r + o) - o <= n && -1 === e.indexOf("\n")) { var a = t.measureWidth(e); if (a <= n) return c(i), i.push(h()), i[0].text = e, i[0].width = a, t.textWidth = a, void (t.textHeight = t.characterHeight * r + t.lineHeight) } t.wrapbyword; this.WrapText(t), t.textHeight = i.length * (t.characterHeight * r + t.lineHeight) } } else c(i) }, t.WrapText = function (t) { var e, i = t.wrapbyword, n = t.text, s = t.lines, r = t.width; i ? (this.TokeniseWords(n), e = m) : e = n; var o, a, h, c = "", l = 0, u = !1; for (a = 0; a < e.length; a++) "\n" !== e[a] ? (u = !1, o = c, c += e[a], r < t.measureWidth(p(c)) && ("" === o ? (f(t, l, c), u = !(c = "")) : (f(t, l, o), c = e[a]), l++, i || " " !== c || (c = ""))) : (!0 === u ? u = !1 : (f(t, l, c), l++), c = ""); for (p(c).length && (f(t, l, c), l++), a = l; a < s.length; a++) h = s[a], d(g, h); s.length = l }, i.measureWidth = function (t) { for (var e = this.characterSpacing, i = t.length, n = 0, s = 0; s < i; s++) n += this.getCharacterWidth(t.charAt(s)) * this.characterScale + e; return n -= 0 < n ? e : 0 }, i.getCharacterWidth = function (t) { var e = this.characterWidthList; return void 0 !== e[t] ? e[t] : this.characterWidth }, i.rebuildText = function () { (this.text_changed || this.width !== this.lastwrapwidth) && (this.textWidth = 0, this.textHeight = 0, this.type.plugin.WordWrap(this), this.text_changed = !1, this.lastwrapwidth = this.width) }; i.draw = function (t, e) { var i = this.texture_img; if ("" !== this.text && null != i) { if (this.rebuildText(), this.height < this.characterHeight * this.characterScale + this.lineHeight) return; t.globalAlpha = this.opacity; var n = this.x, s = this.y; this.runtime.pixel_rounding && (n = Math.round(n), s = Math.round(s)); var r = this.layer.viewLeft, o = this.layer.viewTop, a = this.layer.viewRight, h = this.layer.viewBottom; t.save(), t.translate(n, s), t.rotate(this.angle); for (var c, l, u, p, d = this.angle, f = this.halign, g = this.valign, m = this.characterScale, y = this.characterHeight * m, _ = this.lineHeight, v = this.characterSpacing, b = this.lines, w = this.textHeight, x = g * cr.max(0, this.height - w), S = -this.hotspotX * this.width, T = -this.hotspotY * this.height, O = T += x, A = 0; A < b.length; A++) { var C = b[A].text, E = b[A].width; if (l = S + f * cr.max(0, this.width - E), O += _, 0 === d && s + O + y < o) O += y; else { for (var k = 0; k < C.length; k++) { var P = C.charAt(k); c = this.getCharacterWidth(P); var I = this.clipList[P]; if (0 === d && n + l + c * m + v < r) l += c * m + v; else { if (l + c * m > this.width + 1e-5) break; if (void 0 !== I && (u = l, p = O, 0 === d && 1 === m && (u = Math.round(u), p = Math.round(p)), t.drawImage(this.texture_img, I.x, I.y, I.w, I.h, u, p, I.w * m, I.h * m)), l += c * m + v, 0 === d && a < n + l) break } } if (O += y, 0 === d && (O + y + _ > this.height || h < s + O)) break } } t.restore() } }; var j = new cr.quad; function r() { } function o() { } function a() { } i.drawGL = function (t) { if (t.setTexture(this.webGL_texture), t.setOpacity(this.opacity), this.text && (this.rebuildText(), !(this.height < this.characterHeight * this.characterScale + this.lineHeight))) { this.update_bbox(); var e = this.bquad, i = 0, n = 0; this.runtime.pixel_rounding && (i = Math.round(this.x) - this.x, n = Math.round(this.y) - this.y); var s, r, o, a = this.layer.viewLeft, h = this.layer.viewTop, c = this.layer.viewRight, l = this.layer.viewBottom, u = this.angle, p = this.halign, d = this.valign, f = this.characterScale, g = this.characterHeight * f, m = this.lineHeight, y = this.characterSpacing, _ = this.lines, v = this.textHeight; 0 !== u && (r = Math.cos(u), o = Math.sin(u)); for (var b, w, x, S, T, O, A, C = d * cr.max(0, this.height - v), E = e.tlx + i, k = e.tly + n, P = C, I = 0; I < _.length; I++) { var R = _[I].text, L = _[I].width; if (b = p * cr.max(0, this.width - L), P += m, 0 === u && k + P + g < h) P += g; else { for (var B = 0; B < R.length; B++) { var M = R.charAt(B); s = this.getCharacterWidth(M); var F = this.clipUV[M]; if (0 === u && E + b + s * f + y < a) b += s * f + y; else { if (b + s * f > this.width + 1e-5) break; if (void 0 !== F) { var N = this.characterWidth * f, D = this.characterHeight * f; w = b, x = P, 0 === u && 1 === f && (w = Math.round(w), x = Math.round(x)), j.tlx = w, j.tly = x, j.trx = w + N, j.try_ = x, j.blx = w, j.bly = x + D, j.brx = w + N, j.bry = x + D, 0 !== u && (T = r, O = o, A = void 0, A = (S = j).tlx * T - S.tly * O, S.tly = S.tly * T + S.tlx * O, S.tlx = A, A = S.trx * T - S.try_ * O, S.try_ = S.try_ * T + S.trx * O, S.trx = A, A = S.blx * T - S.bly * O, S.bly = S.bly * T + S.blx * O, S.blx = A, A = S.brx * T - S.bry * O, S.bry = S.bry * T + S.brx * O, S.brx = A), j.offset(E, k), t.quadTex(j.tlx, j.tly, j.trx, j.try_, j.brx, j.bry, j.blx, j.bly, F) } if (b += s * f + y, 0 === u && c < E + b) break } } if (P += g, 0 === u && (P + g + m > this.height || l < k + P)) break } } } }, r.prototype.CompareText = function (t, e) { return e ? this.text == t : cr.equals_nocase(this.text, t) }, t.cnds = new r, o.prototype.SetText = function (t) { cr.is_number(t) && t < 1e9 && (t = Math.round(1e10 * t) / 1e10); var e = t.toString(); this.text !== e && (this.text = e, this.text_changed = !0, this.runtime.redraw = !0) }, o.prototype.AppendText = function (t) { cr.is_number(t) && (t = Math.round(1e10 * t) / 1e10); var e = t.toString(); e && (this.text += e, this.text_changed = !0, this.runtime.redraw = !0) }, o.prototype.SetScale = function (t) { t !== this.characterScale && (this.characterScale = t, this.text_changed = !0, this.runtime.redraw = !0) }, o.prototype.SetCharacterSpacing = function (t) { t !== this.CharacterSpacing && (this.characterSpacing = t, this.text_changed = !0, this.runtime.redraw = !0) }, o.prototype.SetLineHeight = function (t) { t !== this.lineHeight && (this.lineHeight = t, this.text_changed = !0, this.runtime.redraw = !0) }, i.SetCharWidth = function (t, e) { var i = parseInt(e, 10); this.characterWidthList[t] !== i && (this.characterWidthList[t] = i, this.text_changed = !0, this.runtime.redraw = !0) }, o.prototype.SetCharacterWidth = function (t, e) { if ("" !== t) for (var i = 0; i < t.length; i++) this.SetCharWidth(t.charAt(i), e) }, o.prototype.SetEffect = function (t) { this.blend_mode = t, this.compositeOp = cr.effectToCompositeOp(t), cr.setGLBlend(this, t, this.runtime.gl), this.runtime.redraw = !0 }, o.prototype.SetHAlign = function (t) { this.halign = t / 2, this.text_changed = !0, this.runtime.redraw = !0 }, o.prototype.SetVAlign = function (t) { this.valign = t / 2, this.text_changed = !0, this.runtime.redraw = !0 }, t.acts = new o, a.prototype.CharacterWidth = function (t, e) { t.set_int(this.getCharacterWidth(e)) }, a.prototype.CharacterHeight = function (t) { t.set_int(this.characterHeight) }, a.prototype.CharacterScale = function (t) { t.set_float(this.characterScale) }, a.prototype.CharacterSpacing = function (t) { t.set_int(this.characterSpacing) }, a.prototype.LineHeight = function (t) { t.set_int(this.lineHeight) }, a.prototype.Text = function (t) { t.set_string(this.text) }, a.prototype.TextWidth = function (t) { this.rebuildText(), t.set_float(this.textWidth) }, a.prototype.TextHeight = function (t) { this.rebuildText(), t.set_float(this.textHeight) }, t.exps = new a }(), cr.plugins_.Touch = function (t) { this.runtime = t }, function () { var t = cr.plugins_.Touch.prototype; t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime, this.touches = [], this.mouseDown = !1 }; var e = t.Instance.prototype, u = { left: 0, top: 0 }; e.findTouch = function (t) { var e, i; for (e = 0, i = this.touches.length; e < i; e++) if (this.touches[e].id === t) return e; return -1 }; var i = 0, n = 0, s = 0; function a(t) { i = t.x, n = t.y, s = t.z } var r = []; function h(t, e, i, n) { var s; return (s = r.length ? r.pop() : new c).init(t, e, i, n), s } function o(t) { r.length < 100 && r.push(t) } function c() { this.starttime = 0, this.time = 0, this.lasttime = 0, this.startx = 0, this.starty = 0, this.x = 0, this.y = 0, this.lastx = 0, this.lasty = 0, this.id = 0, this.startindex = 0, this.triggeredHold = !1, this.tooFarForHold = !1 } c.prototype.init = function (t, e, i, n) { var s = cr.performance_now(); this.time = s, this.lasttime = s, this.starttime = s, this.startx = t, this.starty = e, this.x = t, this.y = e, this.lastx = t, this.lasty = e, this.width = 0, this.height = 0, this.pressure = 0, this.id = i, this.startindex = n, this.triggeredHold = !1, this.tooFarForHold = !1 }, c.prototype.update = function (t, e, i, n, s, r) { this.lasttime = this.time, this.time = t, this.lastx = this.x, this.lasty = this.y, this.x = e, this.y = i, this.width = n, this.height = s, this.pressure = r, !this.tooFarForHold && 15 <= cr.distanceTo(this.startx, this.starty, this.x, this.y) && (this.tooFarForHold = !0) }, c.prototype.maybeTriggerHold = function (t, e) { this.triggeredHold || 500 <= cr.performance_now() - this.starttime && !this.tooFarForHold && cr.distanceTo(this.startx, this.starty, this.x, this.y) < 15 && (this.triggeredHold = !0, t.trigger_index = this.startindex, t.trigger_id = this.id, t.getTouchIndex = e, t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture, t), t.curTouchX = this.x, t.curTouchY = this.y, t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject, t), t.getTouchIndex = 0) }; var l = -1e3, p = -1e3, d = -1e4; c.prototype.maybeTriggerTap = function (t, e) { if (!this.triggeredHold) { var i = cr.performance_now(); i - this.starttime <= 333 && !this.tooFarForHold && cr.distanceTo(this.startx, this.starty, this.x, this.y) < 15 && (t.trigger_index = this.startindex, t.trigger_id = this.id, t.getTouchIndex = e, i - d <= 666 && cr.distanceTo(l, p, this.x, this.y) < 25 ? (t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture, t), t.curTouchX = this.x, t.curTouchY = this.y, t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject, t), p = l = -1e3, d = -1e4) : (t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture, t), t.curTouchX = this.x, t.curTouchY = this.y, t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject, t), l = this.x, p = this.y, d = i), t.getTouchIndex = 0) } }, e.onCreate = function () { this.isWindows8 = !(void 0 === window.c2isWindows8 || !window.c2isWindows8), this.orient_alpha = 0, this.orient_beta = 0, this.orient_gamma = 0, this.acc_g_x = 0, this.acc_g_y = 0, this.acc_g_z = 0, this.acc_x = 0, this.acc_y = 0, this.acc_z = 0, this.curTouchX = 0, this.curTouchY = 0, this.trigger_index = 0, this.trigger_id = 0, this.getTouchIndex = 0, this.useMouseInput = 0 !== this.properties[0]; var t = 0 < this.runtime.fullscreen_mode ? document : this.runtime.canvas, e = document; this.runtime.isDirectCanvas ? e = t = window.Canvas : this.runtime.isCocoonJs && (e = t = window); var i = this; if ("undefined" != typeof PointerEvent ? (t.addEventListener("pointerdown", function (t) { i.onPointerStart(t) }, !1), t.addEventListener("pointermove", function (t) { i.onPointerMove(t) }, !1), e.addEventListener("pointerup", function (t) { i.onPointerEnd(t, !1) }, !1), e.addEventListener("pointercancel", function (t) { i.onPointerEnd(t, !0) }, !1), this.runtime.canvas && (this.runtime.canvas.addEventListener("MSGestureHold", function (t) { t.preventDefault() }, !1), document.addEventListener("MSGestureHold", function (t) { t.preventDefault() }, !1), this.runtime.canvas.addEventListener("gesturehold", function (t) { t.preventDefault() }, !1), document.addEventListener("gesturehold", function (t) { t.preventDefault() }, !1))) : window.navigator.msPointerEnabled ? (t.addEventListener("MSPointerDown", function (t) { i.onPointerStart(t) }, !1), t.addEventListener("MSPointerMove", function (t) { i.onPointerMove(t) }, !1), e.addEventListener("MSPointerUp", function (t) { i.onPointerEnd(t, !1) }, !1), e.addEventListener("MSPointerCancel", function (t) { i.onPointerEnd(t, !0) }, !1), this.runtime.canvas && (this.runtime.canvas.addEventListener("MSGestureHold", function (t) { t.preventDefault() }, !1), document.addEventListener("MSGestureHold", function (t) { t.preventDefault() }, !1))) : (t.addEventListener("touchstart", function (t) { i.onTouchStart(t) }, !1), t.addEventListener("touchmove", function (t) { i.onTouchMove(t) }, !1), e.addEventListener("touchend", function (t) { i.onTouchEnd(t, !1) }, !1), e.addEventListener("touchcancel", function (t) { i.onTouchEnd(t, !0) }, !1)), this.isWindows8) { var n = function (t) { var e = t.reading; i.acc_x = e.accelerationX, i.acc_y = e.accelerationY, i.acc_z = e.accelerationZ }, s = function (t) { var e = t.reading; i.orient_alpha = e.yawDegrees, i.orient_beta = e.pitchDegrees, i.orient_gamma = e.rollDegrees }, r = Windows.Devices.Sensors.Accelerometer.getDefault(); r && (r.reportInterval = Math.max(r.minimumReportInterval, 16), r.addEventListener("readingchanged", n)); var o = Windows.Devices.Sensors.Inclinometer.getDefault(); o && (o.reportInterval = Math.max(o.minimumReportInterval, 16), o.addEventListener("readingchanged", s)), document.addEventListener("visibilitychange", function (t) { document.hidden || document.msHidden ? (r && r.removeEventListener("readingchanged", n), o && o.removeEventListener("readingchanged", s)) : (r && r.addEventListener("readingchanged", n), o && o.addEventListener("readingchanged", s)) }, !1) } else window.addEventListener("deviceorientation", function (t) { i.orient_alpha = t.alpha || 0, i.orient_beta = t.beta || 0, i.orient_gamma = t.gamma || 0 }, !1), window.addEventListener("devicemotion", function (t) { t.accelerationIncludingGravity && (i.acc_g_x = t.accelerationIncludingGravity.x || 0, i.acc_g_y = t.accelerationIncludingGravity.y || 0, i.acc_g_z = t.accelerationIncludingGravity.z || 0), t.acceleration && (i.acc_x = t.acceleration.x || 0, i.acc_y = t.acceleration.y || 0, i.acc_z = t.acceleration.z || 0) }, !1); this.useMouseInput && !this.runtime.isDomFree && (jQuery(document).mousemove(function (t) { i.onMouseMove(t) }), jQuery(document).mousedown(function (t) { i.onMouseDown(t) }), jQuery(document).mouseup(function (t) { i.onMouseUp(t) })), !this.runtime.isiOS && this.runtime.isCordova && navigator.accelerometer && navigator.accelerometer.watchAcceleration && navigator.accelerometer.watchAcceleration(a, null, { frequency: 40 }), this.runtime.tick2Me(this) }, e.onPointerMove = function (t) { if (t.pointerType !== t.MSPOINTER_TYPE_MOUSE && "mouse" !== t.pointerType) { t.preventDefault && t.preventDefault(); var e = this.findTouch(t.pointerId), i = cr.performance_now(); if (0 <= e) { var n = this.runtime.isDomFree ? u : jQuery(this.runtime.canvas).offset(), s = this.touches[e]; if (i - s.time < 2) return; s.update(i, t.pageX - n.left, t.pageY - n.top, t.width || 0, t.height || 0, t.pressure || 0) } } }, e.onPointerStart = function (t) { if (t.pointerType !== t.MSPOINTER_TYPE_MOUSE && "mouse" !== t.pointerType) { t.preventDefault && cr.isCanvasInputEvent(t) && t.preventDefault(); var e = this.runtime.isDomFree ? u : jQuery(this.runtime.canvas).offset(), i = t.pageX - e.left, n = t.pageY - e.top; cr.performance_now(); this.trigger_index = this.touches.length, this.trigger_id = t.pointerId, this.touches.push(h(i, n, t.pointerId, this.trigger_index)), this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart, this), this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart, this), this.curTouchX = i, this.curTouchY = n, this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject, this), this.runtime.isInUserInputEvent = !1 } }, e.onPointerEnd = function (t, e) { if (t.pointerType !== t.MSPOINTER_TYPE_MOUSE && "mouse" !== t.pointerType) { t.preventDefault && cr.isCanvasInputEvent(t) && t.preventDefault(); var i = this.findTouch(t.pointerId); this.trigger_index = 0 <= i ? this.touches[i].startindex : -1, this.trigger_id = 0 <= i ? this.touches[i].id : -1, this.runtime.isInUserInputEvent = !0, this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd, this), this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd, this), 0 <= i && (e || this.touches[i].maybeTriggerTap(this, i), o(this.touches[i]), this.touches.splice(i, 1)), this.runtime.isInUserInputEvent = !1 } }, e.onTouchMove = function (t) { t.preventDefault && t.preventDefault(); var e, i, n, s, r = cr.performance_now(); for (e = 0, i = t.changedTouches.length; e < i; e++) { n = t.changedTouches[e]; var o = this.findTouch(n.identifier); if (0 <= o) { var a = this.runtime.isDomFree ? u : jQuery(this.runtime.canvas).offset(); if (r - (s = this.touches[o]).time < 2) continue; var h = 2 * (n.radiusX || n.webkitRadiusX || n.mozRadiusX || n.msRadiusX || 0), c = 2 * (n.radiusY || n.webkitRadiusY || n.mozRadiusY || n.msRadiusY || 0), l = n.force || n.webkitForce || n.mozForce || n.msForce || 0; s.update(r, n.pageX - a.left, n.pageY - a.top, h, c, l) } } }, e.onTouchStart = function (t) { t.preventDefault && cr.isCanvasInputEvent(t) && t.preventDefault(); var e, i, n, s = this.runtime.isDomFree ? u : jQuery(this.runtime.canvas).offset(); cr.performance_now(); for (this.runtime.isInUserInputEvent = !0, e = 0, i = t.changedTouches.length; e < i; e++) if (n = t.changedTouches[e], -1 === this.findTouch(n.identifier)) { var r = n.pageX - s.left, o = n.pageY - s.top; this.trigger_index = this.touches.length, this.trigger_id = n.identifier, this.touches.push(h(r, o, n.identifier, this.trigger_index)), this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart, this), this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart, this), this.curTouchX = r, this.curTouchY = o, this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject, this) } this.runtime.isInUserInputEvent = !1 }, e.onTouchEnd = function (t, e) { var i, n, s, r; for (t.preventDefault && cr.isCanvasInputEvent(t) && t.preventDefault(), this.runtime.isInUserInputEvent = !0, i = 0, n = t.changedTouches.length; i < n; i++) s = t.changedTouches[i], 0 <= (r = this.findTouch(s.identifier)) && (this.trigger_index = this.touches[r].startindex, this.trigger_id = this.touches[r].id, this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd, this), this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd, this), e || this.touches[r].maybeTriggerTap(this, r), o(this.touches[r]), this.touches.splice(r, 1)); this.runtime.isInUserInputEvent = !1 }, e.getAlpha = function () { return this.runtime.isCordova && 0 === this.orient_alpha && 0 !== s ? 90 * s : this.orient_alpha }, e.getBeta = function () { return this.runtime.isCordova && 0 === this.orient_beta && 0 !== n ? 90 * n : this.orient_beta }, e.getGamma = function () { return this.runtime.isCordova && 0 === this.orient_gamma && 0 !== i ? 90 * i : this.orient_gamma }; function f(t) { return t.sourceCapabilities && t.sourceCapabilities.firesTouchEvents || t.originalEvent && t.originalEvent.sourceCapabilities && t.originalEvent.sourceCapabilities.firesTouchEvents } function g() { } e.onMouseDown = function (t) { if (!f(t)) { var e = { changedTouches: [{ pageX: t.pageX, pageY: t.pageY, identifier: 0 }] }; this.onTouchStart(e), this.mouseDown = !0 } }, e.onMouseMove = function (t) { if (this.mouseDown && !f(t)) { var e = { changedTouches: [{ pageX: t.pageX, pageY: t.pageY, identifier: 0 }] }; this.onTouchMove(e) } }, e.onMouseUp = function (t) { if (t.preventDefault && this.runtime.had_a_click && !this.runtime.isMobile && t.preventDefault(), this.runtime.had_a_click = !0, !f(t)) { var e = { changedTouches: [{ pageX: t.pageX, pageY: t.pageY, identifier: 0 }] }; this.onTouchEnd(e), this.mouseDown = !1 } }, e.tick2 = function () { var t, e, i, n = cr.performance_now(); for (t = 0, e = this.touches.length; t < e; ++t) (i = this.touches[t]).time <= n - 50 && (i.lasttime = n), i.maybeTriggerHold(this, t) }, g.prototype.OnTouchStart = function () { return !0 }, g.prototype.OnTouchEnd = function () { return !0 }, g.prototype.IsInTouch = function () { return this.touches.length }, g.prototype.OnTouchObject = function (t) { return !!t && this.runtime.testAndSelectCanvasPointOverlap(t, this.curTouchX, this.curTouchY, !1) }; var m = []; function y() { } g.prototype.IsTouchingObject = function (t) { if (!t) return !1; var e, i, n, s, r, o, a = t.getCurrentSol(), h = a.getObjects(); for (n = 0, s = h.length; n < s; n++) { var c = h[n]; for (c.update_bbox(), r = 0, o = this.touches.length; r < o; r++) { var l = this.touches[r]; if (e = c.layer.canvasToLayer(l.x, l.y, !0), i = c.layer.canvasToLayer(l.x, l.y, !1), c.contains_pt(e, i)) { m.push(c); break } } } return !!m.length && (a.select_all = !1, cr.shallowAssignArray(a.instances, m), t.applySolToContainer(), cr.clearArray(m), !0) }, g.prototype.CompareTouchSpeed = function (t, e, i) { if ((t = Math.floor(t)) < 0 || t >= this.touches.length) return !1; var n = this.touches[t], s = cr.distanceTo(n.x, n.y, n.lastx, n.lasty), r = (n.time - n.lasttime) / 1e3, o = 0; return 0 < r && (o = s / r), cr.do_cmp(o, e, i) }, g.prototype.OrientationSupported = function () { return void 0 !== window.DeviceOrientationEvent }, g.prototype.MotionSupported = function () { return void 0 !== window.DeviceMotionEvent }, g.prototype.CompareOrientation = function (t, e, i) { var n = 0; return n = 0 === t ? this.getAlpha() : 1 === t ? this.getBeta() : this.getGamma(), cr.do_cmp(n, e, i) }, g.prototype.CompareAcceleration = function (t, e, i) { var n = 0; return 0 === t ? n = this.acc_g_x : 1 === t ? n = this.acc_g_y : 2 === t ? n = this.acc_g_z : 3 === t ? n = this.acc_x : 4 === t ? n = this.acc_y : 5 === t && (n = this.acc_z), cr.do_cmp(n, e, i) }, g.prototype.OnNthTouchStart = function (t) { return (t = Math.floor(t)) === this.trigger_index }, g.prototype.OnNthTouchEnd = function (t) { return (t = Math.floor(t)) === this.trigger_index }, g.prototype.HasNthTouch = function (t) { return t = Math.floor(t), this.touches.length >= t + 1 }, g.prototype.OnHoldGesture = function () { return !0 }, g.prototype.OnTapGesture = function () { return !0 }, g.prototype.OnDoubleTapGesture = function () { return !0 }, g.prototype.OnHoldGestureObject = function (t) { return !!t && this.runtime.testAndSelectCanvasPointOverlap(t, this.curTouchX, this.curTouchY, !1) }, g.prototype.OnTapGestureObject = function (t) { return !!t && this.runtime.testAndSelectCanvasPointOverlap(t, this.curTouchX, this.curTouchY, !1) }, g.prototype.OnDoubleTapGestureObject = function (t) { return !!t && this.runtime.testAndSelectCanvasPointOverlap(t, this.curTouchX, this.curTouchY, !1) }, t.cnds = new g, y.prototype.TouchCount = function (t) { t.set_int(this.touches.length) }, y.prototype.X = function (t, e) { var i, n, s, r, o, a = this.getTouchIndex; a < 0 || a >= this.touches.length ? t.set_float(0) : cr.is_undefined(e) ? (n = (i = this.runtime.getLayerByNumber(0)).scale, s = i.zoomRate, r = i.parallaxX, o = i.angle, i.scale = 1, i.zoomRate = 1, i.parallaxX = 1, i.angle = 0, t.set_float(i.canvasToLayer(this.touches[a].x, this.touches[a].y, !0)), i.scale = n, i.zoomRate = s, i.parallaxX = r, i.angle = o) : (i = cr.is_number(e) ? this.runtime.getLayerByNumber(e) : this.runtime.getLayerByName(e)) ? t.set_float(i.canvasToLayer(this.touches[a].x, this.touches[a].y, !0)) : t.set_float(0) }, y.prototype.XAt = function (t, e, i) { var n, s, r, o, a; (e = Math.floor(e)) < 0 || e >= this.touches.length ? t.set_float(0) : cr.is_undefined(i) ? (s = (n = this.runtime.getLayerByNumber(0)).scale, r = n.zoomRate, o = n.parallaxX, a = n.angle, n.scale = 1, n.zoomRate = 1, n.parallaxX = 1, n.angle = 0, t.set_float(n.canvasToLayer(this.touches[e].x, this.touches[e].y, !0)), n.scale = s, n.zoomRate = r, n.parallaxX = o, n.angle = a) : (n = cr.is_number(i) ? this.runtime.getLayerByNumber(i) : this.runtime.getLayerByName(i)) ? t.set_float(n.canvasToLayer(this.touches[e].x, this.touches[e].y, !0)) : t.set_float(0) }, y.prototype.XForID = function (t, e, i) { var n = this.findTouch(e); if (n < 0) t.set_float(0); else { var s, r, o, a, h, c = this.touches[n]; cr.is_undefined(i) ? (r = (s = this.runtime.getLayerByNumber(0)).scale, o = s.zoomRate, a = s.parallaxX, h = s.angle, s.scale = 1, s.zoomRate = 1, s.parallaxX = 1, s.angle = 0, t.set_float(s.canvasToLayer(c.x, c.y, !0)), s.scale = r, s.zoomRate = o, s.parallaxX = a, s.angle = h) : (s = cr.is_number(i) ? this.runtime.getLayerByNumber(i) : this.runtime.getLayerByName(i)) ? t.set_float(s.canvasToLayer(c.x, c.y, !0)) : t.set_float(0) } }, y.prototype.Y = function (t, e) { var i, n, s, r, o, a = this.getTouchIndex; a < 0 || a >= this.touches.length ? t.set_float(0) : cr.is_undefined(e) ? (n = (i = this.runtime.getLayerByNumber(0)).scale, s = i.zoomRate, r = i.parallaxY, o = i.angle, i.scale = 1, i.zoomRate = 1, i.parallaxY = 1, i.angle = 0, t.set_float(i.canvasToLayer(this.touches[a].x, this.touches[a].y, !1)), i.scale = n, i.zoomRate = s, i.parallaxY = r, i.angle = o) : (i = cr.is_number(e) ? this.runtime.getLayerByNumber(e) : this.runtime.getLayerByName(e)) ? t.set_float(i.canvasToLayer(this.touches[a].x, this.touches[a].y, !1)) : t.set_float(0) }, y.prototype.YAt = function (t, e, i) { var n, s, r, o, a; (e = Math.floor(e)) < 0 || e >= this.touches.length ? t.set_float(0) : cr.is_undefined(i) ? (s = (n = this.runtime.getLayerByNumber(0)).scale, r = n.zoomRate, o = n.parallaxY, a = n.angle, n.scale = 1, n.zoomRate = 1, n.parallaxY = 1, n.angle = 0, t.set_float(n.canvasToLayer(this.touches[e].x, this.touches[e].y, !1)), n.scale = s, n.zoomRate = r, n.parallaxY = o, n.angle = a) : (n = cr.is_number(i) ? this.runtime.getLayerByNumber(i) : this.runtime.getLayerByName(i)) ? t.set_float(n.canvasToLayer(this.touches[e].x, this.touches[e].y, !1)) : t.set_float(0) }, y.prototype.YForID = function (t, e, i) { var n = this.findTouch(e); if (n < 0) t.set_float(0); else { var s, r, o, a, h, c = this.touches[n]; cr.is_undefined(i) ? (r = (s = this.runtime.getLayerByNumber(0)).scale, o = s.zoomRate, a = s.parallaxY, h = s.angle, s.scale = 1, s.zoomRate = 1, s.parallaxY = 1, s.angle = 0, t.set_float(s.canvasToLayer(c.x, c.y, !1)), s.scale = r, s.zoomRate = o, s.parallaxY = a, s.angle = h) : (s = cr.is_number(i) ? this.runtime.getLayerByNumber(i) : this.runtime.getLayerByName(i)) ? t.set_float(s.canvasToLayer(c.x, c.y, !1)) : t.set_float(0) } }, y.prototype.AbsoluteX = function (t) { this.touches.length ? t.set_float(this.touches[0].x) : t.set_float(0) }, y.prototype.AbsoluteXAt = function (t, e) { (e = Math.floor(e)) < 0 || e >= this.touches.length ? t.set_float(0) : t.set_float(this.touches[e].x) }, y.prototype.AbsoluteXForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(n.x) } }, y.prototype.AbsoluteY = function (t) { this.touches.length ? t.set_float(this.touches[0].y) : t.set_float(0) }, y.prototype.AbsoluteYAt = function (t, e) { (e = Math.floor(e)) < 0 || e >= this.touches.length ? t.set_float(0) : t.set_float(this.touches[e].y) }, y.prototype.AbsoluteYForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(n.y) } }, y.prototype.SpeedAt = function (t, e) { if ((e = Math.floor(e)) < 0 || e >= this.touches.length) t.set_float(0); else { var i = this.touches[e], n = cr.distanceTo(i.x, i.y, i.lastx, i.lasty), s = (i.time - i.lasttime) / 1e3; s <= 0 ? t.set_float(0) : t.set_float(n / s) } }, y.prototype.SpeedForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i], s = cr.distanceTo(n.x, n.y, n.lastx, n.lasty), r = (n.time - n.lasttime) / 1e3; r <= 0 ? t.set_float(0) : t.set_float(s / r) } }, y.prototype.AngleAt = function (t, e) { if ((e = Math.floor(e)) < 0 || e >= this.touches.length) t.set_float(0); else { var i = this.touches[e]; t.set_float(cr.to_degrees(cr.angleTo(i.lastx, i.lasty, i.x, i.y))) } }, y.prototype.AngleForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(cr.to_degrees(cr.angleTo(n.lastx, n.lasty, n.x, n.y))) } }, y.prototype.Alpha = function (t) { t.set_float(this.getAlpha()) }, y.prototype.Beta = function (t) { t.set_float(this.getBeta()) }, y.prototype.Gamma = function (t) { t.set_float(this.getGamma()) }, y.prototype.AccelerationXWithG = function (t) { t.set_float(this.acc_g_x) }, y.prototype.AccelerationYWithG = function (t) { t.set_float(this.acc_g_y) }, y.prototype.AccelerationZWithG = function (t) { t.set_float(this.acc_g_z) }, y.prototype.AccelerationX = function (t) { t.set_float(this.acc_x) }, y.prototype.AccelerationY = function (t) { t.set_float(this.acc_y) }, y.prototype.AccelerationZ = function (t) { t.set_float(this.acc_z) }, y.prototype.TouchIndex = function (t) { t.set_int(this.trigger_index) }, y.prototype.TouchID = function (t) { t.set_float(this.trigger_id) }, y.prototype.WidthForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(n.width) } }, y.prototype.HeightForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(n.height) } }, y.prototype.PressureForID = function (t, e) { var i = this.findTouch(e); if (i < 0) t.set_float(0); else { var n = this.touches[i]; t.set_float(n.pressure) } }, t.exps = new y }(), cr.plugins_.XML = function (t) { if (this.runtime = t, this.runtime.isIE) { var e = {}; (window.XPathResult = e).NUMBER_TYPE = 1, e.STRING_TYPE = 2, e.UNORDERED_NODE_SNAPSHOT_TYPE = 6, e.ORDERED_NODE_SNAPSHOT_TYPE = 7 } }, function () { var t = cr.plugins_.XML.prototype; t.Type = function (t) { this.plugin = t, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t) { this.type = t, this.runtime = t.runtime }; var e = t.Instance.prototype; function i() { } function n() { } function s() { } e.onCreate = function () { this.xmlDoc = null, this.nodeStack = [], this.runtime.isDomFree && cr.logexport("[Construct 2] The XML object is not supported on this platform.") }, e.xpath_eval_one = function (t, e) { if (this.xmlDoc) { var i = this.nodeStack.length ? this.nodeStack[this.nodeStack.length - 1] : this.xmlDoc.documentElement; try { return this.runtime.isIE ? i.selectSingleNode(t) : this.xmlDoc.evaluate(t, i, null, e, null) } catch (t) { return null } } }, e.xpath_eval_many = function (t, e) { if (this.xmlDoc) { var i = this.nodeStack.length ? this.nodeStack[this.nodeStack.length - 1] : this.xmlDoc.documentElement; try { return this.runtime.isIE ? i.selectNodes(t) : this.xmlDoc.evaluate(t, i, null, e, null) } catch (t) { return null } } }, e.doForEachIteration = function (t, e) { this.nodeStack.push(e), this.runtime.pushCopySol(t.solModifiers), t.retrigger(), this.runtime.popSol(t.solModifiers), this.nodeStack.pop() }, i.prototype.ForEach = function (t) { if (this.runtime.isDomFree) return !1; var e, i, n = this.runtime.getCurrentEventStack().current_event, s = this.xpath_eval_many(t, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE); if (!s) return !1; var r = this.runtime.pushLoopStack(); if (this.runtime.isIE) for (e = 0, i = s.length; e < i; e++) r.index = e, this.doForEachIteration(n, s[e]); else for (e = 0, i = s.snapshotLength; e < i; e++) r.index = e, this.doForEachIteration(n, s.snapshotItem(e)); return this.runtime.popLoopStack(), !1 }, t.cnds = new i, n.prototype.Load = function (t) { if (!this.runtime.isDomFree) { var e, i = !(void 0 === window.c2isWindows8 || !window.c2isWindows8); try { if (i) (e = new Windows.Data.Xml.Dom.XmlDocument).loadXml(t); else if (this.runtime.isIE) { for (var n = ["MSXML2.DOMDocument.6.0", "MSXML2.DOMDocument.3.0", "MSXML2.DOMDocument"], s = 0; s < 3; s++) try { if (e = new ActiveXObject(n[s])) break } catch (t) { e = null } e && (e.async = "false", e.loadXML(t)) } else e = (new DOMParser).parseFromString(t, "text/xml") } catch (t) { e = null } e && (this.xmlDoc = e, this.runtime.isIE && !i && this.xmlDoc.setProperty("SelectionLanguage", "XPath")) } }, t.acts = new n, s.prototype.NumberValue = function (t, e) { if (this.runtime.isDomFree) t.set_int(0); else { var i = this.xpath_eval_one(e, XPathResult.NUMBER_TYPE); i ? this.runtime.isIE ? t.set_int(parseInt(i.nodeValue, 10)) : t.set_int(i.numberValue || 0) : t.set_int(0) } }, s.prototype.StringValue = function (t, e) { var i; if (this.runtime.isDomFree) t.set_string(""); else if (/firefox/i.test(navigator.userAgent)) if (i = this.xpath_eval_one(e, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE)) { var n, s, r = ""; for (n = 0, s = i.snapshotLength; n < s; n++) r += i.snapshotItem(n).textContent; t.set_string(r) } else t.set_string(""); else (i = this.xpath_eval_one(e, XPathResult.STRING_TYPE)) ? this.runtime.isIE ? t.set_string(i.nodeValue || i.nodeTypedValue || "") : t.set_string(i.stringValue || "") : t.set_string("") }, s.prototype.NodeCount = function (t, e) { if (this.runtime.isDomFree) t.set_int(0); else { var i = this.xpath_eval_many(e, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE); i ? this.runtime.isIE ? t.set_int(i.length || 0) : t.set_int(i.snapshotLength || 0) : t.set_int(0) } }, t.exps = new s }(), cr.behaviors.Bullet = function (t) { this.runtime = t }, function () { var t = cr.behaviors.Bullet.prototype; t.Type = function (t, e) { this.behavior = t, this.objtype = e, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t, e) { this.type = t, this.behavior = t.behavior, this.inst = e, this.runtime = t.runtime }; var e = t.Instance.prototype; function i() { } function n() { } function s() { } e.onCreate = function () { var t = this.properties[0]; this.acc = this.properties[1], this.g = this.properties[2], this.bounceOffSolid = 0 !== this.properties[3], this.setAngle = 0 !== this.properties[4], this.dx = Math.cos(this.inst.angle) * t, this.dy = Math.sin(this.inst.angle) * t, this.lastx = this.inst.x, this.lasty = this.inst.y, this.lastKnownAngle = this.inst.angle, this.travelled = 0, this.enabled = 0 !== this.properties[5] }, e.saveToJSON = function () { return { acc: this.acc, g: this.g, dx: this.dx, dy: this.dy, lx: this.lastx, ly: this.lasty, lka: this.lastKnownAngle, t: this.travelled, e: this.enabled } }, e.loadFromJSON = function (t) { this.acc = t.acc, this.g = t.g, this.dx = t.dx, this.dy = t.dy, this.lastx = t.lx, this.lasty = t.ly, this.lastKnownAngle = t.lka, this.travelled = t.t, this.enabled = t.e }, e.tick = function () { if (this.enabled) { var t, e, i, n, s = this.runtime.getDt(this.inst); this.inst.angle !== this.lastKnownAngle && (this.setAngle && (t = cr.distanceTo(0, 0, this.dx, this.dy), this.dx = Math.cos(this.inst.angle) * t, this.dy = Math.sin(this.inst.angle) * t), this.lastKnownAngle = this.inst.angle), 0 !== this.acc && (t = cr.distanceTo(0, 0, this.dx, this.dy), e = 0 === this.dx && 0 === this.dy ? this.inst.angle : cr.angleTo(0, 0, this.dx, this.dy), (t += this.acc * s) < 0 && (t = 0), this.dx = Math.cos(e) * t, this.dy = Math.sin(e) * t), 0 !== this.g && (this.dy += this.g * s), this.lastx = this.inst.x, this.lasty = this.inst.y, 0 === this.dx && 0 === this.dy || (this.inst.x += this.dx * s, this.inst.y += this.dy * s, this.travelled += cr.distanceTo(0, 0, this.dx * s, this.dy * s), this.setAngle && (this.inst.angle = cr.angleTo(0, 0, this.dx, this.dy), this.inst.set_bbox_changed(), this.lastKnownAngle = this.inst.angle), this.inst.set_bbox_changed(), this.bounceOffSolid && (i = this.runtime.testOverlapSolid(this.inst)) && (this.runtime.registerCollision(this.inst, i), t = cr.distanceTo(0, 0, this.dx, this.dy), n = this.runtime.calculateSolidBounceAngle(this.inst, this.lastx, this.lasty), this.dx = Math.cos(n) * t, this.dy = Math.sin(n) * t, this.inst.x += this.dx * s, this.inst.y += this.dy * s, this.inst.set_bbox_changed(), this.setAngle && (this.inst.angle = n, this.lastKnownAngle = n, this.inst.set_bbox_changed()), this.runtime.pushOutSolid(this.inst, this.dx / t, this.dy / t, Math.max(2.5 * t * s, 30)) || this.runtime.pushOutSolidNearest(this.inst, 100))) } }, i.prototype.CompareSpeed = function (t, e) { return cr.do_cmp(cr.distanceTo(0, 0, this.dx, this.dy), t, e) }, i.prototype.CompareTravelled = function (t, e) { return cr.do_cmp(this.travelled, t, e) }, t.cnds = new i, n.prototype.SetSpeed = function (t) { var e = cr.angleTo(0, 0, this.dx, this.dy); this.dx = Math.cos(e) * t, this.dy = Math.sin(e) * t }, n.prototype.SetAcceleration = function (t) { this.acc = t }, n.prototype.SetGravity = function (t) { this.g = t }, n.prototype.SetAngleOfMotion = function (t) { t = cr.to_radians(t); var e = cr.distanceTo(0, 0, this.dx, this.dy); this.dx = Math.cos(t) * e, this.dy = Math.sin(t) * e }, n.prototype.Bounce = function (t) { if (t) { var e = t.getFirstPicked(this.inst); if (e) { var i = this.runtime.getDt(this.inst), n = cr.distanceTo(0, 0, this.dx, this.dy), s = this.runtime.calculateSolidBounceAngle(this.inst, this.lastx, this.lasty, e); this.dx = Math.cos(s) * n, this.dy = Math.sin(s) * n, this.inst.x += this.dx * i, this.inst.y += this.dy * i, this.inst.set_bbox_changed(), this.setAngle && (this.inst.angle = s, this.lastKnownAngle = s, this.inst.set_bbox_changed()), 0 !== n && (this.bounceOffSolid ? this.runtime.pushOutSolid(this.inst, this.dx / n, this.dy / n, Math.max(2.5 * n * i, 30)) || this.runtime.pushOutSolidNearest(this.inst, 100) : this.runtime.pushOut(this.inst, this.dx / n, this.dy / n, Math.max(2.5 * n * i, 30), e)) } } }, n.prototype.SetDistanceTravelled = function (t) { this.travelled = t }, n.prototype.SetEnabled = function (t) { this.enabled = 1 === t }, t.acts = new n, s.prototype.Speed = function (t) { var e = cr.distanceTo(0, 0, this.dx, this.dy); e = cr.round6dp(e), t.set_float(e) }, s.prototype.Acceleration = function (t) { t.set_float(this.acc) }, s.prototype.AngleOfMotion = function (t) { t.set_float(cr.to_degrees(cr.angleTo(0, 0, this.dx, this.dy))) }, s.prototype.DistanceTravelled = function (t) { t.set_float(this.travelled) }, s.prototype.Gravity = function (t) { t.set_float(this.g) }, t.exps = new s }(), cr.behaviors.Fade = function (t) { this.runtime = t }, function () { var t = cr.behaviors.Fade.prototype; t.Type = function (t, e) { this.behavior = t, this.objtype = e, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t, e) { this.type = t, this.behavior = t.behavior, this.inst = e, this.runtime = t.runtime }; var e = t.Instance.prototype; function i() { } function n() { } function s() { } e.onCreate = function () { this.activeAtStart = 1 === this.properties[0], this.setMaxOpacity = !1, this.fadeInTime = this.properties[1], this.waitTime = this.properties[2], this.fadeOutTime = this.properties[3], this.destroy = this.properties[4], this.stage = this.activeAtStart ? 0 : 3, this.recycled ? this.stageTime.reset() : this.stageTime = new cr.KahanAdder, this.maxOpacity = this.inst.opacity ? this.inst.opacity : 1, this.activeAtStart && (0 === this.fadeInTime ? (this.stage = 1, 0 === this.waitTime && (this.stage = 2)) : (this.inst.opacity = 0, this.runtime.redraw = !0)) }, e.saveToJSON = function () { return { fit: this.fadeInTime, wt: this.waitTime, fot: this.fadeOutTime, s: this.stage, st: this.stageTime.sum, mo: this.maxOpacity } }, e.loadFromJSON = function (t) { this.fadeInTime = t.fit, this.waitTime = t.wt, this.fadeOutTime = t.fot, this.stage = t.s, this.stageTime.reset(), this.stageTime.sum = t.st, this.maxOpacity = t.mo }, e.tick = function () { this.stageTime.add(this.runtime.getDt(this.inst)), 0 === this.stage && (this.inst.opacity = this.stageTime.sum / this.fadeInTime * this.maxOpacity, this.runtime.redraw = !0, this.inst.opacity >= this.maxOpacity && (this.inst.opacity = this.maxOpacity, this.stage = 1, this.stageTime.reset(), this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd, this.inst))), 1 === this.stage && this.stageTime.sum >= this.waitTime && (this.stage = 2, this.stageTime.reset(), this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd, this.inst)), 2 === this.stage && 0 !== this.fadeOutTime && (this.inst.opacity = this.maxOpacity - this.stageTime.sum / this.fadeOutTime * this.maxOpacity, this.runtime.redraw = !0, this.inst.opacity < 0 && (this.inst.opacity = 0, this.stage = 3, this.stageTime.reset(), this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd, this.inst), 1 === this.destroy && this.runtime.DestroyInstance(this.inst))) }, e.doStart = function () { this.stage = 0, this.stageTime.reset(), 0 === this.fadeInTime ? (this.stage = 1, 0 === this.waitTime && (this.stage = 2)) : (this.inst.opacity = 0, this.runtime.redraw = !0) }, i.prototype.OnFadeOutEnd = function () { return !0 }, i.prototype.OnFadeInEnd = function () { return !0 }, i.prototype.OnWaitEnd = function () { return !0 }, t.cnds = new i, n.prototype.StartFade = function () { this.activeAtStart || this.setMaxOpacity || (this.maxOpacity = this.inst.opacity ? this.inst.opacity : 1, this.setMaxOpacity = !0), 3 === this.stage && this.doStart() }, n.prototype.RestartFade = function () { this.doStart() }, n.prototype.SetFadeInTime = function (t) { t < 0 && (t = 0), this.fadeInTime = t }, n.prototype.SetWaitTime = function (t) { t < 0 && (t = 0), this.waitTime = t }, n.prototype.SetFadeOutTime = function (t) { t < 0 && (t = 0), this.fadeOutTime = t }, t.acts = new n, s.prototype.FadeInTime = function (t) { t.set_float(this.fadeInTime) }, s.prototype.WaitTime = function (t) { t.set_float(this.waitTime) }, s.prototype.FadeOutTime = function (t) { t.set_float(this.fadeOutTime) }, t.exps = new s }(), cr.behaviors.Platform = function (t) { this.runtime = t }, function () { var t = cr.behaviors.Platform.prototype; t.Type = function (t, e) { this.behavior = t, this.objtype = e, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }; t.Instance = function (t, e) { this.type = t, this.behavior = t.behavior, this.inst = e, this.runtime = t.runtime, this.leftkey = !1, this.rightkey = !1, this.jumpkey = !1, this.jumped = !1, this.doubleJumped = !1, this.canDoubleJump = !1, this.ignoreInput = !1, this.simleft = !1, this.simright = !1, this.simjump = !1, this.lastFloorObject = null, this.loadFloorObject = -1, this.lastFloorX = 0, this.lastFloorY = 0, this.floorIsJumpthru = !1, this.animMode = 0, this.fallthrough = 0, this.firstTick = !0, this.dx = 0, this.dy = 0 }; var e = t.Instance.prototype; function i() { } function n() { } function s() { } e.updateGravity = function () { this.downx = Math.cos(this.ga), this.downy = Math.sin(this.ga), this.rightx = Math.cos(this.ga - Math.PI / 2), this.righty = Math.sin(this.ga - Math.PI / 2), this.downx = cr.round6dp(this.downx), this.downy = cr.round6dp(this.downy), this.rightx = cr.round6dp(this.rightx), this.righty = cr.round6dp(this.righty), this.g1 = this.g, this.g < 0 && (this.downx *= -1, this.downy *= -1, this.g = Math.abs(this.g)) }, e.onCreate = function () { this.maxspeed = this.properties[0], this.acc = this.properties[1], this.dec = this.properties[2], this.jumpStrength = this.properties[3], this.g = this.properties[4], this.g1 = this.g, this.maxFall = this.properties[5], this.enableDoubleJump = 0 !== this.properties[6], this.jumpSustain = this.properties[7] / 1e3, this.defaultControls = 1 === this.properties[8], this.enabled = 0 !== this.properties[9], this.wasOnFloor = !1, this.wasOverJumpthru = this.runtime.testOverlapJumpThru(this.inst), this.loadOverJumpthru = -1, this.sustainTime = 0, this.ga = cr.to_radians(90), this.updateGravity(); var e = this; this.defaultControls && !this.runtime.isDomFree && (jQuery(document).keydown(function (t) { e.onKeyDown(t) }), jQuery(document).keyup(function (t) { e.onKeyUp(t) })), this.recycled || (this.myDestroyCallback = function (t) { e.onInstanceDestroyed(t) }), this.runtime.addDestroyCallback(this.myDestroyCallback), this.inst.extra.isPlatformBehavior = !0 }, e.saveToJSON = function () { return { ii: this.ignoreInput, lfx: this.lastFloorX, lfy: this.lastFloorY, lfo: this.lastFloorObject ? this.lastFloorObject.uid : -1, am: this.animMode, en: this.enabled, fall: this.fallthrough, ft: this.firstTick, dx: this.dx, dy: this.dy, ms: this.maxspeed, acc: this.acc, dec: this.dec, js: this.jumpStrength, g: this.g, g1: this.g1, mf: this.maxFall, wof: this.wasOnFloor, woj: this.wasOverJumpthru ? this.wasOverJumpthru.uid : -1, ga: this.ga, edj: this.enableDoubleJump, cdj: this.canDoubleJump, dj: this.doubleJumped, sus: this.jumpSustain } }, e.loadFromJSON = function (t) { this.ignoreInput = t.ii, this.lastFloorX = t.lfx, this.lastFloorY = t.lfy, this.loadFloorObject = t.lfo, this.animMode = t.am, this.enabled = t.en, this.fallthrough = t.fall, this.firstTick = t.ft, this.dx = t.dx, this.dy = t.dy, this.maxspeed = t.ms, this.acc = t.acc, this.dec = t.dec, this.jumpStrength = t.js, this.g = t.g, this.g1 = t.g1, this.maxFall = t.mf, this.wasOnFloor = t.wof, this.loadOverJumpthru = t.woj, this.ga = t.ga, this.enableDoubleJump = t.edj, this.canDoubleJump = t.cdj, this.doubleJumped = t.dj, this.jumpSustain = t.sus, this.leftkey = !1, this.rightkey = !1, this.jumpkey = !1, this.jumped = !1, this.simleft = !1, this.simright = !1, this.simjump = !1, this.sustainTime = 0, this.updateGravity() }, e.afterLoad = function () { -1 === this.loadFloorObject ? this.lastFloorObject = null : this.lastFloorObject = this.runtime.getObjectByUID(this.loadFloorObject), -1 === this.loadOverJumpthru ? this.wasOverJumpthru = null : this.wasOverJumpthru = this.runtime.getObjectByUID(this.loadOverJumpthru) }, e.onInstanceDestroyed = function (t) { this.lastFloorObject == t && (this.lastFloorObject = null) }, e.onDestroy = function () { this.lastFloorObject = null, this.runtime.removeDestroyCallback(this.myDestroyCallback) }, e.onKeyDown = function (t) { switch (t.which) { case 38: t.preventDefault(), this.jumpkey = !0; break; case 37: t.preventDefault(), this.leftkey = !0; break; case 39: t.preventDefault(), this.rightkey = !0 } }, e.onKeyUp = function (t) { switch (t.which) { case 38: t.preventDefault(), this.jumpkey = !1, this.jumped = !1; break; case 37: t.preventDefault(), this.leftkey = !1; break; case 39: t.preventDefault(), this.rightkey = !1 } }, e.onWindowBlur = function () { this.leftkey = !1, this.rightkey = !1, this.jumpkey = !1 }, e.getGDir = function () { return this.g < 0 ? -1 : 1 }, e.isOnFloor = function () { var t, e, i, n = null, s = null, r = this.inst.x, o = this.inst.y; if (this.inst.x += this.downx, this.inst.y += this.downy, this.inst.set_bbox_changed(), this.lastFloorObject && this.runtime.testOverlap(this.inst, this.lastFloorObject) && (!this.runtime.typeHasBehavior(this.lastFloorObject.type, cr.behaviors.solid) || this.lastFloorObject.extra.solidEnabled)) return this.inst.x = r, this.inst.y = o, this.inst.set_bbox_changed(), this.lastFloorObject; if ((n = this.runtime.testOverlapSolid(this.inst)) || 0 !== this.fallthrough || (s = this.runtime.testOverlapJumpThru(this.inst, !0)), this.inst.x = r, this.inst.y = o, this.inst.set_bbox_changed(), n) return this.runtime.testOverlap(this.inst, n) ? null : (this.floorIsJumpthru = !1, n); if (s && s.length) { for (i = t = 0, e = s.length; t < e; t++) s[i] = s[t], this.runtime.testOverlap(this.inst, s[t]) || i++; if (1 <= i) return this.floorIsJumpthru = !0, s[0] } return null }, e.tick = function () { }, e.posttick = function () { var t, e, i, n, s, r, o, a, h, c, l = this.runtime.getDt(this.inst); this.jumpkey || this.simjump || (this.jumped = !1); var u = this.leftkey || this.simleft, p = this.rightkey || this.simright, d = this.jumpkey || this.simjump, f = d && !this.jumped; if (this.simleft = !1, this.simright = !1, this.simjump = !1, this.enabled) { this.ignoreInput && (f = d = p = u = !1), d || (this.sustainTime = 0); var g = this.lastFloorObject, m = !1; this.firstTick && ((this.runtime.testOverlapSolid(this.inst) || this.runtime.testOverlapJumpThru(this.inst)) && this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, 4, !0), this.firstTick = !1), !g || 0 !== this.dy || g.y === this.lastFloorY && g.x === this.lastFloorX || (t = g.x - this.lastFloorX, e = g.y - this.lastFloorY, this.inst.x += t, this.inst.y += e, this.inst.set_bbox_changed(), this.lastFloorX = g.x, this.lastFloorY = g.y, m = !0, this.runtime.testOverlapSolid(this.inst) && this.runtime.pushOutSolid(this.inst, -t, -e, 2.5 * Math.sqrt(t * t + e * e))); var y = this.isOnFloor(), _ = this.runtime.testOverlapSolid(this.inst); if (_) if (this.inst.extra.inputPredicted) this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, 10, !1); else if (this.runtime.pushOutSolidAxis(this.inst, this.rightx, this.righty, this.inst.width / 2)) this.runtime.registerCollision(this.inst, _); else { if (!this.runtime.pushOutSolidNearest(this.inst, Math.max(this.inst.width, this.inst.height) / 2)) return; this.runtime.registerCollision(this.inst, _) } y ? (this.doubleJumped = !1, this.canDoubleJump = !1, 0 < this.dy && (this.wasOnFloor || (this.runtime.pushInFractional(this.inst, -this.downx, -this.downy, y, 16), this.wasOnFloor = !0), this.dy = 0), g != y ? (this.lastFloorObject = y, this.lastFloorX = y.x, this.lastFloorY = y.y, this.runtime.registerCollision(this.inst, y)) : m && (_ = this.runtime.testOverlapSolid(this.inst)) && (this.runtime.registerCollision(this.inst, _), 0 !== t && (0 < t ? this.runtime.pushOutSolid(this.inst, -this.rightx, -this.righty) : this.runtime.pushOutSolid(this.inst, this.rightx, this.righty)), this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy))) : d || (this.canDoubleJump = !0), (y && f || !y && this.enableDoubleJump && d && this.canDoubleJump && !this.doubleJumped) && (h = this.inst.x, c = this.inst.y, this.inst.x -= this.downx, this.inst.y -= this.downy, this.inst.set_bbox_changed(), this.runtime.testOverlapSolid(this.inst) ? f = !1 : (this.sustainTime = this.jumpSustain, this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump, this.inst), this.animMode = 2, this.dy = -this.jumpStrength, f = !0, y ? this.jumped = !0 : this.doubleJumped = !0), this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed()), y || (d && 0 < this.sustainTime ? (this.dy = -this.jumpStrength, this.sustainTime -= l) : (this.lastFloorObject = null, this.dy += this.g * l, this.dy > this.maxFall && (this.dy = this.maxFall)), f && (this.jumped = !0)), this.wasOnFloor = !!y, u == p && (this.dx < 0 ? (this.dx += this.dec * l, 0 < this.dx && (this.dx = 0)) : 0 < this.dx && (this.dx -= this.dec * l, this.dx < 0 && (this.dx = 0))), u && !p && (0 < this.dx ? this.dx -= (this.acc + this.dec) * l : this.dx -= this.acc * l), p && !u && (this.dx < 0 ? this.dx += (this.acc + this.dec) * l : this.dx += this.acc * l), this.dx > this.maxspeed ? this.dx = this.maxspeed : this.dx < -this.maxspeed && (this.dx = -this.maxspeed); var v = !1; if (0 !== this.dx) { h = this.inst.x, c = this.inst.y, t = this.dx * l * this.rightx, e = this.dx * l * this.righty, this.inst.x += this.rightx * (1 < this.dx ? 1 : -1) - this.downx, this.inst.y += this.righty * (1 < this.dx ? 1 : -1) - this.downy, this.inst.set_bbox_changed(); var b = !1, w = this.runtime.testOverlapSolid(this.inst); if (this.inst.x = h + t, this.inst.y = c + e, this.inst.set_bbox_changed(), !(i = this.runtime.testOverlapSolid(this.inst)) && y && (i = this.runtime.testOverlapJumpThru(this.inst)) && (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed(), this.runtime.testOverlap(this.inst, i) ? (i = null, b = !1) : b = !0, this.inst.x = h + t, this.inst.y = c + e, this.inst.set_bbox_changed()), i) { var x = Math.abs(this.dx * l) + 2; w || !this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, x, b, i) ? (this.runtime.registerCollision(this.inst, i), x = Math.max(Math.abs(this.dx * l * 2.5), 30), this.runtime.pushOutSolid(this.inst, this.rightx * (this.dx < 0 ? 1 : -1), this.righty * (this.dx < 0 ? 1 : -1), x, !1) ? !y || b || this.floorIsJumpthru || (h = this.inst.x, c = this.inst.y, this.inst.x += this.downx, this.inst.y += this.downy, this.runtime.testOverlapSolid(this.inst) && this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, 3, !1) || (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed())) : (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed()), b || (this.dx = 0)) : !w && !f && Math.abs(this.dy) < Math.abs(this.jumpStrength / 4) && (this.dy = 0, y || (v = !0)) } else { var S = this.isOnFloor(); y && !S ? (n = Math.ceil(Math.abs(this.dx * l)) + 2, h = this.inst.x, c = this.inst.y, this.inst.x += this.downx * n, this.inst.y += this.downy * n, this.inst.set_bbox_changed(), this.runtime.testOverlapSolid(this.inst) || this.runtime.testOverlapJumpThru(this.inst) ? this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, n + 2, !0) : (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed())) : S && 0 === this.dy && this.runtime.pushInFractional(this.inst, -this.downx, -this.downy, S, 16) } } if (0 !== this.dy) { h = this.inst.x, c = this.inst.y, this.inst.x += this.dy * l * this.downx, this.inst.y += this.dy * l * this.downy; var T = this.inst.x, O = this.inst.y; this.inst.set_bbox_changed(); var A = !1; if (!(_ = this.runtime.testOverlapSolid(this.inst)) && 0 < this.dy && !y) { if ((s = 0 < this.fallthrough ? null : this.runtime.testOverlapJumpThru(this.inst, !0)) && s.length) { if (this.wasOverJumpthru) { for (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed(), a = r = 0, o = s.length; r < o; r++) s[a] = s[r], this.runtime.testOverlap(this.inst, s[r]) || a++; s.length = a, this.inst.x = T, this.inst.y = O, this.inst.set_bbox_changed() } 1 <= s.length && (_ = s[0]) } A = !!_ } if (_) { this.runtime.registerCollision(this.inst, _), this.sustainTime = 0; x = A ? Math.abs(this.dy * l * 2.5 + 10) : Math.max(Math.abs(this.dy * l * 2.5 + 10), 30); this.runtime.pushOutSolid(this.inst, this.downx * (this.dy < 0 ? 1 : -1), this.downy * (this.dy < 0 ? 1 : -1), x, A, _) ? (this.lastFloorObject = _, this.lastFloorX = _.x, this.lastFloorY = _.y, (this.floorIsJumpthru = A) && (v = !0), this.dy = 0) : (this.inst.x = h, this.inst.y = c, this.inst.set_bbox_changed(), this.wasOnFloor = !0, A || (this.dy = 0)) } } 3 !== this.animMode && 0 < this.dy && !y && (this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall, this.inst), this.animMode = 3), (y || v) && 0 <= this.dy && (3 === this.animMode || v || f && 0 === this.dy ? (this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand, this.inst), 0 === this.dx && 0 === this.dy ? this.animMode = 0 : this.animMode = 1) : (0 !== this.animMode && 0 === this.dx && 0 === this.dy && (this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop, this.inst), this.animMode = 0), 1 === this.animMode || 0 === this.dx && 0 === this.dy || f || (this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove, this.inst), this.animMode = 1))), 0 < this.fallthrough && this.fallthrough--, this.wasOverJumpthru = this.runtime.testOverlapJumpThru(this.inst) } }, i.prototype.IsMoving = function () { return 0 !== this.dx || 0 !== this.dy }, i.prototype.CompareSpeed = function (t, e) { var i = Math.sqrt(this.dx * this.dx + this.dy * this.dy); return cr.do_cmp(i, t, e) }, i.prototype.IsOnFloor = function () { if (0 !== this.dy) return !1; var t, e, i, n, s = null, r = this.inst.x, o = this.inst.y; if (this.inst.x += this.downx, this.inst.y += this.downy, this.inst.set_bbox_changed(), (t = this.runtime.testOverlapSolid(this.inst)) || 0 !== this.fallthrough || (s = this.runtime.testOverlapJumpThru(this.inst, !0)), this.inst.x = r, this.inst.y = o, this.inst.set_bbox_changed(), t) return !this.runtime.testOverlap(this.inst, t); if (s && s.length) { for (n = e = 0, i = s.length; e < i; e++) s[n] = s[e], this.runtime.testOverlap(this.inst, s[e]) || n++; if (1 <= n) return !0 } return !1 }, i.prototype.IsByWall = function (t) { var e, i = this.inst.x, n = this.inst.y; return 0 === t ? (this.inst.x -= 2 * this.rightx, this.inst.y -= 2 * this.righty) : (this.inst.x += 2 * this.rightx, this.inst.y += 2 * this.righty), this.inst.set_bbox_changed(), this.runtime.testOverlapSolid(this.inst) ? (this.inst.x -= 3 * this.downx, this.inst.y -= 3 * this.downy, this.inst.set_bbox_changed(), e = this.runtime.testOverlapSolid(this.inst), this.inst.x = i, this.inst.y = n, this.inst.set_bbox_changed(), e) : (this.inst.x = i, this.inst.y = n, this.inst.set_bbox_changed(), !1) }, i.prototype.IsJumping = function () { return this.dy < 0 }, i.prototype.IsFalling = function () { return 0 < this.dy }, i.prototype.OnJump = function () { return !0 }, i.prototype.OnFall = function () { return !0 }, i.prototype.OnStop = function () { return !0 }, i.prototype.OnMove = function () { return !0 }, i.prototype.OnLand = function () { return !0 }, i.prototype.IsDoubleJumpEnabled = function () { return this.enableDoubleJump }, t.cnds = new i, n.prototype.SetIgnoreInput = function (t) { this.ignoreInput = t }, n.prototype.SetMaxSpeed = function (t) { this.maxspeed = t, this.maxspeed < 0 && (this.maxspeed = 0) }, n.prototype.SetAcceleration = function (t) { this.acc = t, this.acc < 0 && (this.acc = 0) }, n.prototype.SetDeceleration = function (t) { this.dec = t, this.dec < 0 && (this.dec = 0) }, n.prototype.SetJumpStrength = function (t) { this.jumpStrength = t, this.jumpStrength < 0 && (this.jumpStrength = 0) }, n.prototype.SetGravity = function (t) { this.g1 !== t && (this.g = t, this.updateGravity(), this.runtime.testOverlapSolid(this.inst) && (this.runtime.pushOutSolid(this.inst, this.downx, this.downy, 10), this.inst.x += 2 * this.downx, this.inst.y += 2 * this.downy, this.inst.set_bbox_changed()), this.lastFloorObject = null) }, n.prototype.SetMaxFallSpeed = function (t) { this.maxFall = t, this.maxFall < 0 && (this.maxFall = 0) }, n.prototype.SimulateControl = function (t) { switch (t) { case 0: this.simleft = !0; break; case 1: this.simright = !0; break; case 2: this.simjump = !0 } }, n.prototype.SetVectorX = function (t) { this.dx = t }, n.prototype.SetVectorY = function (t) { this.dy = t }, n.prototype.SetGravityAngle = function (t) { t = cr.to_radians(t), t = cr.clamp_angle(t), this.ga !== t && (this.ga = t, this.updateGravity(), this.lastFloorObject = null) }, n.prototype.SetEnabled = function (t) { this.enabled !== (1 === t) && (this.enabled = 1 === t, this.enabled || (this.lastFloorObject = null)) }, n.prototype.FallThrough = function () { var t = this.inst.x, e = this.inst.y; this.inst.x += this.downx, this.inst.y += this.downy, this.inst.set_bbox_changed(); var i = this.runtime.testOverlapJumpThru(this.inst, !1); this.inst.x = t, this.inst.y = e, this.inst.set_bbox_changed(), i && (this.fallthrough = 3, this.lastFloorObject = null) }, n.prototype.SetDoubleJumpEnabled = function (t) { this.enableDoubleJump = 0 !== t }, n.prototype.SetJumpSustain = function (t) { this.jumpSustain = t / 1e3 }, t.acts = new n, s.prototype.Speed = function (t) { t.set_float(Math.sqrt(this.dx * this.dx + this.dy * this.dy)) }, s.prototype.MaxSpeed = function (t) { t.set_float(this.maxspeed) }, s.prototype.Acceleration = function (t) { t.set_float(this.acc) }, s.prototype.Deceleration = function (t) { t.set_float(this.dec) }, s.prototype.JumpStrength = function (t) { t.set_float(this.jumpStrength) }, s.prototype.Gravity = function (t) { t.set_float(this.g) }, s.prototype.GravityAngle = function (t) { t.set_float(cr.to_degrees(this.ga)) }, s.prototype.MaxFallSpeed = function (t) { t.set_float(this.maxFall) }, s.prototype.MovingAngle = function (t) { t.set_float(cr.to_degrees(Math.atan2(this.dy, this.dx))) }, s.prototype.VectorX = function (t) { t.set_float(this.dx) }, s.prototype.VectorY = function (t) { t.set_float(this.dy) }, s.prototype.JumpSustain = function (t) { t.set_float(1e3 * this.jumpSustain) }, t.exps = new s }(), cr.behaviors.scrollto = function (t) { this.runtime = t, this.shakeMag = 0, this.shakeStart = 0, this.shakeEnd = 0, this.shakeMode = 0 }, function () { var t = cr.behaviors.scrollto.prototype; t.Type = function (t, e) { this.behavior = t, this.objtype = e, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t, e) { this.type = t, this.behavior = t.behavior, this.inst = e, this.runtime = t.runtime }; var e = t.Instance.prototype; function f(t) { var e, i, n; for (e = 0, i = t.behavior_insts.length; e < i; ++e) if ((n = t.behavior_insts[e]).behavior instanceof cr.behaviors.scrollto) return n; return null } function i() { } e.onCreate = function () { this.enabled = 0 !== this.properties[0] }, e.saveToJSON = function () { return { smg: this.behavior.shakeMag, ss: this.behavior.shakeStart, se: this.behavior.shakeEnd, smd: this.behavior.shakeMode } }, e.loadFromJSON = function (t) { this.behavior.shakeMag = t.smg, this.behavior.shakeStart = t.ss, this.behavior.shakeEnd = t.se, this.behavior.shakeMode = t.smd }, e.tick = function () { }, e.tick2 = function () { if (this.enabled) { var t, e, i, n = this.behavior.my_instances.valuesRef(), s = 0, r = 0, o = 0; for (t = 0, e = n.length; t < e; t++) (i = f(n[t])) && i.enabled && (s += n[t].x, r += n[t].y, ++o); var a = this.inst.layer.layout, h = this.runtime.kahanTime.sum, c = 0, l = 0; if (h >= this.behavior.shakeStart && h < this.behavior.shakeEnd) { var u = this.behavior.shakeMag * Math.min(this.runtime.timescale, 1); 0 === this.behavior.shakeMode && (u *= 1 - (h - this.behavior.shakeStart) / (this.behavior.shakeEnd - this.behavior.shakeStart)); var p = Math.random() * Math.PI * 2, d = Math.random() * u; c = Math.cos(p) * d, l = Math.sin(p) * d } a.scrollToX(s / o + c), a.scrollToY(r / o + l) } }, i.prototype.Shake = function (t, e, i) { this.behavior.shakeMag = t, this.behavior.shakeStart = this.runtime.kahanTime.sum, this.behavior.shakeEnd = this.behavior.shakeStart + e, this.behavior.shakeMode = i }, i.prototype.SetEnabled = function (t) { this.enabled = 0 !== t }, t.acts = new i }(), cr.behaviors.solid = function (t) { this.runtime = t }, function () { var t = cr.behaviors.solid.prototype; t.Type = function (t, e) { this.behavior = t, this.objtype = e, this.runtime = t.runtime }, t.Type.prototype.onCreate = function () { }, t.Instance = function (t, e) { this.type = t, this.behavior = t.behavior, this.inst = e, this.runtime = t.runtime }; var e = t.Instance.prototype; function i() { } function n() { } e.onCreate = function () { this.inst.extra.solidEnabled = 0 !== this.properties[0] }, e.tick = function () { }, i.prototype.IsEnabled = function () { return this.inst.extra.solidEnabled }, t.cnds = new i, n.prototype.SetEnabled = function (t) { this.inst.extra.solidEnabled = !!t }, t.acts = new n }(), cr.getObjectRefTable = function () { return [cr.plugins_.ATPAds, cr.plugins_.Audio, cr.plugins_.Browser, cr.plugins_.Keyboard, cr.plugins_.LocalStorage, cr.plugins_.Mouse, cr.plugins_.Sprite, cr.plugins_.Spritefont2, cr.plugins_.AJAX, cr.plugins_.Touch, cr.plugins_.XML, cr.behaviors.Platform, cr.behaviors.solid, cr.behaviors.scrollto, cr.behaviors.Bullet, cr.behaviors.Fade, cr.system_object.prototype.cnds.IsGroupActive, cr.system_object.prototype.cnds.OnLayoutStart, cr.system_object.prototype.acts.SetVar, cr.plugins_.ATPAds.prototype.acts.LoadBanner, cr.plugins_.Audio.prototype.cnds.IsAnyPlaying, cr.plugins_.Audio.prototype.acts.Play, cr.system_object.prototype.cnds.CompareVar, cr.system_object.prototype.cnds.TriggerOnce, cr.behaviors.Fade.prototype.acts.StartFade, cr.plugins_.Mouse.prototype.cnds.IsOverObject, cr.plugins_.Mouse.prototype.acts.SetCursor, cr.plugins_.Touch.prototype.cnds.OnTouchObject, cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying, cr.plugins_.Audio.prototype.acts.SetSilent, cr.plugins_.Sprite.prototype.acts.SetAnim, cr.system_object.prototype.cnds.Else, cr.plugins_.Audio.prototype.cnds.IsSilent, cr.system_object.prototype.cnds.EveryTick, cr.behaviors.Bullet.prototype.acts.SetSpeed, cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion, cr.plugins_.Spritefont2.prototype.acts.SetText, cr.plugins_.Sprite.prototype.cnds.OnCreated, cr.system_object.prototype.acts.AddVar, cr.plugins_.Sprite.prototype.acts.SetX, cr.plugins_.Touch.prototype.cnds.OnTouchStart, cr.plugins_.Touch.prototype.cnds.IsTouchingObject, cr.system_object.prototype.acts.Wait, cr.plugins_.Sprite.prototype.acts.Spawn, cr.plugins_.Keyboard.prototype.cnds.OnKey, cr.behaviors.Platform.prototype.acts.SimulateControl, cr.behaviors.Platform.prototype.cnds.IsOnFloor, cr.behaviors.Platform.prototype.cnds.IsJumping, cr.behaviors.Platform.prototype.cnds.IsFalling, cr.plugins_.Sprite.prototype.cnds.OnCollision, cr.plugins_.Sprite.prototype.acts.Destroy, cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar, cr.plugins_.Sprite.prototype.acts.SetInstanceVar, cr.system_object.prototype.exps.random, cr.system_object.prototype.exps.choose, cr.plugins_.Sprite.prototype.acts.SetY, cr.behaviors.Platform.prototype.acts.SetJumpStrength, cr.behaviors.Platform.prototype.acts.SetGravity, cr.plugins_.Sprite.prototype.cnds.CompareX, cr.plugins_.Sprite.prototype.exps.X, cr.plugins_.Sprite.prototype.acts.SetAnimSpeed, cr.plugins_.Sprite.prototype.acts.SetAngle, cr.plugins_.Sprite.prototype.cnds.CompareFrame, cr.system_object.prototype.cnds.Every, cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished, cr.plugins_.Sprite.prototype.acts.SetScale, cr.plugins_.Sprite.prototype.cnds.IsOnScreen, cr.plugins_.Sprite.prototype.acts.MoveForward, cr.plugins_.Sprite.prototype.acts.RotateClockwise, cr.plugins_.Sprite.prototype.cnds.CompareY, cr.plugins_.Sprite.prototype.exps.Y, cr.system_object.prototype.acts.RestartLayout, cr.plugins_.Sprite.prototype.acts.SetPos, cr.plugins_.LocalStorage.prototype.acts.SetItem, cr.plugins_.LocalStorage.prototype.acts.CheckItemExists, cr.plugins_.LocalStorage.prototype.cnds.OnItemExists, cr.plugins_.LocalStorage.prototype.acts.GetItem, cr.plugins_.LocalStorage.prototype.cnds.OnItemGet, cr.plugins_.LocalStorage.prototype.exps.ItemValue, cr.system_object.prototype.cnds.Compare, cr.plugins_.Mouse.prototype.exps.Y, cr.plugins_.ATPAds.prototype.cnds.onBannerLoaded, cr.plugins_.ATPAds.prototype.acts.ShowBanner, cr.plugins_.ATPAds.prototype.acts.SetLayout, cr.plugins_.Sprite.prototype.acts.SetVisible, cr.plugins_.Browser.prototype.acts.GoToURLWindow] };